!function(e){"use strict";var t,r,n;t=[function(e,t,r){r(1),r(83),r(99),r(100),r(102),r(104),r(105),r(109),r(111),r(114),r(115),r(117),r(121),r(130),r(131),r(135),r(142),r(143),r(145),r(146),r(148),r(149),r(150),r(152),r(153),r(154),r(155),r(156),r(158),r(159),r(160),r(167),r(169),r(170),r(172),r(174),r(184),r(186),r(188),r(190),r(192),r(194),r(196),r(197),r(198),r(202),r(203),r(206),r(207),r(208),r(210),r(211),r(212),r(215),r(217),r(224),r(225),r(227),r(229),r(230),r(231),e.exports=r(232)},function(e,t,r){var n=r(2),i=r(3),o=r(67),a=r(68),s="WebAssembly",u=i[s],c=7!==new Error("e",{cause:7}).cause,l=function(e,t){var r={};r[e]=a(e,t,c),n({global:!0,constructor:!0,arity:1,forced:c},r)},p=function(e,t){if(u&&u[e]){var r={};r[e]=a(s+"."+e,t,c),n({target:s,stat:!0,constructor:!0,arity:1,forced:c},r)}};l("Error",(function(e){return function(t){return o(e,this,arguments)}})),l("EvalError",(function(e){return function(t){return o(e,this,arguments)}})),l("RangeError",(function(e){return function(t){return o(e,this,arguments)}})),l("ReferenceError",(function(e){return function(t){return o(e,this,arguments)}})),l("SyntaxError",(function(e){return function(t){return o(e,this,arguments)}})),l("TypeError",(function(e){return function(t){return o(e,this,arguments)}})),l("URIError",(function(e){return function(t){return o(e,this,arguments)}})),p("CompileError",(function(e){return function(t){return o(e,this,arguments)}})),p("LinkError",(function(e){return function(t){return o(e,this,arguments)}})),p("RuntimeError",(function(e){return function(t){return o(e,this,arguments)}}))},function(t,r,n){var i=n(3),o=n(4).f,a=n(42),s=n(46),u=n(36),c=n(54),l=n(66);t.exports=function(t,r){var n,p,f,d,y,h=t.target,v=t.global,g=t.stat;if(n=v?i:g?i[h]||u(h,{}):i[h]&&i[h].prototype)for(p in r){if(d=r[p],f=t.dontCallGetSet?(y=o(n,p))&&y.value:n[p],!l(v?p:h+(g?".":"#")+p,t.forced)&&f!==e){if(typeof d==typeof f)continue;c(d,f)}(t.sham||f&&f.sham)&&a(d,"sham",!0),s(n,p,d,t)}}},function(e,t,r){var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof global&&global)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},function(e,t,r){var n=r(5),i=r(7),o=r(9),a=r(10),s=r(11),u=r(17),c=r(37),l=r(40),p=Object.getOwnPropertyDescriptor;t.f=n?p:function(e,t){if(e=s(e),t=u(t),l)try{return p(e,t)}catch(r){}if(c(e,t))return a(!i(o.f,e,t),e[t])}},function(e,t,r){var n=r(6);e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,r){var n=r(8),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},function(e,t,r){var n=r(6);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},function(e,t,r){var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!n.call({1:2},1);t.f=o?function(e){var t=i(this,e);return!!t&&t.enumerable}:n},function(e,t,r){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(12),i=r(15);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(13),i=r(6),o=r(14),a=Object,s=n("".split);e.exports=i((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===o(e)?s(e,""):a(e)}:a},function(e,t,r){var n=r(8),i=Function.prototype,o=i.call,a=n&&i.bind.bind(o,o);e.exports=n?a:function(e){return function(){return o.apply(e,arguments)}}},function(e,t,r){var n=r(13),i=n({}.toString),o=n("".slice);e.exports=function(e){return o(i(e),8,-1)}},function(e,t,r){var n=r(16),i=TypeError;e.exports=function(e){if(n(e))throw new i("Can't call method on "+e);return e}},function(t,r,n){t.exports=function(t){return null===t||t===e}},function(e,t,r){var n=r(18),i=r(21);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},function(t,r,n){var i=n(7),o=n(19),a=n(21),s=n(28),u=n(31),c=n(32),l=TypeError,p=c("toPrimitive");t.exports=function(t,r){if(!o(t)||a(t))return t;var n,c=s(t,p);if(c){if(r===e&&(r="default"),n=i(c,t,r),!o(n)||a(n))return n;throw new l("Can't convert object to primitive value")}return r===e&&(r="number"),u(t,r)}},function(e,t,r){var n=r(20);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},function(t,r,n){var i="object"==typeof document&&document.all;t.exports=void 0===i&&i!==e?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}},function(e,t,r){var n=r(22),i=r(20),o=r(23),a=r(24),s=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return i(t)&&o(t.prototype,s(e))}},function(t,r,n){var i=n(3),o=n(20);t.exports=function(t,r){return arguments.length<2?(n=i[t],o(n)?n:e):i[t]&&i[t][r];var n}},function(e,t,r){var n=r(13);e.exports=n({}.isPrototypeOf)},function(e,t,r){var n=r(25);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n=r(26),i=r(6),o=r(3).String;e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(e,t,r){var n,i,o=r(3),a=r(27),s=o.process,u=o.Deno,c=s&&s.versions||u&&u.version,l=c&&c.v8;l&&(i=(n=l.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},function(e,t,r){var n=r(3).navigator,i=n&&n.userAgent;e.exports=i?String(i):""},function(t,r,n){var i=n(29),o=n(16);t.exports=function(t,r){var n=t[r];return o(n)?e:i(n)}},function(e,t,r){var n=r(20),i=r(30),o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(i(e)+" is not a function")}},function(e,t,r){var n=String;e.exports=function(e){try{return n(e)}catch(t){return"Object"}}},function(e,t,r){var n=r(7),i=r(20),o=r(19),a=TypeError;e.exports=function(e,t){var r,s;if("string"===t&&i(r=e.toString)&&!o(s=n(r,e)))return s;if(i(r=e.valueOf)&&!o(s=n(r,e)))return s;if("string"!==t&&i(r=e.toString)&&!o(s=n(r,e)))return s;throw new a("Can't convert object to primitive value")}},function(e,t,r){var n=r(3),i=r(33),o=r(37),a=r(39),s=r(25),u=r(24),c=n.Symbol,l=i("wks"),p=u?c.for||c:c&&c.withoutSetter||a;e.exports=function(e){return o(l,e)||(l[e]=s&&o(c,e)?c[e]:p("Symbol."+e)),l[e]}},function(e,t,r){var n=r(34);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},function(e,t,r){var n=r(35),i=r(3),o=r(36),a="__core-js_shared__",s=e.exports=i[a]||o(a,{});(s.versions||(s.versions=[])).push({version:"3.39.0",mode:n?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},function(e,t,r){e.exports=!1},function(e,t,r){var n=r(3),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},function(e,t,r){var n=r(13),i=r(38),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},function(e,t,r){var n=r(15),i=Object;e.exports=function(e){return i(n(e))}},function(t,r,n){var i=n(13),o=0,a=Math.random(),s=i(1..toString);t.exports=function(t){return"Symbol("+(t===e?"":t)+")_"+s(++o+a,36)}},function(e,t,r){var n=r(5),i=r(6),o=r(41);e.exports=!n&&!i((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(3),i=r(19),o=n.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,r){var n=r(5),i=r(43),o=r(10);e.exports=n?function(e,t,r){return i.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(5),i=r(40),o=r(44),a=r(45),s=r(17),u=TypeError,c=Object.defineProperty,l=Object.getOwnPropertyDescriptor,p="enumerable",f="configurable",d="writable";t.f=n?o?function(e,t,r){if(a(e),t=s(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&d in r&&!r[d]){var n=l(e,t);n&&n[d]&&(e[t]=r.value,r={configurable:f in r?r[f]:n[f],enumerable:p in r?r[p]:n[p],writable:!1})}return c(e,t,r)}:c:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return c(e,t,r)}catch(n){}if("get"in r||"set"in r)throw new u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(5),i=r(6);e.exports=n&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(e,t,r){var n=r(19),i=String,o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(i(e)+" is not an object")}},function(t,r,n){var i=n(20),o=n(43),a=n(47),s=n(36);t.exports=function(t,r,n,u){u||(u={});var c=u.enumerable,l=u.name!==e?u.name:r;if(i(n)&&a(n,l,u),u.global)c?t[r]=n:s(r,n);else{try{u.unsafe?t[r]&&(c=!0):delete t[r]}catch(p){}c?t[r]=n:o.f(t,r,{value:n,enumerable:!1,configurable:!u.nonConfigurable,writable:!u.nonWritable})}return t}},function(t,r,n){var i=n(13),o=n(6),a=n(20),s=n(37),u=n(5),c=n(48).CONFIGURABLE,l=n(49),p=n(50),f=p.enforce,d=p.get,y=String,h=Object.defineProperty,v=i("".slice),g=i("".replace),_=i([].join),O=u&&!o((function(){return 8!==h((function(){}),"length",{value:8}).length})),b=String(String).split("String"),m=t.exports=function(t,r,n){"Symbol("===v(y(r),0,7)&&(r="["+g(y(r),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(r="get "+r),n&&n.setter&&(r="set "+r),(!s(t,"name")||c&&t.name!==r)&&(u?h(t,"name",{value:r,configurable:!0}):t.name=r),O&&n&&s(n,"arity")&&t.length!==n.arity&&h(t,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?u&&h(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=e)}catch(o){}var i=f(t);return s(i,"source")||(i.source=_(b,"string"==typeof r?r:"")),t};Function.prototype.toString=m((function(){return a(this)&&d(this).source||l(this)}),"toString")},function(e,t,r){var n=r(5),i=r(37),o=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,s=i(o,"name"),u=s&&"something"===function(){}.name,c=s&&(!n||n&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:u,CONFIGURABLE:c}},function(e,t,r){var n=r(13),i=r(20),o=r(34),a=n(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},function(e,t,r){var n,i,o,a=r(51),s=r(3),u=r(19),c=r(42),l=r(37),p=r(34),f=r(52),d=r(53),y="Object already initialized",h=s.TypeError,v=s.WeakMap;if(a||p.state){var g=p.state||(p.state=new v);g.get=g.get,g.has=g.has,g.set=g.set,n=function(e,t){if(g.has(e))throw new h(y);return t.facade=e,g.set(e,t),t},i=function(e){return g.get(e)||{}},o=function(e){return g.has(e)}}else{var _=f("state");d[_]=!0,n=function(e,t){if(l(e,_))throw new h(y);return t.facade=e,c(e,_,t),t},i=function(e){return l(e,_)?e[_]:{}},o=function(e){return l(e,_)}}e.exports={set:n,get:i,has:o,enforce:function(e){return o(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=i(t)).type!==e)throw new h("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(3),i=r(20),o=n.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},function(e,t,r){var n=r(33),i=r(39),o=n("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},function(e,t,r){e.exports={}},function(e,t,r){var n=r(37),i=r(55),o=r(4),a=r(43);e.exports=function(e,t,r){for(var s=i(t),u=a.f,c=o.f,l=0;l<s.length;l++){var p=s[l];n(e,p)||r&&n(r,p)||u(e,p,c(t,p))}}},function(e,t,r){var n=r(22),i=r(13),o=r(56),a=r(65),s=r(45),u=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?u(t,r(e)):t}},function(e,t,r){var n=r(57),i=r(64).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t,r){var n=r(13),i=r(37),o=r(11),a=r(58).indexOf,s=r(53),u=n([].push);e.exports=function(e,t){var r,n=o(e),c=0,l=[];for(r in n)!i(s,r)&&i(n,r)&&u(l,r);for(;t.length>c;)i(n,r=t[c++])&&(~a(l,r)||u(l,r));return l}},function(e,t,r){var n=r(11),i=r(59),o=r(62),a=function(e){return function(t,r,a){var s=n(t),u=o(s);if(0===u)return!e&&-1;var c,l=i(a,u);if(e&&r!=r){for(;u>l;)if((c=s[l++])!=c)return!0}else for(;u>l;l++)if((e||l in s)&&s[l]===r)return e||l||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,r){var n=r(60),i=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):o(r,t)}},function(e,t,r){var n=r(61);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},function(e,t,r){var n=Math.ceil,i=Math.floor;e.exports=Math.trunc||function(e){var t=+e;return(t>0?i:n)(t)}},function(e,t,r){var n=r(63);e.exports=function(e){return n(e.length)}},function(e,t,r){var n=r(60),i=Math.min;e.exports=function(e){var t=n(e);return t>0?i(t,9007199254740991):0}},function(e,t,r){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(6),i=r(20),o=/#|\.prototype\./,a=function(e,t){var r=u[s(e)];return r===l||r!==c&&(i(t)?n(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},u=a.data={},c=a.NATIVE="N",l=a.POLYFILL="P";e.exports=a},function(e,t,r){var n=r(8),i=Function.prototype,o=i.apply,a=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?a.bind(o):function(){return a.apply(o,arguments)})},function(t,r,n){var i=n(22),o=n(37),a=n(42),s=n(23),u=n(69),c=n(54),l=n(73),p=n(74),f=n(75),d=n(79),y=n(80),h=n(5),v=n(35);t.exports=function(t,r,n,g){var _="stackTraceLimit",O=g?2:1,b=t.split("."),m=b[b.length-1],T=i.apply(null,b);if(T){var k=T.prototype;if(!v&&o(k,"cause")&&delete k.cause,!n)return T;var S=i("Error"),E=r((function(t,r){var n=f(g?r:t,e),i=g?new T(t):new T;return n!==e&&a(i,"message",n),y(i,E,i.stack,2),this&&s(k,this)&&p(i,this,E),arguments.length>O&&d(i,arguments[O]),i}));if(E.prototype=k,"Error"!==m?u?u(E,S):c(E,S,{name:!0}):h&&_ in T&&(l(E,T,_),l(E,T,"prepareStackTrace")),c(E,T),!v)try{k.name!==m&&a(k,"name",m),k.constructor=E}catch(P){}return E}}},function(t,r,n){var i=n(70),o=n(19),a=n(15),s=n(71);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=i(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return a(r),s(n),o(r)?(t?e(r,n):r.__proto__=n,r):r}}():e)},function(e,t,r){var n=r(13),i=r(29);e.exports=function(e,t,r){try{return n(i(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(o){}}},function(e,t,r){var n=r(72),i=String,o=TypeError;e.exports=function(e){if(n(e))return e;throw new o("Can't set "+i(e)+" as a prototype")}},function(e,t,r){var n=r(19);e.exports=function(e){return n(e)||null===e}},function(e,t,r){var n=r(43).f;e.exports=function(e,t,r){r in e||n(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},function(e,t,r){var n=r(20),i=r(19),o=r(69);e.exports=function(e,t,r){var a,s;return o&&n(a=t.constructor)&&a!==r&&i(s=a.prototype)&&s!==r.prototype&&o(e,s),e}},function(t,r,n){var i=n(76);t.exports=function(t,r){return t===e?arguments.length<2?"":r:i(t)}},function(e,t,r){var n=r(77),i=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return i(e)}},function(t,r,n){var i=n(78),o=n(20),a=n(14),s=n(32)("toStringTag"),u=Object,c="Arguments"===a(function(){return arguments}());t.exports=i?a:function(t){var r,n,i;return t===e?"Undefined":null===t?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(r){}}(r=u(t),s))?n:c?a(r):"Object"===(i=a(r))&&o(r.callee)?"Arguments":i}},function(e,t,r){var n={};n[r(32)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){var n=r(19),i=r(42);e.exports=function(e,t){n(t)&&"cause"in t&&i(e,"cause",t.cause)}},function(e,t,r){var n=r(42),i=r(81),o=r(82),a=Error.captureStackTrace;e.exports=function(e,t,r,s){o&&(a?a(e,t):n(e,"stack",i(r,s)))}},function(e,t,r){var n=r(13),i=Error,o=n("".replace),a=String(new i("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,u=s.test(a);e.exports=function(e,t){if(u&&"string"==typeof e&&!i.prepareStackTrace)for(;t--;)e=o(e,s,"");return e}},function(e,t,r){var n=r(6),i=r(10);e.exports=!n((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)}))},function(e,t,r){r(84)},function(t,r,n){var i=n(2),o=n(23),a=n(85),s=n(69),u=n(54),c=n(87),l=n(42),p=n(10),f=n(79),d=n(80),y=n(91),h=n(75),v=n(32)("toStringTag"),g=Error,_=[].push,O=function(t,r){var n,i=o(b,this);s?n=s(new g,i?a(this):b):(n=i?this:c(b),l(n,v,"Error")),r!==e&&l(n,"message",h(r)),d(n,O,n.stack,1),arguments.length>2&&f(n,arguments[2]);var u=[];return y(t,_,{that:u}),l(n,"errors",u),n};s?s(O,g):u(O,g,{name:!0});var b=O.prototype=c(g.prototype,{constructor:p(1,O),message:p(1,""),name:p(1,"AggregateError")});i({global:!0,constructor:!0,arity:2},{AggregateError:O})},function(e,t,r){var n=r(37),i=r(20),o=r(38),a=r(52),s=r(86),u=a("IE_PROTO"),c=Object,l=c.prototype;e.exports=s?c.getPrototypeOf:function(e){var t=o(e);if(n(t,u))return t[u];var r=t.constructor;return i(r)&&t instanceof r?r.prototype:t instanceof c?l:null}},function(e,t,r){var n=r(6);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(t,r,n){var i,o=n(45),a=n(88),s=n(64),u=n(53),c=n(90),l=n(41),p=n(52),f="prototype",d="script",y=p("IE_PROTO"),h=function(){},v=function(e){return"<"+d+">"+e+"</"+d+">"},g=function(e){e.write(v("")),e.close();var t=e.parentWindow.Object;return e=null,t},_=function(){try{i=new ActiveXObject("htmlfile")}catch(o){}var e,t,r;_="undefined"!=typeof document?document.domain&&i?g(i):(t=l("iframe"),r="java"+d+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(v("document.F=Object")),e.close(),e.F):g(i);for(var n=s.length;n--;)delete _[f][s[n]];return _()};u[y]=!0,t.exports=Object.create||function(t,r){var n;return null!==t?(h[f]=o(t),n=new h,h[f]=null,n[y]=t):n=_(),r===e?n:a.f(n,r)}},function(e,t,r){var n=r(5),i=r(44),o=r(43),a=r(45),s=r(11),u=r(89);t.f=n&&!i?Object.defineProperties:function(e,t){a(e);for(var r,n=s(t),i=u(t),c=i.length,l=0;c>l;)o.f(e,r=i[l++],n[r]);return e}},function(e,t,r){var n=r(57),i=r(64);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){var n=r(22);e.exports=n("document","documentElement")},function(e,t,r){var n=r(92),i=r(7),o=r(45),a=r(30),s=r(94),u=r(62),c=r(23),l=r(96),p=r(97),f=r(98),d=TypeError,y=function(e,t){this.stopped=e,this.result=t},h=y.prototype;e.exports=function(e,t,r){var v,g,_,O,b,m,T,k=r&&r.that,S=!(!r||!r.AS_ENTRIES),E=!(!r||!r.IS_RECORD),P=!(!r||!r.IS_ITERATOR),w=!(!r||!r.INTERRUPTED),L=n(t,k),A=function(e){return v&&f(v,"normal",e),new y(!0,e)},D=function(e){return S?(o(e),w?L(e[0],e[1],A):L(e[0],e[1])):w?L(e,A):L(e)};if(E)v=e.iterator;else if(P)v=e;else{if(!(g=p(e)))throw new d(a(e)+" is not iterable");if(s(g)){for(_=0,O=u(e);O>_;_++)if((b=D(e[_]))&&c(h,b))return b;return new y(!1)}v=l(e,g)}for(m=E?e.next:v.next;!(T=i(m,v)).done;){try{b=D(T.value)}catch(I){f(v,"throw",I)}if("object"==typeof b&&b&&c(h,b))return b}return new y(!1)}},function(t,r,n){var i=n(93),o=n(29),a=n(8),s=i(i.bind);t.exports=function(t,r){return o(t),r===e?t:a?s(t,r):function(){return t.apply(r,arguments)}}},function(e,t,r){var n=r(14),i=r(13);e.exports=function(e){if("Function"===n(e))return i(e)}},function(t,r,n){var i=n(32),o=n(95),a=i("iterator"),s=Array.prototype;t.exports=function(t){return t!==e&&(o.Array===t||s[a]===t)}},function(e,t,r){e.exports={}},function(e,t,r){var n=r(7),i=r(29),o=r(45),a=r(30),s=r(97),u=TypeError;e.exports=function(e,t){var r=arguments.length<2?s(e):t;if(i(r))return o(n(r,e));throw new u(a(e)+" is not iterable")}},function(e,t,r){var n=r(77),i=r(28),o=r(16),a=r(95),s=r(32)("iterator");e.exports=function(e){if(!o(e))return i(e,s)||i(e,"@@iterator")||a[n(e)]}},function(e,t,r){var n=r(7),i=r(45),o=r(28);e.exports=function(e,t,r){var a,s;i(e);try{if(!(a=o(e,"return"))){if("throw"===t)throw r;return r}a=n(a,e)}catch(u){s=!0,a=u}if("throw"===t)throw r;if(s)throw a;return i(a),r}},function(e,t,r){var n=r(2),i=r(22),o=r(67),a=r(6),s=r(68),u="AggregateError",c=i(u),l=!a((function(){return 1!==c([1]).errors[0]}))&&a((function(){return 7!==c([1],u,{cause:7}).cause}));n({global:!0,constructor:!0,arity:2,forced:l},{AggregateError:s(u,(function(e){return function(t,r){return o(e,this,arguments)}}),l,!0)})},function(t,r,n){var i=n(2),o=n(38),a=n(62),s=n(60),u=n(101);i({target:"Array",proto:!0},{at:function(t){var r=o(this),n=a(r),i=s(t),u=i>=0?i:n+i;return u<0||u>=n?e:r[u]}}),u("at")},function(t,r,n){var i=n(32),o=n(87),a=n(43).f,s=i("unscopables"),u=Array.prototype;u[s]===e&&a(u,s,{configurable:!0,value:o(null)}),t.exports=function(e){u[s][e]=!0}},function(t,r,n){var i=n(2),o=n(103).findLast,a=n(101);i({target:"Array",proto:!0},{findLast:function(t){return o(this,t,arguments.length>1?arguments[1]:e)}}),a("findLast")},function(t,r,n){var i=n(92),o=n(12),a=n(38),s=n(62),u=function(t){var r=1===t;return function(n,u,c){for(var l,p=a(n),f=o(p),d=s(f),y=i(u,c);d-- >0;)if(y(l=f[d],d,p))switch(t){case 0:return l;case 1:return d}return r?-1:e}};t.exports={findLast:u(0),findLastIndex:u(1)}},function(t,r,n){var i=n(2),o=n(103).findLastIndex,a=n(101);i({target:"Array",proto:!0},{findLastIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:e)}}),a("findLastIndex")},function(e,t,r){var n=r(2),i=r(38),o=r(62),a=r(106),s=r(108);n({target:"Array",proto:!0,arity:1,forced:r(6)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var t=i(this),r=o(t),n=arguments.length;s(r+n);for(var u=0;u<n;u++)t[r]=arguments[u],r++;return a(t,r),r}})},function(t,r,n){var i=n(5),o=n(107),a=TypeError,s=Object.getOwnPropertyDescriptor,u=i&&!function(){if(this!==e)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=u?function(e,t){if(o(e)&&!s(e,"length").writable)throw new a("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},function(e,t,r){var n=r(14);e.exports=Array.isArray||function(e){return"Array"===n(e)}},function(e,t,r){var n=TypeError;e.exports=function(e){if(e>9007199254740991)throw n("Maximum allowed index exceeded");return e}},function(e,t,r){var n=r(2),i=r(110),o=r(11),a=r(101),s=Array;n({target:"Array",proto:!0},{toReversed:function(){return i(o(this),s)}}),a("toReversed")},function(e,t,r){var n=r(62);e.exports=function(e,t){for(var r=n(e),i=new t(r),o=0;o<r;o++)i[o]=e[r-o-1];return i}},function(t,r,n){var i=n(2),o=n(13),a=n(29),s=n(11),u=n(112),c=n(113),l=n(101),p=Array,f=o(c("Array","sort"));i({target:"Array",proto:!0},{toSorted:function(t){t!==e&&a(t);var r=s(this),n=u(p,r);return f(n,t)}}),l("toSorted")},function(e,t,r){var n=r(62);e.exports=function(e,t,r){for(var i=0,o=arguments.length>2?r:n(t),a=new e(o);o>i;)a[i]=t[i++];return a}},function(e,t,r){var n=r(3);e.exports=function(e,t){var r=n[e],i=r&&r.prototype;return i&&i[t]}},function(e,t,r){var n=r(2),i=r(101),o=r(108),a=r(62),s=r(59),u=r(11),c=r(60),l=Array,p=Math.max,f=Math.min;n({target:"Array",proto:!0},{toSpliced:function(e,t){var r,n,i,d,y=u(this),h=a(y),v=s(e,h),g=arguments.length,_=0;for(0===g?r=n=0:1===g?(r=0,n=h-v):(r=g-2,n=f(p(c(t),0),h-v)),i=o(h+r-n),d=l(i);_<v;_++)d[_]=y[_];for(;_<v+r;_++)d[_]=arguments[_-v+2];for(;_<i;_++)d[_]=y[_+n-r];return d}}),i("toSpliced")},function(e,t,r){var n=r(2),i=r(116),o=r(11),a=Array;n({target:"Array",proto:!0},{with:function(e,t){return i(o(this),a,e,t)}})},function(e,t,r){var n=r(62),i=r(60),o=RangeError;e.exports=function(e,t,r,a){var s=n(e),u=i(r),c=u<0?s+u:u;if(c>=s||c<0)throw new o("Incorrect index");for(var l=new t(s),p=0;p<s;p++)l[p]=p===c?a:e[p];return l}},function(e,t,r){var n=r(5),i=r(118),o=r(119),a=ArrayBuffer.prototype;n&&!("detached"in a)&&i(a,"detached",{configurable:!0,get:function(){return o(this)}})},function(e,t,r){var n=r(47),i=r(43);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),i.f(e,t,r)}},function(e,t,r){var n=r(3),i=r(93),o=r(120),a=n.ArrayBuffer,s=a&&a.prototype,u=s&&i(s.slice);e.exports=function(e){if(0!==o(e))return!1;if(!u)return!1;try{return u(e,0,0),!1}catch(t){return!0}}},function(e,t,r){var n=r(3),i=r(70),o=r(14),a=n.ArrayBuffer,s=n.TypeError;e.exports=a&&i(a.prototype,"byteLength","get")||function(e){if("ArrayBuffer"!==o(e))throw new s("ArrayBuffer expected");return e.byteLength}},function(t,r,n){var i=n(2),o=n(122);o&&i({target:"ArrayBuffer",proto:!0},{transfer:function(){return o(this,arguments.length?arguments[0]:e,!0)}})},function(t,r,n){var i=n(3),o=n(13),a=n(70),s=n(123),u=n(124),c=n(120),l=n(125),p=n(129),f=i.structuredClone,d=i.ArrayBuffer,y=i.DataView,h=Math.min,v=d.prototype,g=y.prototype,_=o(v.slice),O=a(v,"resizable","get"),b=a(v,"maxByteLength","get"),m=o(g.getInt8),T=o(g.setInt8);t.exports=(p||l)&&function(t,r,n){var i,o=c(t),a=r===e?o:s(r),v=!O||!O(t);if(u(t),p&&(t=f(t,{transfer:[t]}),o===a&&(n||v)))return t;if(o>=a&&(!n||v))i=_(t,0,a);else{var g=n&&!v&&b?{maxByteLength:b(t)}:e;i=new d(a,g);for(var k=new y(t),S=new y(i),E=h(a,o),P=0;P<E;P++)T(S,P,m(k,P))}return p||l(t),i}},function(t,r,n){var i=n(60),o=n(63),a=RangeError;t.exports=function(t){if(t===e)return 0;var r=i(t),n=o(r);if(r!==n)throw new a("Wrong length or index");return n}},function(e,t,r){var n=r(119),i=TypeError;e.exports=function(e){if(n(e))throw new i("ArrayBuffer is detached");return e}},function(e,t,r){var n,i,o,a,s=r(3),u=r(126),c=r(129),l=s.structuredClone,p=s.ArrayBuffer,f=s.MessageChannel,d=!1;if(c)d=function(e){l(e,{transfer:[e]})};else if(p)try{f||(n=u("worker_threads"))&&(f=n.MessageChannel),f&&(i=new f,o=new p(2),a=function(e){i.port1.postMessage(null,[e])},2===o.byteLength&&(a(o),0===o.byteLength&&(d=a)))}catch(y){}e.exports=d},function(e,t,r){var n=r(3),i=r(127);e.exports=function(e){if(i){try{return n.process.getBuiltinModule(e)}catch(t){}try{return Function('return require("'+e+'")')()}catch(t){}}}},function(e,t,r){var n=r(128);e.exports="NODE"===n},function(e,t,r){var n=r(3),i=r(27),o=r(14),a=function(e){return i.slice(0,e.length)===e};e.exports=a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":n.Bun&&"string"==typeof Bun.version?"BUN":n.Deno&&"object"==typeof Deno.version?"DENO":"process"===o(n.process)?"NODE":n.window&&n.document?"BROWSER":"REST"},function(e,t,r){var n=r(3),i=r(6),o=r(26),a=r(128),s=n.structuredClone;e.exports=!!s&&!i((function(){if("DENO"===a&&o>92||"NODE"===a&&o>94||"BROWSER"===a&&o>97)return!1;var e=new ArrayBuffer(8),t=s(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength}))},function(t,r,n){var i=n(2),o=n(122);o&&i({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return o(this,arguments.length?arguments[0]:e,!1)}})},function(e,t,r){var n=r(2),i=r(3),o=r(132),a=r(45),s=r(20),u=r(85),c=r(118),l=r(133),p=r(6),f=r(37),d=r(32),y=r(134).IteratorPrototype,h=r(5),v=r(35),g="constructor",_="Iterator",O=d("toStringTag"),b=TypeError,m=i[_],T=v||!s(m)||m.prototype!==y||!p((function(){m({})})),k=function(){if(o(this,y),u(this)===y)throw new b("Abstract class Iterator not directly constructable")},S=function(e,t){h?c(y,e,{configurable:!0,get:function(){return t},set:function(t){if(a(this),this===y)throw new b("You can't redefine this property");f(this,e)?this[e]=t:l(this,e,t)}}):y[e]=t};f(y,O)||S(O,_),!T&&f(y,g)&&y[g]!==Object||S(g,k),k.prototype=y,n({global:!0,constructor:!0,forced:T},{Iterator:k})},function(e,t,r){var n=r(23),i=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new i("Incorrect invocation")}},function(e,t,r){var n=r(5),i=r(43),o=r(10);e.exports=function(e,t,r){n?i.f(e,t,o(0,r)):e[t]=r}},function(e,t,r){var n,i,o,a=r(6),s=r(20),u=r(19),c=r(87),l=r(85),p=r(46),f=r(32),d=r(35),y=f("iterator"),h=!1;[].keys&&("next"in(o=[].keys())?(i=l(l(o)))!==Object.prototype&&(n=i):h=!0),!u(n)||a((function(){var e={};return n[y].call(e)!==e}))?n={}:d&&(n=c(n)),s(n[y])||p(n,y,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:h}},function(e,t,r){var n=r(2),i=r(7),o=r(45),a=r(136),s=r(137),u=r(138),c=r(139),l=r(35),p=c((function(){for(var e,t=this.iterator,r=this.next;this.remaining;)if(this.remaining--,e=o(i(r,t)),this.done=!!e.done)return;if(e=o(i(r,t)),!(this.done=!!e.done))return e.value}));n({target:"Iterator",proto:!0,real:!0,forced:l},{drop:function(e){o(this);var t=u(s(+e));return new p(a(this),{remaining:t})}})},function(e,t,r){e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},function(e,t,r){var n=RangeError;e.exports=function(e){if(e==e)return e;throw new n("NaN is not allowed")}},function(e,t,r){var n=r(60),i=RangeError;e.exports=function(e){var t=n(e);if(t<0)throw new i("The argument can't be less than 0");return t}},function(t,r,n){var i=n(7),o=n(87),a=n(42),s=n(140),u=n(32),c=n(50),l=n(28),p=n(134).IteratorPrototype,f=n(141),d=n(98),y=u("toStringTag"),h="IteratorHelper",v="WrapForValidIterator",g=c.set,_=function(t){var r=c.getterFor(t?v:h);return s(o(p),{next:function(){var n=r(this);if(t)return n.nextHandler();try{var i=n.done?e:n.nextHandler();return f(i,n.done)}catch(o){throw n.done=!0,o}},return:function(){var n=r(this),o=n.iterator;if(n.done=!0,t){var a=l(o,"return");return a?i(a,o):f(e,!0)}if(n.inner)try{d(n.inner.iterator,"normal")}catch(s){return d(o,"throw",s)}return o&&d(o,"normal"),f(e,!0)}})},O=_(!0),b=_(!1);a(b,y,"Iterator Helper"),t.exports=function(e,t){var r=function(r,n){n?(n.iterator=r.iterator,n.next=r.next):n=r,n.type=t?v:h,n.nextHandler=e,n.counter=0,n.done=!1,g(this,n)};return r.prototype=t?O:b,r}},function(e,t,r){var n=r(46);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){e.exports=function(e,t){return{value:e,done:t}}},function(e,t,r){var n=r(2),i=r(91),o=r(29),a=r(45),s=r(136);n({target:"Iterator",proto:!0,real:!0},{every:function(e){a(this),o(e);var t=s(this),r=0;return!i(t,(function(t,n){if(!e(t,r++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){var n=r(2),i=r(7),o=r(29),a=r(45),s=r(136),u=r(139),c=r(144),l=r(35),p=u((function(){for(var e,t,r=this.iterator,n=this.predicate,o=this.next;;){if(e=a(i(o,r)),this.done=!!e.done)return;if(t=e.value,c(r,n,[t,this.counter++],!0))return t}}));n({target:"Iterator",proto:!0,real:!0,forced:l},{filter:function(e){return a(this),o(e),new p(s(this),{predicate:e})}})},function(e,t,r){var n=r(45),i=r(98);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(a){i(e,"throw",a)}}},function(e,t,r){var n=r(2),i=r(91),o=r(29),a=r(45),s=r(136);n({target:"Iterator",proto:!0,real:!0},{find:function(e){a(this),o(e);var t=s(this),r=0;return i(t,(function(t,n){if(e(t,r++))return n(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},function(e,t,r){var n=r(2),i=r(7),o=r(29),a=r(45),s=r(136),u=r(147),c=r(139),l=r(98),p=r(35),f=c((function(){for(var e,t,r=this.iterator,n=this.mapper;;){if(t=this.inner)try{if(!(e=a(i(t.next,t.iterator))).done)return e.value;this.inner=null}catch(o){l(r,"throw",o)}if(e=a(i(this.next,r)),this.done=!!e.done)return;try{this.inner=u(n(e.value,this.counter++),!1)}catch(o){l(r,"throw",o)}}}));n({target:"Iterator",proto:!0,real:!0,forced:p},{flatMap:function(e){return a(this),o(e),new f(s(this),{mapper:e,inner:null})}})},function(t,r,n){var i=n(7),o=n(45),a=n(136),s=n(97);t.exports=function(t,r){r&&"string"==typeof t||o(t);var n=s(t);return a(o(n!==e?i(n,t):t))}},function(e,t,r){var n=r(2),i=r(91),o=r(29),a=r(45),s=r(136);n({target:"Iterator",proto:!0,real:!0},{forEach:function(e){a(this),o(e);var t=s(this),r=0;i(t,(function(t){e(t,r++)}),{IS_RECORD:!0})}})},function(e,t,r){var n=r(2),i=r(7),o=r(38),a=r(23),s=r(134).IteratorPrototype,u=r(139),c=r(147),l=r(35),p=u((function(){return i(this.next,this.iterator)}),!0);n({target:"Iterator",stat:!0,forced:l},{from:function(e){var t=c("string"==typeof e?o(e):e,!0);return a(s,t.iterator)?t.iterator:new p(t)}})},function(e,t,r){var n=r(2),i=r(151);n({target:"Iterator",proto:!0,real:!0,forced:r(35)},{map:i})},function(e,t,r){var n=r(7),i=r(29),o=r(45),a=r(136),s=r(139),u=r(144),c=s((function(){var e=this.iterator,t=o(n(this.next,e));if(!(this.done=!!t.done))return u(e,this.mapper,[t.value,this.counter++],!0)}));e.exports=function(e){return o(this),i(e),new c(a(this),{mapper:e})}},function(t,r,n){var i=n(2),o=n(91),a=n(29),s=n(45),u=n(136),c=TypeError;i({target:"Iterator",proto:!0,real:!0},{reduce:function(t){s(this),a(t);var r=u(this),n=arguments.length<2,i=n?e:arguments[1],l=0;if(o(r,(function(e){n?(n=!1,i=e):i=t(i,e,l),l++}),{IS_RECORD:!0}),n)throw new c("Reduce of empty iterator with no initial value");return i}})},function(e,t,r){var n=r(2),i=r(91),o=r(29),a=r(45),s=r(136);n({target:"Iterator",proto:!0,real:!0},{some:function(e){a(this),o(e);var t=s(this),r=0;return i(t,(function(t,n){if(e(t,r++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},function(t,r,n){var i=n(2),o=n(7),a=n(45),s=n(136),u=n(137),c=n(138),l=n(139),p=n(98),f=n(35),d=l((function(){var t=this.iterator;if(!this.remaining--)return this.done=!0,p(t,"normal",e);var r=a(o(this.next,t));return(this.done=!!r.done)?void 0:r.value}));i({target:"Iterator",proto:!0,real:!0,forced:f},{take:function(e){a(this);var t=c(u(+e));return new d(s(this),{remaining:t})}})},function(e,t,r){var n=r(2),i=r(45),o=r(91),a=r(136),s=[].push;n({target:"Iterator",proto:!0,real:!0},{toArray:function(){var e=[];return o(a(i(this)),s,{that:e,IS_RECORD:!0}),e}})},function(e,t,r){var n=r(2),i=r(13),o=r(29),a=r(15),s=r(91),u=r(157),c=r(35),l=r(6),p=u.Map,f=u.has,d=u.get,y=u.set,h=i([].push),v=c||l((function(){return 1!==p.groupBy("ab",(function(e){return e})).get("a").length}));n({target:"Map",stat:!0,forced:c||v},{groupBy:function(e,t){a(e),o(t);var r=new p,n=0;return s(e,(function(e){var i=t(e,n++);f(r,i)?h(d(r,i),e):y(r,i,[e])})),r}})},function(e,t,r){var n=r(13),i=Map.prototype;e.exports={Map:Map,set:n(i.set),get:n(i.get),has:n(i.has),remove:n(i.delete),proto:i}},function(e,t,r){var n=r(2),i=r(22),o=r(13),a=r(29),s=r(15),u=r(17),c=r(91),l=r(6),p=Object.groupBy,f=i("Object","create"),d=o([].push);n({target:"Object",stat:!0,forced:!p||l((function(){return 1!==p("ab",(function(e){return e})).a.length}))},{groupBy:function(e,t){s(e),a(t);var r=f(null),n=0;return c(e,(function(e){var i=u(t(e,n++));i in r?d(r[i],e):r[i]=[e]})),r}})},function(e,t,r){r(2)({target:"Object",stat:!0},{hasOwn:r(37)})},function(e,t,r){var n=r(2),i=r(7),o=r(29),a=r(22),s=r(161),u=r(162),c=r(91),l=r(163),p="No one promise resolved";n({target:"Promise",stat:!0,forced:l},{any:function(e){var t=this,r=a("AggregateError"),n=s.f(t),l=n.resolve,f=n.reject,d=u((function(){var n=o(t.resolve),a=[],s=0,u=1,d=!1;c(e,(function(e){var o=s++,c=!1;u++,i(n,t,e).then((function(e){c||d||(d=!0,l(e))}),(function(e){c||d||(c=!0,a[o]=e,--u||f(new r(a,p)))}))})),--u||f(new r(a,p))}));return d.error&&f(d.value),n.promise}})},function(t,r,n){var i=n(29),o=TypeError,a=function(t){var r,n;this.promise=new t((function(t,i){if(r!==e||n!==e)throw new o("Bad Promise constructor");r=t,n=i})),this.resolve=i(r),this.reject=i(n)};t.exports.f=function(e){return new a(e)}},function(e,t,r){e.exports=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}}},function(t,r,n){var i=n(164),o=n(165),a=n(166).CONSTRUCTOR;t.exports=a||!o((function(t){i.all(t).then(e,(function(){}))}))},function(e,t,r){var n=r(3);e.exports=n.Promise},function(e,t,r){var n=r(32)("iterator"),i=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){i=!0}};a[n]=function(){return this},Array.from(a,(function(){throw 2}))}catch(s){}e.exports=function(e,t){try{if(!t&&!i)return!1}catch(s){return!1}var r=!1;try{var o={};o[n]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(s){}return r}},function(e,t,r){var n=r(3),i=r(164),o=r(20),a=r(66),s=r(49),u=r(32),c=r(128),l=r(35),p=r(26),f=i&&i.prototype,d=u("species"),y=!1,h=o(n.PromiseRejectionEvent),v=a("Promise",(function(){var e=s(i),t=e!==String(i);if(!t&&66===p)return!0;if(l&&(!f.catch||!f.finally))return!0;if(!p||p<51||!/native code/.test(e)){var r=new i((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[d]=n,!(y=r.then((function(){}))instanceof n))return!0}return!(t||"BROWSER"!==c&&"DENO"!==c||h)}));e.exports={CONSTRUCTOR:v,REJECTION_EVENT:h,SUBCLASSING:y}},function(t,r,n){var i=n(2),o=n(3),a=n(67),s=n(168),u=n(161),c=n(29),l=n(162),p=o.Promise,f=!1;i({target:"Promise",stat:!0,forced:!p||!p.try||l((function(){p.try((function(e){f=8===e}),8)})).error||!f},{try:function(t){var r=arguments.length>1?s(arguments,1):[],n=u.f(this),i=l((function(){return a(c(t),e,r)}));return(i.error?n.reject:n.resolve)(i.value),n.promise}})},function(e,t,r){var n=r(13);e.exports=n([].slice)},function(e,t,r){var n=r(2),i=r(161);n({target:"Promise",stat:!0},{withResolvers:function(){var e=i.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}})},function(e,t,r){var n=r(2),i=r(3),o=r(171);n({global:!0},{Reflect:{}}),o(i.Reflect,"Reflect",!0)},function(e,t,r){var n=r(43).f,i=r(37),o=r(32)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!i(e,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){var n=r(3),i=r(5),o=r(118),a=r(173),s=r(6),u=n.RegExp,c=u.prototype;i&&s((function(){var e=!0;try{u(".","d")}catch(s){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(o.hasIndices="d"),o)i(a,o[a]);return Object.getOwnPropertyDescriptor(c,"flags").get.call(t)!==n||r!==n}))&&o(c,"flags",{configurable:!0,get:a})},function(e,t,r){var n=r(45);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},function(e,t,r){var n=r(2),i=r(175);n({target:"Set",proto:!0,real:!0,forced:!r(183)("difference")},{difference:i})},function(e,t,r){var n=r(176),i=r(177),o=r(178),a=r(181),s=r(182),u=r(179),c=r(180),l=i.has,p=i.remove;e.exports=function(e){var t=n(this),r=s(e),i=o(t);return a(t)<=r.size?u(t,(function(e){r.includes(e)&&p(i,e)})):c(r.getIterator(),(function(e){l(t,e)&&p(i,e)})),i}},function(e,t,r){var n=r(177).has;e.exports=function(e){return n(e),e}},function(e,t,r){var n=r(13),i=Set.prototype;e.exports={Set:Set,add:n(i.add),has:n(i.has),remove:n(i.delete),proto:i}},function(e,t,r){var n=r(177),i=r(179),o=n.Set,a=n.add;e.exports=function(e){var t=new o;return i(e,(function(e){a(t,e)})),t}},function(e,t,r){var n=r(13),i=r(180),o=r(177),a=o.Set,s=o.proto,u=n(s.forEach),c=n(s.keys),l=c(new a).next;e.exports=function(e,t,r){return r?i({iterator:c(e),next:l},t):u(e,t)}},function(t,r,n){var i=n(7);t.exports=function(t,r,n){for(var o,a,s=n?t:t.iterator,u=t.next;!(o=i(u,s)).done;)if((a=r(o.value))!==e)return a}},function(e,t,r){var n=r(70),i=r(177);e.exports=n(i.proto,"size","get")||function(e){return e.size}},function(e,t,r){var n=r(29),i=r(45),o=r(7),a=r(60),s=r(136),u="Invalid size",c=RangeError,l=TypeError,p=Math.max,f=function(e,t){this.set=e,this.size=p(t,0),this.has=n(e.has),this.keys=n(e.keys)};f.prototype={getIterator:function(){return s(i(o(this.keys,this.set)))},includes:function(e){return o(this.has,this.set,e)}},e.exports=function(e){i(e);var t=+e.size;if(t!=t)throw new l(u);var r=a(t);if(r<0)throw new c(u);return new f(e,r)}},function(e,t,r){var n=r(22),i=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};e.exports=function(e){var t=n("Set");try{(new t)[e](i(0));try{return(new t)[e](i(-1)),!1}catch(r){return!0}}catch(o){return!1}}},function(e,t,r){var n=r(2),i=r(6),o=r(185);n({target:"Set",proto:!0,real:!0,forced:!r(183)("intersection")||i((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}))},{intersection:o})},function(e,t,r){var n=r(176),i=r(177),o=r(181),a=r(182),s=r(179),u=r(180),c=i.Set,l=i.add,p=i.has;e.exports=function(e){var t=n(this),r=a(e),i=new c;return o(t)>r.size?u(r.getIterator(),(function(e){p(t,e)&&l(i,e)})):s(t,(function(e){r.includes(e)&&l(i,e)})),i}},function(e,t,r){var n=r(2),i=r(187);n({target:"Set",proto:!0,real:!0,forced:!r(183)("isDisjointFrom")},{isDisjointFrom:i})},function(e,t,r){var n=r(176),i=r(177).has,o=r(181),a=r(182),s=r(179),u=r(180),c=r(98);e.exports=function(e){var t=n(this),r=a(e);if(o(t)<=r.size)return!1!==s(t,(function(e){if(r.includes(e))return!1}),!0);var l=r.getIterator();return!1!==u(l,(function(e){if(i(t,e))return c(l,"normal",!1)}))}},function(e,t,r){var n=r(2),i=r(189);n({target:"Set",proto:!0,real:!0,forced:!r(183)("isSubsetOf")},{isSubsetOf:i})},function(e,t,r){var n=r(176),i=r(181),o=r(179),a=r(182);e.exports=function(e){var t=n(this),r=a(e);return!(i(t)>r.size)&&!1!==o(t,(function(e){if(!r.includes(e))return!1}),!0)}},function(e,t,r){var n=r(2),i=r(191);n({target:"Set",proto:!0,real:!0,forced:!r(183)("isSupersetOf")},{isSupersetOf:i})},function(e,t,r){var n=r(176),i=r(177).has,o=r(181),a=r(182),s=r(180),u=r(98);e.exports=function(e){var t=n(this),r=a(e);if(o(t)<r.size)return!1;var c=r.getIterator();return!1!==s(c,(function(e){if(!i(t,e))return u(c,"normal",!1)}))}},function(e,t,r){var n=r(2),i=r(193);n({target:"Set",proto:!0,real:!0,forced:!r(183)("symmetricDifference")},{symmetricDifference:i})},function(e,t,r){var n=r(176),i=r(177),o=r(178),a=r(182),s=r(180),u=i.add,c=i.has,l=i.remove;e.exports=function(e){var t=n(this),r=a(e).getIterator(),i=o(t);return s(r,(function(e){c(t,e)?l(i,e):u(i,e)})),i}},function(e,t,r){var n=r(2),i=r(195);n({target:"Set",proto:!0,real:!0,forced:!r(183)("union")},{union:i})},function(e,t,r){var n=r(176),i=r(177).add,o=r(178),a=r(182),s=r(180);e.exports=function(e){var t=n(this),r=a(e).getIterator(),u=o(t);return s(r,(function(e){i(u,e)})),u}},function(t,r,n){var i=n(2),o=n(13),a=n(15),s=n(60),u=n(76),c=n(6),l=o("".charAt);i({target:"String",proto:!0,forced:c((function(){return"\ud842"!=="𠮷".at(-2)}))},{at:function(t){var r=u(a(this)),n=r.length,i=s(t),o=i>=0?i:n+i;return o<0||o>=n?e:l(r,o)}})},function(e,t,r){var n=r(2),i=r(13),o=r(15),a=r(76),s=i("".charCodeAt);n({target:"String",proto:!0},{isWellFormed:function(){for(var e=a(o(this)),t=e.length,r=0;r<t;r++){var n=s(e,r);if(55296==(63488&n)&&(n>=56320||++r>=t||56320!=(64512&s(e,r))))return!1}return!0}})},function(t,r,n){var i=n(2),o=n(7),a=n(13),s=n(15),u=n(20),c=n(16),l=n(199),p=n(76),f=n(28),d=n(200),y=n(201),h=n(32),v=n(35),g=h("replace"),_=TypeError,O=a("".indexOf),b=a("".replace),m=a("".slice),T=Math.max;i({target:"String",proto:!0},{replaceAll:function(t,r){var n,i,a,h,k,S,E,P,w,L,A=s(this),D=0,I="";if(!c(t)){if((n=l(t))&&(i=p(s(d(t))),!~O(i,"g")))throw new _("`.replaceAll` does not allow non-global regexes");if(a=f(t,g))return o(a,t,A,r);if(v&&n)return b(p(A),t,r)}for(h=p(A),k=p(t),(S=u(r))||(r=p(r)),E=k.length,P=T(1,E),w=O(h,k);-1!==w;)L=S?p(r(k,w,h)):y(k,h,w,[],e,r),I+=m(h,D,w)+L,D=w+E,w=w+P>h.length?-1:O(h,k,w+P);return D<h.length&&(I+=m(h,D)),I}})},function(t,r,n){var i=n(19),o=n(14),a=n(32)("match");t.exports=function(t){var r;return i(t)&&((r=t[a])!==e?!!r:"RegExp"===o(t))}},function(t,r,n){var i=n(7),o=n(37),a=n(23),s=n(173),u=RegExp.prototype;t.exports=function(t){var r=t.flags;return r!==e||"flags"in u||o(t,"flags")||!a(u,t)?r:i(s,t)}},function(t,r,n){var i=n(13),o=n(38),a=Math.floor,s=i("".charAt),u=i("".replace),c=i("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,p=/\$([$&'`]|\d{1,2})/g;t.exports=function(t,r,n,i,f,d){var y=n+t.length,h=i.length,v=p;return f!==e&&(f=o(f),v=l),u(d,v,(function(o,u){var l;switch(s(u,0)){case"$":return"$";case"&":return t;case"`":return c(r,0,n);case"'":return c(r,y);case"<":l=f[c(u,1,-1)];break;default:var p=+u;if(0===p)return o;if(p>h){var d=a(p/10);return 0===d?o:d<=h?i[d-1]===e?s(u,1):i[d-1]+s(u,1):o}l=i[p-1]}return l===e?"":l}))}},function(e,t,r){var n=r(2),i=r(7),o=r(13),a=r(15),s=r(76),u=r(6),c=Array,l=o("".charAt),p=o("".charCodeAt),f=o([].join),d="".toWellFormed,y=d&&u((function(){return"1"!==i(d,1)}));n({target:"String",proto:!0,forced:y},{toWellFormed:function(){var e=s(a(this));if(y)return i(d,e);for(var t=e.length,r=c(t),n=0;n<t;n++){var o=p(e,n);55296!=(63488&o)?r[n]=l(e,n):o>=56320||n+1>=t||56320!=(64512&p(e,n+1))?r[n]="�":(r[n]=l(e,n),r[++n]=l(e,n))}return f(r,"")}})},function(t,r,n){var i=n(204),o=n(62),a=n(60),s=i.aTypedArray;(0,i.exportTypedArrayMethod)("at",(function(t){var r=s(this),n=o(r),i=a(t),u=i>=0?i:n+i;return u<0||u>=n?e:r[u]}))},function(t,r,n){var i,o,a,s=n(205),u=n(5),c=n(3),l=n(20),p=n(19),f=n(37),d=n(77),y=n(30),h=n(42),v=n(46),g=n(118),_=n(23),O=n(85),b=n(69),m=n(32),T=n(39),k=n(50),S=k.enforce,E=k.get,P=c.Int8Array,w=P&&P.prototype,L=c.Uint8ClampedArray,A=L&&L.prototype,D=P&&O(P),I=w&&O(w),C=Object.prototype,R=c.TypeError,j=m("toStringTag"),M=T("TYPED_ARRAY_TAG"),N="TypedArrayConstructor",F=s&&!!b&&"Opera"!==d(c.opera),x=!1,U={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},z={BigInt64Array:8,BigUint64Array:8},B=function(e){var t=O(e);if(p(t)){var r=E(t);return r&&f(r,N)?r[N]:B(t)}},V=function(e){if(!p(e))return!1;var t=d(e);return f(U,t)||f(z,t)};for(i in U)(a=(o=c[i])&&o.prototype)?S(a)[N]=o:F=!1;for(i in z)(a=(o=c[i])&&o.prototype)&&(S(a)[N]=o);if((!F||!l(D)||D===Function.prototype)&&(D=function(){throw new R("Incorrect invocation")},F))for(i in U)c[i]&&b(c[i],D);if((!F||!I||I===C)&&(I=D.prototype,F))for(i in U)c[i]&&b(c[i].prototype,I);if(F&&O(A)!==I&&b(A,I),u&&!f(I,j))for(i in x=!0,g(I,j,{configurable:!0,get:function(){return p(this)?this[M]:e}}),U)c[i]&&h(c[i],M,i);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:F,TYPED_ARRAY_TAG:x&&M,aTypedArray:function(e){if(V(e))return e;throw new R("Target is not a typed array")},aTypedArrayConstructor:function(e){if(l(e)&&(!b||_(D,e)))return e;throw new R(y(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(u){if(r)for(var i in U){var o=c[i];if(o&&f(o.prototype,e))try{delete o.prototype[e]}catch(a){try{o.prototype[e]=t}catch(s){}}}I[e]&&!r||v(I,e,r?t:F&&w[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(u){if(b){if(r)for(n in U)if((i=c[n])&&f(i,e))try{delete i[e]}catch(o){}if(D[e]&&!r)return;try{return v(D,e,r?t:F&&D[e]||t)}catch(o){}}for(n in U)!(i=c[n])||i[e]&&!r||v(i,e,t)}},getTypedArrayConstructor:B,isView:function(e){if(!p(e))return!1;var t=d(e);return"DataView"===t||f(U,t)||f(z,t)},isTypedArray:V,TypedArray:D,TypedArrayPrototype:I}},function(e,t,r){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},function(t,r,n){var i=n(204),o=n(103).findLast,a=i.aTypedArray;(0,i.exportTypedArrayMethod)("findLast",(function(t){return o(a(this),t,arguments.length>1?arguments[1]:e)}))},function(t,r,n){var i=n(204),o=n(103).findLastIndex,a=i.aTypedArray;(0,i.exportTypedArrayMethod)("findLastIndex",(function(t){return o(a(this),t,arguments.length>1?arguments[1]:e)}))},function(t,r,n){var i=n(3),o=n(7),a=n(204),s=n(62),u=n(209),c=n(38),l=n(6),p=i.RangeError,f=i.Int8Array,d=f&&f.prototype,y=d&&d.set,h=a.aTypedArray,v=a.exportTypedArrayMethod,g=!l((function(){var e=new Uint8ClampedArray(2);return o(y,e,{length:1,0:3},1),3!==e[1]})),_=g&&a.NATIVE_ARRAY_BUFFER_VIEWS&&l((function(){var e=new f(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));v("set",(function(t){h(this);var r=u(arguments.length>1?arguments[1]:e,1),n=c(t);if(g)return o(y,this,n,r);var i=this.length,a=s(n),l=0;if(a+r>i)throw new p("Wrong length");for(;l<a;)this[r+l]=n[l++]}),!g||_)},function(e,t,r){var n=r(138),i=RangeError;e.exports=function(e,t){var r=n(e);if(r%t)throw new i("Wrong offset");return r}},function(e,t,r){var n=r(110),i=r(204),o=i.aTypedArray,a=i.exportTypedArrayMethod,s=i.getTypedArrayConstructor;a("toReversed",(function(){return n(o(this),s(this))}))},function(t,r,n){var i=n(204),o=n(13),a=n(29),s=n(112),u=i.aTypedArray,c=i.getTypedArrayConstructor,l=i.exportTypedArrayMethod,p=o(i.TypedArrayPrototype.sort);l("toSorted",(function(t){t!==e&&a(t);var r=u(this),n=s(c(r),r);return p(n,t)}))},function(e,t,r){var n=r(116),i=r(204),o=r(213),a=r(60),s=r(214),u=i.aTypedArray,c=i.getTypedArrayConstructor,l=i.exportTypedArrayMethod,p=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();l("with",{with:function(e,t){var r=u(this),i=a(e),l=o(r)?s(t):+t;return n(r,c(r),i,l)}}.with,!p)},function(e,t,r){var n=r(77);e.exports=function(e){var t=n(e);return"BigInt64Array"===t||"BigUint64Array"===t}},function(e,t,r){var n=r(18),i=TypeError;e.exports=function(e){var t=n(e,"number");if("number"==typeof t)throw new i("Can't convert number to bigint");return BigInt(t)}},function(t,r,n){var i=n(2),o=n(3),a=n(22),s=n(10),u=n(43).f,c=n(37),l=n(132),p=n(74),f=n(75),d=n(216),y=n(81),h=n(5),v=n(35),g="DOMException",_=a("Error"),O=a(g),b=function(){l(this,m);var t=arguments.length,r=f(t<1?e:arguments[0]),n=f(t<2?e:arguments[1],"Error"),i=new O(r,n),o=new _(r);return o.name=g,u(i,"stack",s(1,y(o.stack,1))),p(i,this,b),i},m=b.prototype=O.prototype,T="stack"in new _(g),k="stack"in new O(1,2),S=O&&h&&Object.getOwnPropertyDescriptor(o,g),E=!(!S||S.writable&&S.configurable),P=T&&!E&&!k;i({global:!0,constructor:!0,forced:v||P},{DOMException:P?b:O});var w=a(g),L=w.prototype;if(L.constructor!==w)for(var A in v||u(L,"constructor",s(1,w)),d)if(c(d,A)){var D=d[A],I=D.s;c(w,I)||u(w,I,s(6,D.c))}},function(e,t,r){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},function(e,t,r){r(218),r(222)},function(e,t,r){var n=r(2),i=r(3),o=r(219).clear;n({global:!0,bind:!0,enumerable:!0,forced:i.clearImmediate!==o},{clearImmediate:o})},function(t,r,n){var i,o,a,s,u=n(3),c=n(67),l=n(92),p=n(20),f=n(37),d=n(6),y=n(90),h=n(168),v=n(41),g=n(220),_=n(221),O=n(127),b=u.setImmediate,m=u.clearImmediate,T=u.process,k=u.Dispatch,S=u.Function,E=u.MessageChannel,P=u.String,w=0,L={},A="onreadystatechange";d((function(){i=u.location}));var D=function(e){if(f(L,e)){var t=L[e];delete L[e],t()}},I=function(e){return function(){D(e)}},C=function(e){D(e.data)},R=function(e){u.postMessage(P(e),i.protocol+"//"+i.host)};b&&m||(b=function(t){g(arguments.length,1);var r=p(t)?t:S(t),n=h(arguments,1);return L[++w]=function(){c(r,e,n)},o(w),w},m=function(e){delete L[e]},O?o=function(e){T.nextTick(I(e))}:k&&k.now?o=function(e){k.now(I(e))}:E&&!_?(s=(a=new E).port2,a.port1.onmessage=C,o=l(s.postMessage,s)):u.addEventListener&&p(u.postMessage)&&!u.importScripts&&i&&"file:"!==i.protocol&&!d(R)?(o=R,u.addEventListener("message",C,!1)):o=A in v("script")?function(e){y.appendChild(v("script"))[A]=function(){y.removeChild(this),D(e)}}:function(e){setTimeout(I(e),0)}),t.exports={set:b,clear:m}},function(e,t,r){var n=TypeError;e.exports=function(e,t){if(e<t)throw new n("Not enough arguments");return e}},function(e,t,r){var n=r(27);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},function(e,t,r){var n=r(2),i=r(3),o=r(219).set,a=r(223),s=i.setImmediate?a(o,!1):o;n({global:!0,bind:!0,enumerable:!0,forced:i.setImmediate!==s},{setImmediate:s})},function(e,t,r){var n,i=r(3),o=r(67),a=r(20),s=r(128),u=r(27),c=r(168),l=r(220),p=i.Function,f=/MSIE .\./.test(u)||"BUN"===s&&((n=i.Bun.version.split(".")).length<3||"0"===n[0]&&(n[1]<3||"3"===n[1]&&"0"===n[2]));e.exports=function(e,t){var r=t?2:1;return f?function(n,i){var s=l(arguments.length,1)>r,u=a(n)?n:p(n),f=s?c(arguments,r):[],d=s?function(){o(u,this,f)}:u;return t?e(d,i):e(d)}:e}},function(e,t,r){var n=r(2),i=r(3),o=r(118),a=r(5),s=TypeError,u=Object.defineProperty,c=i.self!==i;try{if(a){var l=Object.getOwnPropertyDescriptor(i,"self");!c&&l&&l.get&&l.enumerable||o(i,"self",{get:function(){return i},set:function(e){if(this!==i)throw new s("Illegal invocation");u(i,"self",{value:e,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})}else n({global:!0,simple:!0,forced:c},{self:i})}catch(p){}},function(t,r,n){var i,o=n(35),a=n(2),s=n(3),u=n(22),c=n(13),l=n(6),p=n(39),f=n(20),d=n(226),y=n(16),h=n(19),v=n(21),g=n(91),_=n(45),O=n(77),b=n(37),m=n(133),T=n(42),k=n(62),S=n(220),E=n(200),P=n(157),w=n(177),L=n(179),A=n(125),D=n(82),I=n(129),C=s.Object,R=s.Array,j=s.Date,M=s.Error,N=s.TypeError,F=s.PerformanceMark,x=u("DOMException"),U=P.Map,z=P.has,B=P.get,V=P.set,G=w.Set,K=w.add,W=w.has,q=u("Object","keys"),Q=c([].push),H=c((!0).valueOf),Y=c(1..valueOf),J=c("".valueOf),Z=c(j.prototype.getTime),X=p("structuredClone"),$="DataCloneError",ee="Transferring",te=function(e){return!l((function(){var t=new s.Set([7]),r=e(t),n=e(C(7));return r===t||!r.has(7)||!h(n)||7!=+n}))&&e},re=function(e,t){return!l((function(){var r=new t,n=e({a:r,b:r});return!(n&&n.a===n.b&&n.a instanceof t&&n.a.stack===r.stack)}))},ne=s.structuredClone,ie=o||!re(ne,M)||!re(ne,x)||(i=ne,!!l((function(){var e=i(new s.AggregateError([1],X,{cause:3}));return"AggregateError"!==e.name||1!==e.errors[0]||e.message!==X||3!==e.cause}))),oe=!ne&&te((function(e){return new F(X,{detail:e}).detail})),ae=te(ne)||oe,se=function(e){throw new x("Uncloneable type: "+e,$)},ue=function(e,t){throw new x((t||"Cloning")+" of "+e+" cannot be properly polyfilled in this engine",$)},ce=function(e,t){return ae||ue(t),ae(e)},le=function(t,r,n){if(z(r,t))return B(r,t);var i,o,a,u,c,l;if("SharedArrayBuffer"===(n||O(t)))i=ae?ae(t):t;else{var p=s.DataView;p||f(t.slice)||ue("ArrayBuffer");try{if(f(t.slice)&&!t.resizable)i=t.slice(0);else{o=t.byteLength,a="maxByteLength"in t?{maxByteLength:t.maxByteLength}:e,i=new ArrayBuffer(o,a),u=new p(t),c=new p(i);for(l=0;l<o;l++)c.setUint8(l,u.getUint8(l))}}catch(d){throw new x("ArrayBuffer is detached",$)}}return V(r,t,i),i},pe=function(t,r){if(v(t)&&se("Symbol"),!h(t))return t;if(r){if(z(r,t))return B(r,t)}else r=new U;var n,i,o,a,c,l,p,d,y=O(t);switch(y){case"Array":o=R(k(t));break;case"Object":o={};break;case"Map":o=new U;break;case"Set":o=new G;break;case"RegExp":o=new RegExp(t.source,E(t));break;case"Error":switch(i=t.name){case"AggregateError":o=new(u(i))([]);break;case"EvalError":case"RangeError":case"ReferenceError":case"SuppressedError":case"SyntaxError":case"TypeError":case"URIError":o=new(u(i));break;case"CompileError":case"LinkError":case"RuntimeError":o=new(u("WebAssembly",i));break;default:o=new M}break;case"DOMException":o=new x(t.message,t.name);break;case"ArrayBuffer":case"SharedArrayBuffer":o=le(t,r,y);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":l="DataView"===y?t.byteLength:t.length,o=function(e,t,r,n,i){var o=s[t];return h(o)||ue(t),new o(le(e.buffer,i),r,n)}(t,y,t.byteOffset,l,r);break;case"DOMQuad":try{o=new DOMQuad(pe(t.p1,r),pe(t.p2,r),pe(t.p3,r),pe(t.p4,r))}catch(g){o=ce(t,y)}break;case"File":if(ae)try{o=ae(t),O(o)!==y&&(o=e)}catch(g){}if(!o)try{o=new File([t],t.name,t)}catch(g){}o||ue(y);break;case"FileList":if(a=function(){var e;try{e=new s.DataTransfer}catch(g){try{e=new s.ClipboardEvent("").clipboardData}catch(t){}}return e&&e.items&&e.files?e:null}()){for(c=0,l=k(t);c<l;c++)a.items.add(pe(t[c],r));o=a.files}else o=ce(t,y);break;case"ImageData":try{o=new ImageData(pe(t.data,r),t.width,t.height,{colorSpace:t.colorSpace})}catch(g){o=ce(t,y)}break;default:if(ae)o=ae(t);else switch(y){case"BigInt":o=C(t.valueOf());break;case"Boolean":o=C(H(t));break;case"Number":o=C(Y(t));break;case"String":o=C(J(t));break;case"Date":o=new j(Z(t));break;case"Blob":try{o=t.slice(0,t.size,t.type)}catch(g){ue(y)}break;case"DOMPoint":case"DOMPointReadOnly":n=s[y];try{o=n.fromPoint?n.fromPoint(t):new n(t.x,t.y,t.z,t.w)}catch(g){ue(y)}break;case"DOMRect":case"DOMRectReadOnly":n=s[y];try{o=n.fromRect?n.fromRect(t):new n(t.x,t.y,t.width,t.height)}catch(g){ue(y)}break;case"DOMMatrix":case"DOMMatrixReadOnly":n=s[y];try{o=n.fromMatrix?n.fromMatrix(t):new n(t)}catch(g){ue(y)}break;case"AudioData":case"VideoFrame":f(t.clone)||ue(y);try{o=t.clone()}catch(g){se(y)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":ue(y);default:se(y)}}switch(V(r,t,o),y){case"Array":case"Object":for(p=q(t),c=0,l=k(p);c<l;c++)d=p[c],m(o,d,pe(t[d],r));break;case"Map":t.forEach((function(e,t){V(o,pe(t,r),pe(e,r))}));break;case"Set":t.forEach((function(e){K(o,pe(e,r))}));break;case"Error":T(o,"message",pe(t.message,r)),b(t,"cause")&&T(o,"cause",pe(t.cause,r)),"AggregateError"===i?o.errors=pe(t.errors,r):"SuppressedError"===i&&(o.error=pe(t.error,r),o.suppressed=pe(t.suppressed,r));case"DOMException":D&&T(o,"stack",pe(t.stack,r))}return o};a({global:!0,enumerable:!0,sham:!I,forced:ie},{structuredClone:function(t){var r,n,i=S(arguments.length,1)>1&&!y(arguments[1])?_(arguments[1]):e,o=i?i.transfer:e;o!==e&&(n=function(t,r){if(!h(t))throw new N("Transfer option cannot be converted to a sequence");var n=[];g(t,(function(e){Q(n,_(e))}));for(var i,o,a,u,c,l=0,p=k(n),y=new G;l<p;){if(i=n[l++],"ArrayBuffer"===(o=O(i))?W(y,i):z(r,i))throw new x("Duplicate transferable",$);if("ArrayBuffer"!==o){if(I)u=ne(i,{transfer:[i]});else switch(o){case"ImageBitmap":a=s.OffscreenCanvas,d(a)||ue(o,ee);try{(c=new a(i.width,i.height)).getContext("bitmaprenderer").transferFromImageBitmap(i),u=c.transferToImageBitmap()}catch(v){}break;case"AudioData":case"VideoFrame":f(i.clone)&&f(i.close)||ue(o,ee);try{u=i.clone(),i.close()}catch(v){}break;case"MediaSourceHandle":case"MessagePort":case"MIDIAccess":case"OffscreenCanvas":case"ReadableStream":case"RTCDataChannel":case"TransformStream":case"WebTransportReceiveStream":case"WebTransportSendStream":case"WritableStream":ue(o,ee)}if(u===e)throw new x("This object cannot be transferred: "+o,$);V(r,i,u)}else K(y,i)}return y}(o,r=new U));var a=pe(t,r);return n&&function(e){L(e,(function(e){I?ae(e,{transfer:[e]}):f(e.transfer)?e.transfer():A?A(e):ue("ArrayBuffer",ee)}))}(n),a}})},function(e,t,r){var n=r(13),i=r(6),o=r(20),a=r(77),s=r(22),u=r(49),c=function(){},l=s("Reflect","construct"),p=/^\s*(?:class|function)\b/,f=n(p.exec),d=!p.test(c),y=function(e){if(!o(e))return!1;try{return l(c,[],e),!0}catch(t){return!1}},h=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!f(p,u(e))}catch(t){return!0}};h.sham=!0,e.exports=!l||i((function(){var e;return y(y.call)||!y(Object)||!y((function(){e=!0}))||e}))?h:y},function(t,r,n){var i=n(2),o=n(22),a=n(6),s=n(220),u=n(76),c=n(228),l=o("URL"),p=c&&a((function(){l.canParse()})),f=a((function(){return 1!==l.canParse.length}));i({target:"URL",stat:!0,forced:!p||f},{canParse:function(t){var r=s(arguments.length,1),n=u(t),i=r<2||arguments[1]===e?e:u(arguments[1]);try{return!!new l(n,i)}catch(o){return!1}}})},function(t,r,n){var i=n(6),o=n(32),a=n(5),s=n(35),u=o("iterator");t.exports=!i((function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return t.pathname="c%20d",r.forEach((function(e,t){r.delete("b"),i+=t+e})),n.delete("a",2),n.delete("b",e),s&&(!t.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",e)||n.has("b"))||!r.size&&(s||!a)||!r.sort||"https://a/c%20d?a=1&c=3"!==t.href||"3"!==r.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!r[u]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://тест").host||"#%D0%B1"!==new URL("https://a#б").hash||"a1c3"!==i||"x"!==new URL("https://x",e).host}))},function(t,r,n){var i=n(2),o=n(22),a=n(220),s=n(76),u=n(228),c=o("URL");i({target:"URL",stat:!0,forced:!u},{parse:function(t){var r=a(arguments.length,1),n=s(t),i=r<2||arguments[1]===e?e:s(arguments[1]);try{return new c(n,i)}catch(o){return null}}})},function(t,r,n){var i=n(46),o=n(13),a=n(76),s=n(220),u=URLSearchParams,c=u.prototype,l=o(c.append),p=o(c.delete),f=o(c.forEach),d=o([].push),y=new u("a=1&a=2&b=3");y.delete("a",1),y.delete("b",e),y+""!="a=2"&&i(c,"delete",(function(t){var r=arguments.length,n=r<2?e:arguments[1];if(r&&n===e)return p(this,t);var i=[];f(this,(function(e,t){d(i,{key:t,value:e})})),s(r,1);for(var o,u=a(t),c=a(n),y=0,h=0,v=!1,g=i.length;y<g;)o=i[y++],v||o.key===u?(v=!0,p(this,o.key)):h++;for(;h<g;)(o=i[h++]).key===u&&o.value===c||l(this,o.key,o.value)}),{enumerable:!0,unsafe:!0})},function(t,r,n){var i=n(46),o=n(13),a=n(76),s=n(220),u=URLSearchParams,c=u.prototype,l=o(c.getAll),p=o(c.has),f=new u("a=1");!f.has("a",2)&&f.has("a",e)||i(c,"has",(function(t){var r=arguments.length,n=r<2?e:arguments[1];if(r&&n===e)return p(this,t);var i=l(this,t);s(r,1);for(var o=a(n),u=0;u<i.length;)if(i[u++]===o)return!0;return!1}),{enumerable:!0,unsafe:!0})},function(e,t,r){var n=r(5),i=r(13),o=r(118),a=URLSearchParams.prototype,s=i(a.forEach);n&&!("size"in a)&&o(a,"size",{get:function(){var e=0;return s(this,(function(){e++})),e},configurable:!0,enumerable:!0})}],r={},(n=function(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}).m=t,n.c=r,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}(),System.register("ig-trading-charts",["eventemitter3","lodash"],(function(e,t){var r={},n={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(n,"__esModule",{value:!0}),{setters:[function(e){Object.keys(e).forEach((function(t){r[t]=e[t]}))},function(e){Object.keys(e).forEach((function(t){n[t]=e[t]}))}],execute:function(){e((()=>{var e={32199:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AbortController:()=>i,default:()=>n});var n=fetch,i=AbortController},55469:(e,t,r)=>{var n,i;n=[r(43130),r(32199),r(6686)],i=function(e,t,r){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=160)}([function(t,r){t.exports=e},function(e,t,r){var n,i;n=[t,r(123),r(83),r(1)],i=function(e,t,r,n){"use strict";function i(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);return t.url=e.url,t.status=e.status,t.statusText=e.statusText,t.body=e.body,e.json().then((function(e){return t.response=e})).finally((function(){throw t}))}function o(e){return e.clone().text().then((function(t){return t?e.json():e.text()}))}function a(e,n,a){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=""+a.environment.origin+e,c=n.headers=n.headers||{};return c["Content-Type"]="application/json",c["x-device-user-agent"]=c["x-device-user-agent"]||(0,t.default)(a.environment),c["X-SECURITY-TOKEN"]=a.user.ssoToken,s||(a.user.cstToken&&(c.CST=a.user.cstToken),c["IG-ACCOUNT-ID"]||(c["IG-ACCOUNT-ID"]=a.user.broker&&a.user.broker.currentAccountId||a.user.accountId)),n.preventCaching&&(u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_";t=encodeURI(t);var r=+new Date;return e+=-1===e.indexOf("?")?"?":"&",e+(t+"=")+r}(u)),(0,r.default)(u,n).then(i).then(o)}Object.defineProperty(e,"__esModule",{value:!0}),e.send=a,e.get=function(e,t,r,n){return a(e,{preventCaching:!0,headers:n},t,r)},e.post=function(e,t,r,i,o){var a={method:"POST",contentType:"application/json",body:JSON.stringify(r),headers:i,abortController:o};o&&(a.signal=o.signal);return(0,n.send)(e,a,t)},e.put=function(e,t,r,n){return a(e,{method:"PUT",body:JSON.stringify(r),headers:n},t)},e.del=function(e,t,r,i){var o={method:"DELETE"},a=e;r&&(o.body=JSON.stringify(r),o.method="PUT",a+=(e.indexOf("?")>-1?"&":"?")+"_method=DELETE");i&&(o.headers=i);return(0,n.send)(a,o,t)}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};e.default=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return function(e,n,i){for(var o=t({},e._computedMap)||Object.create(null),a=0,s=r.length;a<s;a++){var u=r[a];o[u]=(o[u]||[]).concat(n)}return e._computedMap=function(e){var t=[];return Object.keys(e).forEach((function(r){for(var n=0,i=e[r].length;n<i;n++){var o=e[r][n],a=e[o];if(a){for(var s=0,u=a.length;s<u;s++)e[r].includes(a[s])||e[r].push(a[s]);t.push(o)}}})),t.forEach((function(t){return delete e[t]})),e}(o),i}}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(0),r(19),r(10),r(8),r(9),r(126),r(32),r(17),r(14),r(30),r(3)],i=function(e,t,r,n,i,o,a,s,u,c,l,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.direction=function(e){return{field:"direction",valid:!!e.direction,error:{key:r.default.Reason.DIRECTION_NOT_SET}}},e.limit=function(e){var r=e.limitLevel,n=e.limitType,i=t.default.isNumber(r)||e.limitRequired?(0,a.default)(r,n,e.market.dealingRules&&e.market.dealingRules.maxStopOrLimitDistance,e.scalingFactor,e.decimalPlacesFactor,e.triggerLevel||(e.position?e.position.firstTierLatest:e.currentMarketLevel),e.isBuy,e.limitRequired):{isValid:!0},o=i.isValid,s=i.error;return{field:"limit",valid:o,error:s}},e.technicalIssues=function(e){return{field:"technicalIssues",valid:Boolean(e.market.displayOffer||e.market.displayBid),error:{key:r.default.Reason.TECHNICAL_ISSUES}}},e.stop=function(e){var i=e.stopType,o=void 0,a=void 0;if(function(e){return t.default.some(["stopLevel","stopType","stopStep","stopTrailingDistance","stopLevelType"],(function(r){return t.default.get(e,r,null)!==t.default.get(e,"position."+r,null)}))}(e))if(e.allowsForStopType(i)){var u=n.default.isValid(e.stopLevel,e.stopType,e.stopLevelType,(0,s.getMinimumDistanceFromMarket)(i,e.market),e.minStepDistance,e.market.dealingRules&&e.market.dealingRules.maxStopOrLimitDistance,e.scalingFactor,e.decimalPlacesFactor,e.triggerLevel||(e.position?e.position.latest:e.currentMarketLevel),e.triggerLevel||(e.position?e.position.firstTierLatest:e.currentFirstTierMarketLevel),e.isPriceInSizeEnabled,e.isBuy,e.stopStep,e.stopTrailingDistance,e.canEditTrailingDistance,e.controlledRisk,e.stopAllowed,e.position,e.market.isKnockout,e.koUnderlyingDistance,e.stopRequired,e.isUSFx,e.isOrder);o=u.isValid,a=u.error}else o=!1,a={key:r.default.Reason.INVALID_STOP_TYPE};else o=!0;return{field:"stop",valid:o,error:a}},e.controlledRiskUser=function(e){var n=!0,i={},o=e.controlledRisk,a=e.position||e.order,s=a&&t.default.isNumber(a.stopLevel)&&!t.default.isNumber(e.stopLevel);o&&s&&(n=!1,i={key:r.default.Reason.STOP_GUARANTEED_CAN_NOT_BE_REMOVED});return{field:"stop",valid:n,error:i}},e.guaranteedStopIsEmptyValidator=function(e){var i=!0,o={},a=e.stopLevel;e.stopType!==n.default.Type.GUARANTEED||t.default.isNumber(a)&&0!==a||(i=!1,o={key:r.default.Reason.STOP_GUARANTEED_CAN_NOT_BE_REMOVED});return{field:"stop",valid:i,error:o}},e.stopSizeChangeAllowed=function(e){var t=e.market.marketStatus,a=e.stopType===n.default.Type.GUARANTEED,s=!0;if(a&&(t===o.default.EDIT||t===o.default.AUCTION)){var u=e.triggerLevel||e.currentMarketLevel,c=e.decimalPlacesFactor,l=e.position||e.order;if(l){var p=i.default.distanceFrom(l.stopLevel,l.stopLevelType,u,c);s=i.default.distanceFrom(e.stopLevel,e.stopLevelType,u,c)>=p}else s=!1}return{field:"stop",valid:s,error:{key:s?null:r.default.Reason.STOP_GUARANTEED_MOVE_AWAY}}},e.marketDealable=function(e){return{field:"marketDealable",valid:e.isMarketDealable,error:{key:r.default.Reason.MARKET_NOT_DEALABLE}}},e.dateBelowMin=function(e){var t=+e.heartbeat.timestamp,n=e.expiryTime,i=e.timeInForce,o=!1;o=i?"GOOD_TILL_DATE"===i&&+n>=t:!n||+n>=t;return{field:"expiryTime",valid:o,error:{key:r.default.Reason.DATE_BELOW_MIN,data:{minDate:t}}}},e.sizeBelowMax=function(e){return{field:"size",valid:0!==e.maxSize&&(+e.size||0)<=(+e.maxSize||1/0),error:{key:r.default.Reason.SIZE_ABOVE_MAX}}},e.dmaSizeBelowMax=function(e){return{field:"size",valid:0!==e.maxSize&&(+e.size||0)<=(+e.maxSize||1/0),error:{key:r.default.Reason.SIZE_ABOVE_ORIGINAL}}},e.dmaSizeAboveFilled=function(e){return{field:"size",valid:e.size>e.filledQuantity,error:{key:r.default.Reason.SIZE_BELOW_PARTIAL}}},e.sizeAboveMin=function(e){var t=e.minDealSize&&+e.minDealSize.value;return{field:"size",valid:!t||+e.size>=t,error:{key:r.default.Reason.SIZE_BELOW_MIN,data:{min:t}}}},e.sizeAboveZero=function(e){return{field:"size",valid:+e.size>0,error:{key:r.default.Reason.SIZE_NOT_ABOVE_ZERO}}},e.shareDealingSizeAboveZero=function(e){var t=r.default.Reason.SIZE_NOT_ABOVE_ZERO;c.default.isConsideration(e.sizeUnit)&&(t=r.default.Reason.VALUE_NOT_ABOVE_ZERO);return{field:"size",valid:+e.size>0,error:{key:t}}},e.levelAboveZero=function(e){return{field:"level",valid:e.orderType===u.default.MARKET||+e.level>0,error:{key:r.default.Reason.LEVEL_REQUIRED}}},e.triggerLevelAboveZero=function(e){return{field:"triggerLevel",valid:+e.triggerLevel>0,error:{key:r.default.Reason.TRIGGER_LEVEL_REQUIRED}}},e.triggerLevelDmaCorrectIncrementTick=function(e){var t=+e.triggerLevel;if(!t||!(e.market&&e.market.dmaMarketData&&e.market.dmaMarketData.rangeData))return{field:"triggerLevel",valid:!0,error:null};var n=(o=e.market.dmaMarketData.rangeData,a=t,o.find((function(e){return a>=e.start&&a<=e.end})).step),i=Math.abs(t/n-Math.round(t/n))<1e-6;var o,a;return{field:"triggerLevel",valid:t&&i,error:{key:r.default.Reason.TRIGGER_LEVEL_INVALID_TICK,data:{step:n}}}},e.triggerLevelAboveZeroForNonMarketOrder=function(e){var t=e.orderType===u.default.MARKET;return{field:"triggerLevel",valid:t||+e.triggerLevel>0,error:t?null:{key:r.default.Reason.TRIGGER_LEVEL_REQUIRED}}},e.triggerLevelAboveZeroForLimitOrder=function(e){var t=e.orderType&&e.orderType.includes("LIMIT");return{field:"triggerLevel",valid:!t||t&&+e.triggerLevel>0,error:{key:r.default.Reason.TRIGGER_LEVEL_REQUIRED}}},e.stopPriceAboveZeroForStopOrder=function(e){var t=e.orderType&&e.orderType.includes("STOP");return{field:"stop",valid:!t||t&&+e.stopPrice>0,error:{key:r.default.Reason.STOP_REQUIRES_LEVEL}}},e.stopPriceNotInRangeOfBidOfferPrice=function(e){var t=e.orderType&&e.orderType.includes("STOP"),n="sell"===e.direction,i=+e.stopPrice,o=!!i,a=void 0;t&&(n?(o&=+e.stopPrice<e.market.bid,a=r.default.Reason.STOP_LEVEL_SELL_ABOVE_BID):(o&=+e.stopPrice>e.market.offer,a=r.default.Reason.STOP_LEVEL_BUY_BELOW_OFFER));return{field:"stop",valid:Boolean(!t||!i||o),error:{key:a}}},e.stopPriceRightSideOfBidOfferPriceForDMATicket=function(e){var t=e.orderType===u.default.STOP,n=+e.triggerLevel,i=!0,o=null;t&&n&&(e.isSell?(i=e.triggerLevel<=e.market.bid,o={key:r.default.Reason.STOP_LEVEL_SELL_ABOVE_BID}):(i=e.triggerLevel>=e.market.offer,o={key:r.default.Reason.STOP_LEVEL_BUY_BELOW_OFFER}));return{field:"triggerLevel",valid:i,error:o}},e.triggerLevelValidForOrderType=function(e){var t=!1,n=void 0;if(e.order){var i=e.currentMarketLevel,o=e.triggerLevel;n=e.order.level<i?(t=o<i)?null:{key:r.default.Reason.TRIGGER_LEVEL_TOO_HIGH}:(t=o>i)?null:{key:r.default.Reason.TRIGGER_LEVEL_TOO_LOW}}else t=!1;return{field:"triggerLevel",valid:t,error:n}},e.triggerLevelWithinValidDistance=function(e){var t=e.currentMarketLevel,n=e.triggerLevel,i=e.maxOrderDistance;return{field:"triggerLevel",valid:!i||n>=t-i.value&&n<=t+i.value,error:{key:r.default.Reason.TRIGGER_LEVEL_TOO_FAR}}},e.orderTypeLimitForOption=function(e){return{field:"triggerLevel",valid:!e.isOptionOrderEnabled||!e.market.isOption||"LIMIT"===e.orderType,error:{key:r.default.Reason.ORDER_TYPE_NOT_LIMIT_FOR_OPTION}}},e.controlledRiskTradingAvailable=function(e){return{field:"marketDealable",valid:e.market.isLimitedRisk||!(e.controlledRisk&&!e.market.guaranteedStopsAllowed),error:{key:r.default.Reason.CONTROLLED_RISK_TRADING_UNAVAILABLE}}},e.hasLiveData=function(e){return{field:"delayedPrice",valid:e.market.isDelayed===e.market.isAuditing,error:{key:r.default.Reason.NOT_AUDITING}}},e.quantityBelowFilled=function(e){var t=void 0;t=0===e.order.filledQuantity?r.default.Reason.QUANTITY_NOT_ABOVE_ZERO:r.default.Reason.QUANTITY_BELOW_FILLED;return{field:"quantity",valid:e.quantity>e.order.filledQuantity,error:{key:t}}},e.bookCostFilled=function(e){return{field:"bookCost",valid:e.bookCost>0,error:{key:r.default.Reason.BOOK_COST_FILLED}}},e.orderSizeAboveZero=function(e){var t=e.sizeUnit,n=e.orderSize;return{field:"orderSize",valid:!c.default.isConsideration(t)||null===n||n>0,error:{key:r.default.Reason.ORDER_SIZE_ABOVE_ZERO}}},e.noBuyingStopMarketOrders=function(e){return{field:"orderType",valid:"sell"===e.direction||"STOP_MARKET"!==e.orderType,error:{key:r.default.Reason.BUY_ORDER_TYPE_CANNOT_BE_STOP_MARKET}}},e.stopOnlyForOTCTradeableMarket=function(e){if(!e.market.otcTradeable)return{field:"stop",valid:!0,error:null};return p.stop(e)},e.limitOnlyForOTCTradeableMarketAndNonLimitDayOrderType=function(e){var t=e.orderType===u.default.LIMIT&&e.timeInForce===l.default.GOOD_FOR_DAY;if(!e.market.otcTradeable||t)return{field:"limit",valid:!0,error:null};return p.limit(e)},e.orderTypeAndExpiry=function(e){return{field:"timeInForce",valid:e.checkForValidOrderTypeAndExpiry(),error:{key:r.default.Reason.TIME_IN_FORCE_NOT_VALID_FOR_ORDER_TYPE}}}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(135),r(6),r(38),r(24),r(0),r(28)],i=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var u=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var c=function(e){function r(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,{inProgress:!1,isComplete:!1,isConfirmed:!1,isRejected:!1}));return o._data=e,o._session=t,o._confirmationStreamingClient=i,o.setState(n.NOT_STARTED,null),o._onFirstPoll=o._onFirstPoll.bind(o),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),s(r,[{key:"_onFirstPoll",value:function(){this.trigger(i.default.FIRST_POLL),this._confirmationPoller.off(i.default.FIRST_POLL,this._onFirstPoll)}},{key:"start",value:function(){var e=this,r=this._data.dealReference;this.setState(n.STARTED,null),this._doRequest().then(this._handleDealPlaced.bind(this)).catch((function(t){e.isComplete||(e.trigger(i.default.DEAL_FAILED),e.setState(n.FAILED,t.statusText),e.destroy())})),this._data.isDMA||this._confirmationStreamingClient.waitForConfirm(r).then(this._createResolved.bind(this),this._createRejected.bind(this)),this._confirmationPoller=new t.default(this._session,r),this._confirmationPoller.on(i.default.FIRST_POLL,this._onFirstPoll),this._confirmationPoller.pollForConfirm().then(this._createResolved.bind(this),this._createRejected.bind(this)),this.setState(n.PENDING,{dealReference:r})}},{key:"_doRequest",value:function(){throw new Error("Not implemented.")}},{key:"abort",value:function(){this.trigger(i.default.DEAL_FAILED),this.setState(n.ABORTED,null),this.destroy()}},{key:"setState",value:function(e,t){this.setProperties({state:e,details:t,isConfirmed:e===n.CONFIRMED,isRejected:e===n.REJECTED,inProgress:o.default.includes(n.IN_PROGRESS_STATES,e),isComplete:o.default.includes(n.COMPLETED_STATES,e)}),this.trigger("state",e)}},{key:"destroy",value:function(){delete this._data,this._confirmationPoller&&(this._confirmationPoller.destroy(),this._confirmationPoller=null),u(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"_handleDealPlaced",value:function(e){var t=e.dealReference;this._data.isDMA&&(this._confirmationPoller.updateDealReference(t),this._confirmationStreamingClient.waitForConfirm(t).then(this._createResolved.bind(this),this._createRejected.bind(this))),this.trigger(i.default.INITIAL_DEAL_RESPONSE)}},{key:"_createResolved",value:function(e){this.trigger(i.default.FINAL_DEAL_RESPONSE),this.setState(n.CONFIRMED,e),this.destroy()}},{key:"_createRejected",value:function(e){if(this.trigger(i.default.DEAL_FAILED),"RETRY_COUNT_EXCEEDED"===e)this.setState(n.UNVERIFIED,null);else{var t=o.default.get(e,"category"),r=o.default.get(e,"content.reportType");"EXCHANGE"===t&&r===a.CANCELLED?this.setState(n.CANCELLED,e):this.setState(n.REJECTED,e)}this.destroy()}}]),r}(r.default);e.default=c}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0),r(2),r(80),r(133),r(130),r(131),r(76),r(65),r(74),r(9),r(22)],i=function(e,t,r,n,i,o,a,s,u,c,l,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.INSTRUMENT_TYPES=e.KNOCKOUT_TYPES=e.OPTION_TYPES=e.UNITS=e.PIS_FID_SCHEMA=e.PIS_MAX_CURRENCY_COUNT=e.MARKET_V4_FID_SCHEMA=e.V2_TO_V4_FID_MAPPING=e.OPTION_TYPE_TO_KNOCKOUT_TYPE=e.KO_V2_FID_SCHEMA=e.KO_FID_SCHEMA=void 0;var f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var d,y,h,v,g,_,O,b,m,T,k,S,E,P,w,L,A,D,I,C,R,j,M,N,F,x,U,z,B,V,G,K,W,q,Q,H,Y,J,Z,X,$,ee,te,re,ne,ie,oe,ae,se,ue,ce,le=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function pe(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}for(var de=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ye=e.KO_FID_SCHEMA=Object.freeze({KO_UND_BID:"displayUnderlyingBid",KO_UND_ASK:"displayUnderlyingOffer",KO_PREMIUM:"knockoutPremium"}),he=Object.freeze({KO_PREMIUM:"knockoutPremium"}),ve=e.KO_V2_FID_SCHEMA=Object.freeze({KO_UND_BID:"displayUnderlyingBid",KO_UND_ASK:"displayUnderlyingOffer",DELTA:"delta"}),ge=e.OPTION_TYPE_TO_KNOCKOUT_TYPE=Object.freeze({CALL:"BULL",PUT:"BEAR"}),_e=e.V2_TO_V4_FID_MAPPING=Object.freeze({BID:"BID",BID_QUOTE_ID:"BID_QUOTE",CPT:"CHANGE",CPC:"CHANGE_PCT",HIG:"HIGH",LOW:"LOW",MKT:"MARKET_NAME",OFR:"OFFER",OFR_QUOTE_ID:"OFFER_QUOTE",UBS:"MARKET_STATUS",UTM:"UPDATE_TIME",FINANCIAL_MID:"MID"}),Oe=e.MARKET_V4_FID_SCHEMA=Object.freeze({BID:"displayBid",BID_QUOTE:"bidQuoteId",CHANGE:"netChange",CHANGE_PCT:"percentageChange",HIGH:"high",LOW:"low",MARKET_NAME:"instrumentName",MARKET_STATUS:"rawMarketStatus",OFFER:"displayOffer",OFFER_QUOTE:"offerQuoteId",UPDATE_TIME:"updateTime",MID:"referencePrice"}),be=Object.freeze({BIDQUOTEID:"bidQuoteId",ASKQUOTEID:"offerQuoteId",HIGH:"high",LOW:"low",MIDPRICE:"referencePrice",NET_CHG:"netChange",NET_CHG_PCT:"percentageChange",DLG_FLAG:"rawMarketStatus",TIMESTAMP:"updateTime"}),me=e.PIS_MAX_CURRENCY_COUNT=6,Te={CURRENCY0:""},ke=1;ke<=5;ke++)Te["BIDPRICE"+ke]="displayBid"+ke,Te["ASKPRICE"+ke]="displayOffer"+ke;for(var Se=0;Se<me;Se++){Se>0&&(Te["CURRENCY"+Se]="");for(var Ee=1;Ee<=5;Ee++){var Pe=Se>0?"C"+Se:"";Te[Pe+"BIDSIZE"+Ee]="",Te[Pe+"ASKSIZE"+Ee]=""}}var we=e.PIS_FID_SCHEMA=Object.freeze(de({},Te,be,he)),Le=new RegExp("^CURRENCY([0-"+(me-1)+"])$"),Ae=new RegExp("^(?:C([1-"+(me-1)+"]))??(BID|ASK)SIZE([1-5])$"),De=Array.from({length:8},(function(e,t){return t+1})),Ie=Object.freeze(De.reduce((function(e,t){var r;return de(e,(fe(r={},"SWAP_"+t+"_SHORT","swapRateShort"),fe(r,"SWAP_"+t+"_LONG","swapRateLong"),r))}),{})),Ce=Object.freeze(de({},Oe,Ie,ye,ve)),Re=/^(.+?)@t\[(.+?)@t\](.+)?/,je="KNOCKOUTS_V2",Me=e.UNITS=Object.freeze({AMOUNT:"A",CONTRACTS:"C",SHARES:"S"}),Ne=(e.OPTION_TYPES=Object.freeze({CALL:"CALL",PUT:"PUT"}),e.KNOCKOUT_TYPES=Object.freeze({BULL:"BULL",BEAR:"BEAR"}),e.INSTRUMENT_TYPES=Object.freeze({BINARY:"BINARY",EQUITY_KNOCKOUT:"KNOCKOUTS_SHARES",FX_KNOCKOUT:"KNOCKOUTS_CURRENCIES",FX:"CURRENCIES",COMMODITY:"COMMODITIES"})),Fe=function(e){return null==e},xe=function(e){return Number.isFinite(e)?e:0};function Ue(e){var r=t.default.get(e,"instrumentData.instrumentType","");return r===Ne.BINARY||/^XSTOCKS_/.test(r)?t.default.get(e,"instrumentData.chartEpic",null):r.includes(je)?t.default.get(e,"marketSnapshotData.referenceEpic",null):t.default.get(e,"instrumentData.epic",null)}var ze=(d=(0,r.default)("displayBid"),y=(0,r.default)("displayBid1"),h=(0,r.default)("displayBid2"),v=(0,r.default)("displayBid3"),g=(0,r.default)("displayBid4"),_=(0,r.default)("displayBid5"),O=(0,r.default)("displayUnderlyingBid"),b=(0,r.default)("instrumentType"),m=(0,r.default)("instrumentType"),T=(0,r.default)("unit"),k=(0,r.default)("delayTime"),S=(0,r.default)("instrumentType"),E=(0,r.default)("isFx","isCryptocurrency"),P=(0,r.default)("instrumentType"),w=(0,r.default)("instrumentType"),L=(0,r.default)("unit","share"),A=(0,r.default)("rawMarketStatus","isShare"),D=(0,r.default)("bid","offer"),I=(0,r.default)("bid","offer"),C=(0,r.default)("displayOffer"),R=(0,r.default)("displayOffer1"),j=(0,r.default)("displayOffer2"),M=(0,r.default)("displayOffer3"),N=(0,r.default)("displayOffer4"),F=(0,r.default)("displayOffer5"),x=(0,r.default)("displayUnderlyingOffer"),U=(0,r.default)("midPrice","range"),z=(0,r.default)("midPrice","spread","scalingFactor"),B=(0,r.default)("high","low"),V=(0,r.default)("bid","offer","scalingFactor"),G=(0,r.default)("bid1","offer1","scalingFactor"),K=(0,r.default)("bid2","offer2","scalingFactor"),W=(0,r.default)("bid3","offer3","scalingFactor"),q=(0,r.default)("bid4","offer4","scalingFactor"),Q=(0,r.default)("bid5","offer5","scalingFactor"),H=(0,r.default)("unit"),Y=(0,r.default)("currencies"),J=(0,r.default)("lotSize","scalingFactor","unit"),Z=(0,r.default)("bidQuoteId"),X=(0,r.default)("offerQuoteId"),$=(0,r.default)("viewPermission","isDelayed","hasCompleteMarketData"),ee=(0,r.default)("isKnockout","isOption"),te=(0,r.default)("isKnockout","isOption","dealingRules"),re=(0,r.default)("instrumentType"),ne=(0,r.default)("instrumentType"),ie=(0,r.default)("delta"),oe=(0,r.default)("swapRateLong","isKnockout","knockoutType","isFx","isCommodity"),ae=(0,r.default)("swapRateShort","isKnockout","knockoutType","isFx","isCommodity"),se=(0,r.default)("isKnockout","isOption","dealingRules"),ue=(0,r.default)("dealingRules"),ce=function(e){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.pisCurrencies=new Array(me).fill(null),t.pisCurrenciesFromStreaming=new Array(me).fill(null),t.pisDisplaySizeThresholds=Array.from({length:me},(function(){return{bid:new Array(5).fill(null),offer:new Array(5).fill(null)}})),t.boundOnStreamedV2Update=t.onStreamedV2Update.bind(t),t.boundOnStreamedV4Update=t.onStreamedV4Update.bind(t),t.boundOnStreamedPriceUpdate=t.onStreamedPriceUpdate.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),le(r,[{key:"_calculateSpread",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this["offer"+e],r=this["bid"+e],n=this.scalingFactor;return[t,r].some(Fe)?null:+(Math.abs(t-r)*n).toFixed(this.decimalPlacesFactor)}},{key:"_getDisplaySwapRate",value:function(e){var t=this.isKnockout,r=this.isFx,n=this.knockoutType,i=this.isCommodity;return r||t&&n===(e?"BULL":"BEAR")||i?e?this.swapRateLong:this.swapRateShort:null}},{key:"_toAccountTimeInBinaryName",value:function(e){var t=e.match(Re);if(!t)return e;var r=f(t,4),n=r[1],i=r[2],o=r[3],a=void 0===o?"":o;return""+n+(0,c.toAccountTimeFromLondonTime)(i,this.timezoneOffset)+a}},{key:"getSubscriptionModifiers",value:function(){var e=[];return this.scaled&&e.push("SCALED"),e}},{key:"onStreamedV2Update",value:function(e){var t=this,r={};e.forEachChangedField((function(e,t,n){var i=_e[e]||e,o="UBS"===e?l.MARKET_STATUS_NUMBER_MAP[+n]:n;r[Ce[i]]=o})),["displayUnderlyingBid","displayUnderlyingOffer"].forEach((function(e){r[e]&&(r[e]=parseFloat(r[e]).toFixed(t.decimalPlacesFactor))})),r.instrumentName&&(r.instrumentName=this._toAccountTimeInBinaryName(r.instrumentName)),this.isAuditing&&(e.isValueChanged("BID")||e.isValueChanged("OFR"))&&(r.auditCount=this.auditCount+1),this.setProperties(r)}},{key:"onStreamedV4Update",value:function(e){var t=this;if(!this.isAuditing){var r={};e.forEachChangedField((function(e,t,n){return r[Ce[e]]=n})),["displayUnderlyingBid","displayUnderlyingOffer"].forEach((function(e){r[e]&&(r[e]=parseFloat(r[e]).toFixed(t.decimalPlacesFactor))})),r.instrumentName&&(r.instrumentName=this._toAccountTimeInBinaryName(r.instrumentName)),this.setProperties(r)}}},{key:"onStreamedPriceUpdate",value:function(e){var t=this,n={};e.forEachChangedField((function(e,i,o){var a=Le.exec(e),s=Ae.exec(e);if(a){var u=parseInt(a[1],10);n.pisCurrenciesFromStreaming=n.pisCurrenciesFromStreaming||t.pisCurrenciesFromStreaming.slice(),n.pisCurrenciesFromStreaming[u]=o}else if(s){var c=parseInt(s[1]||"0",10),p={BID:"bid",ASK:"offer"}[s[2]],f=parseInt(s[3],10)-1,d=n.pisCurrenciesFromStreaming||t.pisCurrenciesFromStreaming,y=t.getApiPiSCurrencyIndexFromStreamedPiSCurrencyIndex(d,c);void 0!==y&&(n.pisDisplaySizeThresholds=n.pisDisplaySizeThresholds||t.pisDisplaySizeThresholds.slice(),n.pisDisplaySizeThresholds[y][p][f]=o)}else"DLG_FLAG"===e?n[we[e]]=(0,l.convertDealingFlagToMarketStatus)(o):"TIMESTAMP"===e?n[we[e]]=r.convertTimestampToLondonTime(o):(n[we[e]]=o,"BIDPRICE1"===e?n.displayBid=o:"ASKPRICE1"===e&&(n.displayOffer=o))})),this.isAuditing&&(n.displayBid&&n.displayBid!==this.displayBid||n.displayOffer&&n.displayOffer!==this.displayOffer)&&(n.auditCount=this.auditCount+1),this.setProperties(n)}},{key:"getApiPiSCurrencyIndexFromStreamedPiSCurrencyIndex",value:function(e,t){var r=e[t];return this.getPiSCurrencyIndex(r)}},{key:"getPiSCurrencyIndex",value:function(e){var t=this.pisCurrencies,r=-1;return e&&(r=t.indexOf(e)),-1===r?void 0:r}},{key:"getPiSLadder",value:function(e,t){var r=this.getPiSCurrencyIndex(t);if(void 0===r||!["buy","sell"].includes(e))return[];for(var n={buy:"offer",sell:"bid"}[e],i=this.pisDisplaySizeThresholds[r][n],o=[],a=1;a<=5;a++){var u=i[a-1];if(null===u)break;var c=(0,s.default)(u),l=c/this.lotSize,f=""+l,d=this["spread"+a];o.push({rawDisplaySize:u,rawSize:c,displaySize:f,size:l,spread:d})}return(0,p.adjustPrecisionOfTierSizeData)(o,this.dealSizeDecimalPlaces)}},{key:"arePricesAvailableForAnyPiSLaddersTierAboveTierOne",value:function(){for(var e=2;e<=5;e++){var t=this["offer"+e],r=this["bid"+e];if(![null,void 0].includes(t)&&![null,void 0].includes(r))return!0}return!1}},{key:"populateWith",value:function(e){e.displayBid=e.bid||e.displayBid,e.displayOffer=e.offer||e.displayOffer,e.rawMarketStatus=e.ncrMarketStatus,e.bidQuoteId="-"===e.bidQuoteId?null:e.bidQuoteId,e.offerQuoteId="-"===e.offerQuoteId?null:e.offerQuoteId,this.setProperties(e)}},{key:"updateCurrencyExchangeRate",value:function(e,r){var n=this.currencies,i=t.default.find(n,(function(t){return t.name===e}));i&&i.set("exchangeRate",r)}},{key:"bid",get:function(){return(0,s.default)(this.displayBid)}},{key:"bid1",get:function(){return(0,s.default)(this.displayBid1)}},{key:"bid2",get:function(){return(0,s.default)(this.displayBid2)}},{key:"bid3",get:function(){return(0,s.default)(this.displayBid3)}},{key:"bid4",get:function(){return(0,s.default)(this.displayBid4)}},{key:"bid5",get:function(){return(0,s.default)(this.displayBid5)}},{key:"underlyingBid",get:function(){return(0,s.default)(this.displayUnderlyingBid)}},{key:"isOption",get:function(){return/^OPT_/i.test(this.instrumentType)}},{key:"isBinary",get:function(){return this.instrumentType===Ne.BINARY}},{key:"isContract",get:function(){return this.unit===Me.CONTRACTS}},{key:"isDelayed",get:function(){return 0!==this.delayTime}},{key:"isFx",get:function(){return this.instrumentType===Ne.FX}},{key:"isNonCryptoFx",get:function(){return this.isFx&&!this.isCryptocurrency}},{key:"isEquityKnockout",get:function(){return this.instrumentType===Ne.EQUITY_KNOCKOUT}},{key:"isFXKnockout",get:function(){return this.instrumentType===Ne.FX_KNOCKOUT}},{key:"isShare",get:function(){return this.unit===Me.SHARES||!!this.share}},{key:"marketStatus",get:function(){return l.default.resolve({rawMarketStatus:this.rawMarketStatus,instrumentType:this.instrumentType,isShare:this.isShare})}},{key:"midPrice",get:function(){return r.getMidPrice(this.bid,this.offer,this.decimalPlacesFactor)}},{key:"calculatedMidPrice",get:function(){return r.getCalculatedMidPrice(this.bid,this.offer,this.decimalPlacesFactor)}},{key:"offer",get:function(){return(0,s.default)(this.displayOffer)}},{key:"offer1",get:function(){return(0,s.default)(this.displayOffer1)}},{key:"offer2",get:function(){return(0,s.default)(this.displayOffer2)}},{key:"offer3",get:function(){return(0,s.default)(this.displayOffer3)}},{key:"offer4",get:function(){return(0,s.default)(this.displayOffer4)}},{key:"offer5",get:function(){return(0,s.default)(this.displayOffer5)}},{key:"underlyingOffer",get:function(){return(0,s.default)(this.displayUnderlyingOffer)}},{key:"percentRange",get:function(){var e=this.midPrice,t=this.range;return[t,e].some(Fe)?null:+xe(t/e*100).toFixed(Math.min(this.decimalPlacesFactor+2,6))}},{key:"percentSpread",get:function(){var e=this.midPrice,t=this.scalingFactor,r=this.spread;return[r,t,e].some(Fe)?null:+xe((r/=t)/e*100).toFixed(Math.min(this.decimalPlacesFactor+2,6))}},{key:"range",get:function(){var e=(0,s.default)(this.high),t=(0,s.default)(this.low);return[e,t].some(Fe)?null:+(e-t).toFixed(this.decimalPlacesFactor)}},{key:"spread",get:function(){return this._calculateSpread()}},{key:"spread1",get:function(){return this._calculateSpread("1")}},{key:"spread2",get:function(){return this._calculateSpread("2")}},{key:"spread3",get:function(){return this._calculateSpread("3")}},{key:"spread4",get:function(){return this._calculateSpread("4")}},{key:"spread5",get:function(){return this._calculateSpread("5")}},{key:"dealSizeDecimalPlaces",get:function(){return this.unit===Me.SHARES?0:2}},{key:"ticketDefaultCurrency",get:function(){var e=this.currencies.find((function(e){return e.ticketDefault}));return e||(this.currencies&&this.currencies.length>0?this.currencies[0]:null)}},{key:"valueOfOnePoint",get:function(){var e=this.unit,t=this.lotSize;return e===Me.CONTRACTS&&t?t:e===Me.SHARES?this.scalingFactor/100:null}},{key:"sanitisedBidQuoteId",get:function(){var e=this.bidQuoteId;return t.default.isString(e)?e:null}},{key:"sanitisedOfferQuoteId",get:function(){var e=this.offerQuoteId;return t.default.isString(e)?e:null}},{key:"isFree",get:function(){var e=(this.viewPermission||"").toUpperCase();return this.hasCompleteMarketData&&!("L1"===e||"L2"===e)&&!this.isDelayed}},{key:"marketOrderAllowed",get:function(){return!this.isKnockout&&!this.isOption}},{key:"guaranteedStopsAllowed",get:function(){return!1!==this.dealingRules.guaranteedStopsAllowed&&!this.isOption&&!this.isKnockout}},{key:"isLimitedRisk",get:function(){return/^OPT|^BINARY|^KNOCKOUTS/i.test(this.instrumentType)}},{key:"isCommodity",get:function(){return this.instrumentType===Ne.COMMODITY}},{key:"displayDelta",get:function(){return this.delta?Math.abs(this.delta):""}},{key:"displaySwapRateLong",get:function(){return this._getDisplaySwapRate(!0)}},{key:"displaySwapRateShort",get:function(){return this._getDisplaySwapRate(!1)}},{key:"trailingStopsAllowedPreference",get:function(){return"HIDE"!==this.dealingRules.trailingStopPreference&&!this.isOption&&!this.isKnockout}},{key:"minDealSize",get:function(){return this.dealingRules.minDealSize}}],[{key:"getMidPrice",value:function(e,t,r){return[t,e].some(Fe)?null:+((e+t)/2).toFixed(r)}},{key:"getCalculatedMidPrice",value:function(e,t,r){return t||0===t||e||0===e?t||0===t?e||0===e?+((e+t)/2).toFixed(r):+t.toFixed(r):+e.toFixed(r):null}},{key:"getFidsForSwapRate",value:function(e,t){return!e||e<1||e>8?[]:t.map((function(t){return"SWAP_"+e+"_"+t}))}},{key:"convertV3MarketDetailsJsonToV2",value:function(e){var t=e.instrumentData,r=e.marketSnapshotData||{},i=e.dealingRulesData||{},o=e.metaData||{};t.expiryDetails={expiryDate:t.expiryDate},t.stopsLimitsAllowed=!!t.stopAllowed,n.default.isUnpriced(t.epic)&&(t.viewPermission=r.viewPermission),r.midFormatted=r.mid,r.bidFormatted=r.bestBidFormatted=r.bid,r.offerFormatted=r.bestOfferFormatted=r.ask,r.highFormatted=r.high,r.lowFormatted=r.low,r.offerQuoteId=r.askQuoteId,r.referenceEpic=t.referenceEpic,i.currencyOffset=o.currencyOffset,i.marketOrderPreference=t.marketOrderPreference}},{key:"populateWithV2MarketData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=e.instrumentData;if(n.default.isUnpriced(s.epic))return i.default.populateWithV2MarketData(e);var c=e.marketSnapshotData,p=e.dealingRulesData||{},f=e.metaData||{},d=e.dealSettings||{},y=e.knockoutData||{},h=e.commissionsRateData||{},v=s.instrumentType;t&&r.normalisePiSBidAndAskPrices(c);var g=new r({epic:s.epic});return g.populateWith({controlledRisk:!!f.controlledRisk,dealingRules:p,chartCode:s.chartCode,chartEpic:Ue(e),commissionsMinCharge:h.minChargeWeb,commissionsCharge:h.charge,commissionsRateType:h.rateType,commissionsCurrencyIsoCode:h.currencyIsoCode,instrumentName:s.marketName,igInstrumentId:s.igInstrumentId,marketId:s.marketId,elasticity:s.elasticity,exchangeId:s.exchangeId,expiryDetails:s.expiryDetails,expiryTimestamp:s.instrumentExpiryTimestamp,latestPossibleDealingTimestamp:s.instrumentLatestPossibleDealingTimestamp,displayPeriod:s.displayPrompt,isin:s.isin,mtfAvailable:s.mtfAvailable,isMtfConstant:Object.values(u.default).includes(v),otcTradeable:s.otcTradeable,instrumentDmaL1Tradeable:"???",dmaTradeable:s.dmaTradeable,dmaL1Tradeable:s.dmaL1Tradeable,dynamicHierarchyEpic:s.dynamicHierarchyEpic,instrumentType:v,securityType:s.securityType,stopsLimitsAllowed:s.stopsLimitsAllowed,stopAllowed:s.stopAllowed,limitAllowed:s.limitAllowed,unit:s.unit,ncrMarketStatus:l.MARKET_STATUS_NUMBER_MAP[c.marketStatus],high:c.highFormatted,low:c.lowFormatted,percentageChange:c.percentageChange,netChange:c.netChange,displayBid:c.bidFormatted,displayOffer:c.offerFormatted,referencePrice:c.midFormatted,displayUnderlyingBid:parseFloat(c.underlyingBid).toFixed(c.decimalPlacesFactor),displayUnderlyingOffer:parseFloat(c.underlyingAsk).toFixed(c.decimalPlacesFactor),knockoutPremium:c.knockoutPremium,knockoutRelatedEpic:y.relatedEpic,knockoutLevels:y.levels,knockoutDefaultLevel:y.defaultLevel,isKnockout:s.knockout,isKnockoutV2:v&&v.includes(je),share:s.share,knockoutType:s.knockout?ge[s.optionType]:null,bidQuoteId:c.bidQuoteId,offerQuoteId:c.offerQuoteId,bestBid:c.bestBidFormatted,bestOffer:c.bestOfferFormatted,scalingFactor:c.scalingFactor,decimalPlacesFactor:c.decimalPlacesFactor,updateTime:c.updateTime,viewPermission:c.viewPermission||s.viewPermission,delayTime:c.delayTime,isAuditing:!1,scaled:c.scaled,marketAnalysisAvailable:s.marketAnalysisAvailable,alertsAllowed:s.alertsAllowed,countryCode:s.countryCode,newsSymbol:s.newsCode,firstFxCurrency:s.firstFxCurrency,currency:s.currency,isCryptocurrency:s.cryptocurrency,currencies:s.currencies?s.currencies.map(o.default.populateWithJson):[],collateralHaircut:s.collateralHaircut,defaultOrderType:d.defaultOrderType,defaultOrderExpiry:d.defaultOrderExpiry,defaultStopType:d.defaultStopType,defaultDealSize:+d.defaultDealSize||void 0,lastSelectedEpic:e.lastSelectedEpic,lastTradedPointsThroughCurrent:d.lastTradedPointsThroughCurrent,lastTradedSize:+d.lastTradedDealSize||void 0,lastTradedCurrency:d.lastTradedDealCurrency,lastTradedLimitDistance:+d.lastTradedLimitDistance||void 0,lastTradedStopDistance:+d.lastTradedStopDistance||void 0,lastTradedStopType:d.lastTradedStopType,lastTradedTrailingStopIncrement:+d.lastTradedTrailingStopIncrement||void 0,lastTradedOrderExpiry:d.lastTradedOrderExpiry,lastTradedOrderType:d.lastTradedOrderType,leverageFactor:s.leverageFactor,lotSize:s.lotSize,prompt:s.prompt,timezoneOffset:f.timezoneOffset,hasCompleteMarketData:!0,limitedRiskPremium:s.limitedRiskPremium,valueOfOnePip:s.valueOfOnePip,contractSize:s.contractSize,swapRateLong:s.swapRateLong,swapRateShort:s.swapRateShort,optionType:s.optionType,strikePrice:s.strikeLevel||e.strikePrice,strikeLevel:s.strikeLevel||e.strikePrice,multiplier:s.multiplier,barrier:s.barrier,underlyingEpic:e.underlyingEpic,underlyingId:e.underlyingId,referenceEpic:c.referenceEpic,expiry:s.expiry||e.expiry,dmaMarketData:a.default.populateWithJson(s.dmaMarketData,c.scalingFactor),atQuoteEnabled:s.atQuoteEnabled,taxRequirement:s.taxRequirement,kiidUrl:s.kiidUrl,w8benUrl:s.w8benUrl}),t&&r.parsePiSSnapshotData(g,c),g}},{key:"normalisePiSBidAndAskPrices",value:function(e){delete e.bid,delete e.ask,Array.isArray(e.priceLadder)&&e.priceLadder.length&&(e.bid=e.priceLadder[0].bid,e.ask=e.priceLadder[0].ask)}},{key:"parsePiSSnapshotData",value:function(e,t){e.ncrMarketStatus=e.rawMarketStatus=(0,l.convertDealingFlagToMarketStatus)(t.marketStatus);var r={};Array.isArray(t.priceLadder)&&t.priceLadder.forEach((function(e,t){var n=t+1;r["displayBid"+n]=e.bid,r["displayOffer"+n]=e.ask})),Array.isArray(t.currencyLadders)&&(r.pisCurrencies=e.pisCurrencies.slice(),r.pisDisplaySizeThresholds=e.pisDisplaySizeThresholds.slice(),t.currencyLadders.forEach((function(e,t){if("string"==typeof(n=e.currency)&&n.trim().length>0){var n;r.pisCurrencies[t]=e.currency;var i=e.bidSizes;Array.isArray(i)&&i.forEach((function(e,n){r.pisDisplaySizeThresholds[t].bid[n]=""+e}));var o=e.askSizes;Array.isArray(o)&&o.forEach((function(e,n){r.pisDisplaySizeThresholds[t].offer[n]=""+e}))}}))),e.setProperties(r)}},{key:"populateWithV3MarketData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.marketSnapshotData;t&&r.normalisePiSBidAndAskPrices(n),r.convertV3MarketDetailsJsonToV2(e);var i=r.populateWithV2MarketData(e);return t&&r.parsePiSSnapshotData(i,n),i}},{key:"populateFromPositionResponse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.openPosition.openPositionData||e.openPosition,i=e.marketDetails||e.market;if(i){i.instrumentData.displayPrompt=i.instrumentData.displayPrompt||n.displayPeriod,t&&r.normalisePiSBidAndAskPrices(i.marketSnapshotData);var o=r.populateWithV2MarketData(i);return t&&r.parsePiSSnapshotData(o,i.marketSnapshotData),o}}},{key:"populateWithMarketLiteData",value:function(e){var t=e.marketSnapshotData||e.referenceMarketSnapshotData,n=new r({epic:e.epic});return n.populateWith({instrumentName:e.instrumentName,ncrMarketStatus:l.MARKET_STATUS_NUMBER_MAP[t.marketStatus],high:t.highFormatted,low:t.lowFormatted,percentageChange:t.percentageChange,netChange:t.netChange,displayBid:t.bidFormatted,displayOffer:t.offerFormatted,referencePrice:t.midFormatted,displayUnderlyingBid:t.underlyingBid,displayUnderlyingOffer:t.underlyingAsk,knockoutPremium:t.knockoutPremium,bestBid:t.bestBidFormatted,bestOffer:t.bestOfferFormatted,scalingFactor:t.scalingFactor,decimalPlacesFactor:t.decimalPlacesFactor,updateTime:t.updateTime,delayTime:t.delayTime,isAuditing:!1,scaled:t.scaled,hasCompleteMarketData:!1,underlyingName:e.underlyingName,underlyingId:e.underlyingId,referenceEpic:e.referenceEpic,id:e.id,lastSelectedEpic:e.lastSelectedEpic,isKnockout:!!e.knockoutType,isKnockoutV2:e.isKnockoutV2,knockoutType:e.knockoutType,strikeLevel:e.strikeLevel,epic:e.epic,share:e.share,optionType:e.optionType,baseCurrency:e.baseCurrency,bloombergCode:e.bloombergCode,availableForTrade:e.availableForTrade,instrumentType:e.instrumentType}),n}},{key:"convertTimestampToLondonTime",value:function(e){return new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:"Europe/London"}).format(new Date(parseInt(e,10)))}}]),r}(n.default),pe(ce.prototype,"bid",[d],Object.getOwnPropertyDescriptor(ce.prototype,"bid"),ce.prototype),pe(ce.prototype,"bid1",[y],Object.getOwnPropertyDescriptor(ce.prototype,"bid1"),ce.prototype),pe(ce.prototype,"bid2",[h],Object.getOwnPropertyDescriptor(ce.prototype,"bid2"),ce.prototype),pe(ce.prototype,"bid3",[v],Object.getOwnPropertyDescriptor(ce.prototype,"bid3"),ce.prototype),pe(ce.prototype,"bid4",[g],Object.getOwnPropertyDescriptor(ce.prototype,"bid4"),ce.prototype),pe(ce.prototype,"bid5",[_],Object.getOwnPropertyDescriptor(ce.prototype,"bid5"),ce.prototype),pe(ce.prototype,"underlyingBid",[O],Object.getOwnPropertyDescriptor(ce.prototype,"underlyingBid"),ce.prototype),pe(ce.prototype,"isOption",[b],Object.getOwnPropertyDescriptor(ce.prototype,"isOption"),ce.prototype),pe(ce.prototype,"isBinary",[m],Object.getOwnPropertyDescriptor(ce.prototype,"isBinary"),ce.prototype),pe(ce.prototype,"isContract",[T],Object.getOwnPropertyDescriptor(ce.prototype,"isContract"),ce.prototype),pe(ce.prototype,"isDelayed",[k],Object.getOwnPropertyDescriptor(ce.prototype,"isDelayed"),ce.prototype),pe(ce.prototype,"isFx",[S],Object.getOwnPropertyDescriptor(ce.prototype,"isFx"),ce.prototype),pe(ce.prototype,"isNonCryptoFx",[E],Object.getOwnPropertyDescriptor(ce.prototype,"isNonCryptoFx"),ce.prototype),pe(ce.prototype,"isEquityKnockout",[P],Object.getOwnPropertyDescriptor(ce.prototype,"isEquityKnockout"),ce.prototype),pe(ce.prototype,"isFXKnockout",[w],Object.getOwnPropertyDescriptor(ce.prototype,"isFXKnockout"),ce.prototype),pe(ce.prototype,"isShare",[L],Object.getOwnPropertyDescriptor(ce.prototype,"isShare"),ce.prototype),pe(ce.prototype,"marketStatus",[A],Object.getOwnPropertyDescriptor(ce.prototype,"marketStatus"),ce.prototype),pe(ce.prototype,"midPrice",[D],Object.getOwnPropertyDescriptor(ce.prototype,"midPrice"),ce.prototype),pe(ce.prototype,"calculatedMidPrice",[I],Object.getOwnPropertyDescriptor(ce.prototype,"calculatedMidPrice"),ce.prototype),pe(ce.prototype,"offer",[C],Object.getOwnPropertyDescriptor(ce.prototype,"offer"),ce.prototype),pe(ce.prototype,"offer1",[R],Object.getOwnPropertyDescriptor(ce.prototype,"offer1"),ce.prototype),pe(ce.prototype,"offer2",[j],Object.getOwnPropertyDescriptor(ce.prototype,"offer2"),ce.prototype),pe(ce.prototype,"offer3",[M],Object.getOwnPropertyDescriptor(ce.prototype,"offer3"),ce.prototype),pe(ce.prototype,"offer4",[N],Object.getOwnPropertyDescriptor(ce.prototype,"offer4"),ce.prototype),pe(ce.prototype,"offer5",[F],Object.getOwnPropertyDescriptor(ce.prototype,"offer5"),ce.prototype),pe(ce.prototype,"underlyingOffer",[x],Object.getOwnPropertyDescriptor(ce.prototype,"underlyingOffer"),ce.prototype),pe(ce.prototype,"percentRange",[U],Object.getOwnPropertyDescriptor(ce.prototype,"percentRange"),ce.prototype),pe(ce.prototype,"percentSpread",[z],Object.getOwnPropertyDescriptor(ce.prototype,"percentSpread"),ce.prototype),pe(ce.prototype,"range",[B],Object.getOwnPropertyDescriptor(ce.prototype,"range"),ce.prototype),pe(ce.prototype,"spread",[V],Object.getOwnPropertyDescriptor(ce.prototype,"spread"),ce.prototype),pe(ce.prototype,"spread1",[G],Object.getOwnPropertyDescriptor(ce.prototype,"spread1"),ce.prototype),pe(ce.prototype,"spread2",[K],Object.getOwnPropertyDescriptor(ce.prototype,"spread2"),ce.prototype),pe(ce.prototype,"spread3",[W],Object.getOwnPropertyDescriptor(ce.prototype,"spread3"),ce.prototype),pe(ce.prototype,"spread4",[q],Object.getOwnPropertyDescriptor(ce.prototype,"spread4"),ce.prototype),pe(ce.prototype,"spread5",[Q],Object.getOwnPropertyDescriptor(ce.prototype,"spread5"),ce.prototype),pe(ce.prototype,"dealSizeDecimalPlaces",[H],Object.getOwnPropertyDescriptor(ce.prototype,"dealSizeDecimalPlaces"),ce.prototype),pe(ce.prototype,"ticketDefaultCurrency",[Y],Object.getOwnPropertyDescriptor(ce.prototype,"ticketDefaultCurrency"),ce.prototype),pe(ce.prototype,"valueOfOnePoint",[J],Object.getOwnPropertyDescriptor(ce.prototype,"valueOfOnePoint"),ce.prototype),pe(ce.prototype,"sanitisedBidQuoteId",[Z],Object.getOwnPropertyDescriptor(ce.prototype,"sanitisedBidQuoteId"),ce.prototype),pe(ce.prototype,"sanitisedOfferQuoteId",[X],Object.getOwnPropertyDescriptor(ce.prototype,"sanitisedOfferQuoteId"),ce.prototype),pe(ce.prototype,"isFree",[$],Object.getOwnPropertyDescriptor(ce.prototype,"isFree"),ce.prototype),pe(ce.prototype,"marketOrderAllowed",[ee],Object.getOwnPropertyDescriptor(ce.prototype,"marketOrderAllowed"),ce.prototype),pe(ce.prototype,"guaranteedStopsAllowed",[te],Object.getOwnPropertyDescriptor(ce.prototype,"guaranteedStopsAllowed"),ce.prototype),pe(ce.prototype,"isLimitedRisk",[re],Object.getOwnPropertyDescriptor(ce.prototype,"isLimitedRisk"),ce.prototype),pe(ce.prototype,"isCommodity",[ne],Object.getOwnPropertyDescriptor(ce.prototype,"isCommodity"),ce.prototype),pe(ce.prototype,"displayDelta",[ie],Object.getOwnPropertyDescriptor(ce.prototype,"displayDelta"),ce.prototype),pe(ce.prototype,"displaySwapRateLong",[oe],Object.getOwnPropertyDescriptor(ce.prototype,"displaySwapRateLong"),ce.prototype),pe(ce.prototype,"displaySwapRateShort",[ae],Object.getOwnPropertyDescriptor(ce.prototype,"displaySwapRateShort"),ce.prototype),pe(ce.prototype,"trailingStopsAllowedPreference",[se],Object.getOwnPropertyDescriptor(ce.prototype,"trailingStopsAllowedPreference"),ce.prototype),pe(ce.prototype,"minDealSize",[ue],Object.getOwnPropertyDescriptor(ce.prototype,"minDealSize"),ce.prototype),ce);e.default=ze}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(7),r(78)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.addDistinct=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var a=Symbol("existing-values"),s=Symbol("proxy-handlers");function u(e,t,r){var n=this.batchChangesForKeys(r,e);t.call(this,e,r,n)}function c(e,t,r){r.length&&this.trigger("change",r)}var l=e.addDistinct=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e)for(var r=0,n=e.length;r<n;r++){var i=e[r];t.includes(i)||t.push(i)}return t},p=function e(t){var r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(t);return r?n.concat(e(r)):n},f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._computed=r.constructor.prototype._computedMap||{},n(r,e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"batchChangesForKeys",value:function(e,t){for(var r=[],n=t?t+".":"",i=0,o=e.length;i<o;i++)l(this._computed[""+n+e[i]],r);return r}},{key:"proxyChangesFor",value:function(){for(var e=this,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];var o="function"==typeof r[r.length-1]?r.pop():c;this[a]=n(this[a]||{},r.reduce((function(e,t){return e[t]=void 0,e}),{})),this[s]=n(this[s]||{},r.reduce((function(t,r){return t[r]=u.bind(e,r,o),t}),{})),this.on("change",this._proxyValuesHandler,this),this._proxyValuesHandler(r)}},{key:"_proxyValuesHandler",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var u=i.value;Object.prototype.hasOwnProperty.call(this[a],u)&&this[a][u]!==this[u]&&(this[a][u]&&"function"==typeof this[a][u].off&&this[a][u].off("change",this[s][u],this),this[u]&&"function"==typeof this[u].on&&this[u].on("change",this[s][u],this),this[a][u]=this[u])}}catch(c){r=!0,n=c}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"set",value:function(e,t){if(this[e]!==t){(0,r.default)(this,e,t);var n=[e],i=this._computed[e];if(i)for(var o=0,a=i.length;o<a;o++)n.push(i[o]);this.trigger("change",n)}}},{key:"snapshot",value:function(){var e=this;return p(this).filter((function(t){return"_"!==t[0]&&"function"!=typeof e[t]})).reduce((function(t,r){return t[r]=e[r],t}),{})}},{key:"setProperties",value:function(e){for(var t=Object.keys(e),n=[],i=0,o=t.length;i<o;i++){var a=t[i];this[a]!==e[a]&&((0,r.default)(this,a,e[a]),n.push(a),l(this._computed[a],n))}n.length&&this.trigger("change",n)}},{key:"destroy",value:function(){if(this.trigger("destroyed"),this[a]){var e=!0,r=!1,n=void 0;try{for(var i,u=Object.keys(this[a])[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var c=i.value;this[a][c]&&"function"==typeof this[a][c].off&&this[a][c].off("change",this[s][c],this)}}catch(l){r=!0,n=l}finally{try{!e&&u.return&&u.return()}finally{if(r)throw n}}delete this[a],delete this[s]}o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}],[{key:"clone",value:function(e){return new(0,e.constructor)(Object.keys(e).filter((function(e){return"_"!==e[0]})).reduce((function(t,r){return t[r]=e[r],t}),{}))}},{key:"isModel",value:function(e){return e instanceof t}}]),t}(t.default);e.default=f}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(159)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._observeable=new t.default}return r(e,[{key:"trigger",value:function(e,t){this._observeable.emit(e,t)}},{key:"on",value:function(e,t,r){this._observeable.on(e,t,r)}},{key:"once",value:function(e,t,r){this._observeable.once(e,t,r)}},{key:"off",value:function(e,t,r){e?this._observeable.removeListener(e,t,r):this._observeable.removeAllListeners()}},{key:"destroy",value:function(){this.off()}}]),e}();e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(21)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE"};e.default={pointsAway:function(e,n,i,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return"number"!=typeof e?null:n===r.ABSOLUTE?(0,t.round)((i-e)*o,2):(0,t.round)(e,a)},distanceFrom:function(e,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return"number"!=typeof e?null:n===r.ABSOLUTE?(0,t.round)(i-e,o):e},absolute:function(e,n,i,o,a){if("number"!=typeof e)return null;if(n===r.RELATIVE){var s=i+e/o;return s<0?null:(0,t.round)(s,a)}return n===r.ABSOLUTE?e:void 0},distanceInCurrencyFromPoints:function(e,t){return e*t},distanceInPointsFromCurrency:function(e,t){return e/t},Type:r,POINTS_AWAY_DECIMAL_PLACES:2}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.convertDealingFlagToMarketStatus=function(e){var t=(""+e).trim();return o[t]||"CLOSED"};var t=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},n=Object.freeze({AUCTION:"AUCTION",AUCTION_NO_EDIT:"AUCTION_NO_EDIT",OFFLINE:"OFFLINE",CLOSED:"CLOSED",CLOSE_ONLY:"CLOSE_ONLY",EDIT:"EDIT",SUSPENDED:"SUSPENDED",TRADEABLE:"TRADEABLE",UNAVAILABLE:"UNAVAILABLE",NONTRADEABLE:"NONTRADEABLE"}),i=e.MARKET_STATUS_NUMBER_MAP=Object.freeze({"-2":n.CLOSED,"-1":n.CLOSED,0:n.CLOSED,1:n.OFFLINE,2:n.TRADEABLE,3:n.EDIT,4:n.CLOSE_ONLY,7:n.AUCTION,8:n.AUCTION_NO_EDIT,9:n.SUSPENDED}),o=Object.freeze({XCON:"CLOSED",UNIVERSE:"CLOSED",CLOSED:"CLOSED",CALL:"OFFLINE",DEAL:"TRADEABLE",EDIT:"EDIT",CLOSINGSONLY:"CLOSE_ONLY",DEALNOEDIT:"CLOSED",AUCTION:"AUCTION",AUCTIONNOEDIT:"AUCTION_NO_EDIT",SUSPEND:"SUSPENDED"}),a=r({},n,{AUCTION:"CLOSED",AUCTION_NO_EDIT:"CLOSED",EDIT:"CLOSED"}),s=r({},n,{AUCTION:"CLOSED",AUCTION_NO_EDIT:"CLOSED",SUSPENDED:"CLOSED","-1":"UNAVAILABLE",7:"CLOSED",8:"CLOSED",9:"CLOSED"}),u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,n,i)}return t(e,[{key:"resolve",value:function(e){var t=e.rawMarketStatus,o=e.instrumentType,u=e.isMTF,c=e.isShareDealing,l=e.isShare,p=e.isAmerican,f=e.availableForTrade;if(null!=t){if(void 0===f){if(c&&!1===l)return n.UNAVAILABLE}else if(!f)return p?n.NONTRADEABLE:n.UNAVAILABLE;var d=/BINARY/.test(o)?a:n;return u&&(d=s),r({},i,d)[t]||n.CLOSED}}}]),e}();e.default=new u}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(0),r(19),r(8),r(31),r(21),r(32),r(23)],i=function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){var r=t.default.find(e,(function(e){return e.valid}));return r?r.value:s.default.NON_GUARANTEED},c=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=(0,i.default)(r,n,e,o);return s&&!u&&(c=(0,a.getMinimumDistanceValueForExistingPosition)(s,c,t)),{unit:"pts",value:c}};e.default={isValid:function(e,a,u,l,p,f,d,y,h,v){var g=arguments.length>10&&void 0!==arguments[10]&&arguments[10],_=arguments[11],O=arguments[12],b=arguments[13],m=arguments.length>14&&void 0!==arguments[14]&&arguments[14],T=arguments.length>15&&void 0!==arguments[15]&&arguments[15],k=!(arguments.length>16&&void 0!==arguments[16])||arguments[16],S=arguments.length>17&&void 0!==arguments[17]?arguments[17]:null,E=arguments.length>18&&void 0!==arguments[18]&&arguments[18],P=arguments[19],w=arguments[20],L=arguments.length>21&&void 0!==arguments[21]&&arguments[21],A=arguments.length>22&&void 0!==arguments[22]&&arguments[22],D=u===n.default.Type.ABSOLUTE,I=a===s.default.TRAILING,C=n.default.distanceFrom(e,u,v,y),R=c(u,a,l,v,d,S,L).value||0;!g||A||D||(R+=Math.abs(h-v));var j=(0,i.default)(f,h,u,d);if(isNaN(e))return{isValid:!1,error:{key:r.default.Reason.INVALID_LEVEL}};if(I&&O&&!t.default.isNumber(e))return{isValid:!1,error:{key:D?r.default.Reason.STOP_REQUIRES_LEVEL:r.default.Reason.STOP_REQUIRES_DISTANCE}};if(I&&D&&e&&(_&&e>h||!_&&e<h))return{isValid:!1,error:{key:r.default.Reason.STOP_WRONG_SIDE}};if(I&&C&&(O||0)<p.value)return{isValid:!1,error:{key:r.default.Reason.TRAILING_STEP_BELOW_MIN,min:p.value}};if(m&&I&&null!=R&&C){if((b||0)/(d||1)<R)return{isValid:!1,error:{key:r.default.Reason.TRAILING_DISTANCE_BELOW_MIN,min:Math.ceil(R*(d||1))}};var M=(b+O)/(d||1);if(C>=M)return{isValid:!1,error:{key:r.default.Reason.STOP_LEVEL_BELOW_TRAILING,min:h-M}}}if(!E&&T&&k&&(!t.default.isNumber(e)||0===e))return{isValid:!1,error:{key:u===n.default.Type.RELATIVE?r.default.Reason.STOP_REQUIRES_DISTANCE:r.default.Reason.STOP_REQUIRES_LEVEL}};if(e&&D&&(_&&e>v||!_&&e<v))return{isValid:!1,error:{key:r.default.Reason.STOP_WRONG_SIDE}};if(t.default.isNumber(R)&&t.default.isNumber(C)&&C<R){var N=(0,o.ceil)(R,y);return A?{isValid:!1,error:{key:r.default.Reason.STOP_TOO_CLOSE_POINTS,data:{min:N}}}:{isValid:!1,error:{key:r.default.Reason.STOP_TOO_CLOSE,data:{min:N}}}}return t.default.isNumber(j)&&t.default.isNumber(C)&&C>j?{isValid:!1,error:{key:r.default.Reason.STOP_TOO_FAR}}:E&&P&&t.default.isNumber(C)&&t.default.isNumber(P)&&C>P?{isValid:!1,error:{key:r.default.Reason.STOP_WRONG_SIDE_OF_KNOCKOUT_LEVEL}}:w&&!C?{isValid:!1,error:{key:r.default.Reason.STOP_REQUIRED}}:{isValid:!0}},getStopTypes:function(e,r,n,i){return t.default.values(s.default).map((function(t){var o=!e||i;return t===s.default.GUARANTEED?o=r:t===s.default.TRAILING&&(o=!e&&n),{valid:o,value:t}}))},getFirstValidStopType:u,getValidStopType:function(e,r){if(!r)return u(e);var n=t.default.find(e,(function(e){return e.value===r}));return n&&n.valid?r:u(e)},getMinimumDistanceRuleInPoints:c,Type:s.default}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={POSITION:"POSITION",ORDER:"ORDER",TICKET:"TICKET"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ADDED:"ADDED",REMOVED:"REMOVED",UPDATED:"UPDATED"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(6),r(78),r(2),r(8),r(19),r(9),r(10),r(31),r(128),r(32),r(24),r(11),r(38),r(45),r(44),r(46),r(73),r(76),r(0),r(18),r(5),r(21),r(50),r(36),r(22)],i=function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,y,h,v,g,_,O,b,m,T,k,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var P=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var w,L,A,D,I,C,R,j,M,N,F,x,U,z,B,V,G,K,W,q,Q,H,Y,J,Z,X,$,ee,te,re,ne,ie,oe,ae,se,ue,ce,le,pe,fe,de,ye=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function he(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var ve=["direction","size","currency","marginService","controlledRisk","forceOpen","showForceOpen","stopType","stopLevel","stopLevelType","stopStep","limitLevel","limitType","knockoutLevel"],ge=["size","direction","triggerLevel","knockoutLevel","tolerance","timeInForce","stopType","stopLevel","stopLevelType","stopStep","stopPrice","orderStopLevel","limitLevel","limitType","currency","indicativeCostsAndChargesService","indicativeCostsAndChargesEditType","showClosing","skipICCRequest","_orderType"],_e=(w=(0,n.default)("market.isAuditing"),L=(0,n.default)("settings","settings.defaultLevelType"),A=(0,n.default)("direction"),D=(0,n.default)("direction"),I=(0,n.default)("direction","market","market.sanitisedBidQuoteId","market.sanitisedOfferQuoteId"),C=(0,n.default)("market.minDealSize"),R=(0,n.default)("currency","currency.exchangeRate","minDealSizePts"),j=(0,n.default)("isSell","bidPrice","offerPrice"),M=(0,n.default)("orderLevel"),N=(0,n.default)("size","direction","market","market.offer","market.bid","triggerLevel","currentMarketLevel"),F=(0,n.default)("size","market","market.valueOfOnePoint"),x=(0,n.default)("isSell","bidPrice","offerPrice"),U=(0,n.default)("isSell","bidPrice","offerPrice"),z=(0,n.default)("market.underlyingOffer","market.underlyingBid","knockoutLevel"),B=(0,n.default)("settings","settings.showForceOpen","market.isKnockout","market.isOption"),V=(0,n.default)("knockoutLevel","market.bid","market.offer","sellTierOrdinal","rdwBid.size"),G=(0,n.default)("knockoutLevel","market.bid","market.offer","buyTierOrdinal","rdwOffer.size"),K=(0,n.default)("direction","size","rdwBid.size","rdwOffer.size"),W=(0,n.default)("ladder"),q=(0,n.default)("direction","sizeIncludingRDW","minimumTierSize"),Q=(0,n.default)("ladder"),H=(0,n.default)("size","sizeIncludingRDW","ladder"),Y=(0,n.default)("size","sizeIncludingRDW","ladder"),J=(0,n.default)("direction","size","sizeIncludingRDW","ladder"),Z=(0,n.default)("direction","currency","market.pisDisplaySizeThresholds","market.spread1","market.spread2","market.spread3","market.spread4","market.spread5"),X=(0,n.default)("bidPrice","offerPrice","market.scalingFactor"),$=(0,n.default)("stopLevel","stopLevelType"),ee=(0,n.default)("stopLevel","stopLevelType","orderLevel","direction"),te=(0,n.default)("orderLevel","market","market.bid","market.offer","market.dealingRules"),re=(0,n.default)("stopType","orderLevel","market","market.dealingRules","stopLevelType"),ne=(0,n.default)("currency","minStopDistance"),ie=(0,n.default)("orderLevel","market","market.dealingRules","stopLevelType"),oe=(0,n.default)("direction","stopLevelType","orderLevel","market","market.dealingRules"),ae=(0,n.default)("limitLevel","limitType"),se=(0,n.default)("limitLevel","limitType","orderLevel","direction"),ue=(0,n.default)("limitLevel","limitType","openLevel","market","market.lotSize","size","direction"),ce=(0,n.default)("stopLevel","stopLevelType","openLevel","market","market.lotSize","size","direction"),le=(0,n.default)("errors.hasErrors"),pe=(0,n.default)("market","market.marketStatus"),fe=(0,n.default)("market"),de=function(e){function t(e,r,n,a,u,c,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var p=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,O.default.merge({dealReference:c.generateDealReference(),dealSizeDecimalPlaces:"S"===n.unit?0:2,direction:null,errors:new o.default,isEditTicket:!1,margin:null,indicativeCostsAndCharges:null,indicativeCostsAndChargesState:S.ICC_API_STATES.NOT_FETCHED,indicativeCostsAndChargesEditType:null,_indicativeCostsAndChargesAbortController:null,limitType:i.default.Type.ABSOLUTE,limitLevel:null,limitUnit:null,limitUnitValue:null,marginService:null,indicativeCostsAndChargesService:null,showClosing:!1,market:n,heartbeat:a,currency:n.ticketDefaultCurrency,currencies:n.currencies,controlledRisk:n.controlledRisk,settings:u,scalingFactor:n.scalingFactor,decimalPlacesFactor:n.decimalPlacesFactor,knockoutLevel:null,size:null,rdwBid:null,rdwOffer:null,skipICCRequest:!1,stopStep:null,stopTrailingDistance:null,stopLevel:null,stopLevelType:i.default.Type.ABSOLUTE,stopsLimitsAllowed:n.stopsLimitsAllowed,stopAllowed:n.stopAllowed,limitAllowed:n.limitAllowed,stopUnit:null,stopUnitValue:null,shouldUpdateFieldsOnSettingsChange:!1,canEditTrailingDistance:!1,pointsThroughCurrentSelected:u.rememberLastTradedPointsThroughCurrent,forceOpen:u.forceOpen,isPosition:null,isOrder:null,_lastTransactionState:null},e)));return p.set("defaultStopType",s.default.getFirstValidStopType(p.stopTypes)||s.default.Type.NON_GUARANTEED),p.set("stopType",s.default.getValidStopType(p.stopTypes||e.stopTypes)),p._dealReferenceGenerator=c,p._restService=r,p._session=l,p._validators=p._getValidators(),p._throttledGetMargin=O.default.throttle(p._getMarginHelper.bind(p),2e3),p._throttledGetIndicativeCostsAndCharges=O.default.throttle(p._getIndicativeCostsAndCharges.bind(p),2e3),p._marginAborted=!1,p.on("change",p._onChange,p),p.market.on("change",p._onMarketChange,p),p.settings.on("change",p._onSettingsChange,p),p.errors.on("change",p._onErrorsChange,p),p.currency&&p._updateCurrencyListeners(),p.proxyChangesFor("rdwOffer","rdwBid"),p._validate(),p}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),P(t,[{key:"_updateCurrencyListeners",value:function(){this._removeCurrencyListener(),this.currency&&(this.currency.on("change",this._onCurrencyChange,this),this._oldCurrency=this.currency)}},{key:"_removeCurrencyListener",value:function(){var e=this._oldCurrency;e&&e.off("change",this._onCurrencyChange,this),this._oldCurrency=null}},{key:"_onCurrencyChange",value:function(e){var t=this.batchChangesForKeys(e,"currency");t.length&&this.trigger("change",t)}},{key:"_onErrorsChange",value:function(e){var t=this.batchChangesForKeys(e,"errors");t.length&&this.trigger("change",t)}},{key:"_onMarketChange",value:function(e){var t=this.batchChangesForKeys(e,"market");t.length&&this.trigger("change",t),this.shouldUpdateFieldsOnSettingsChange&&(e.includes("lastTradedSize")&&this.settings.applyLastTradedSizeAndCurrency(this),(e.includes("lastTradedStopDistance")||e.includes("lastTradedStopType")||e.includes("lastTradedTrailingStopIncrement"))&&this.settings.applyLastTradedStop(this),e.includes("lastTradedLimitDistance")&&this.settings.applyLastTradedLimit(this),e.includes("lastTradedPointsThroughCurrent")&&this.settings.applyLastTradedPointsThroughCurrent(this)),(e.includes("marketStatus")||e.includes("dealingRules")||e.includes("isDelayed"))&&this._validate()}},{key:"_onSettingsChange",value:function(e){var t=this.batchChangesForKeys(e,"settings");e.includes("rememberLastTradedPointsThroughCurrent")&&this.pointsThroughCurrentSelected!==this.settings.rememberLastTradedPointsThroughCurrent&&((0,r.default)(this,"pointsThroughCurrentSelected",this.settings.rememberLastTradedPointsThroughCurrent),t.push("pointsThroughCurrentSelected")),e.includes("forceOpen")&&this.forceOpen!==this.settings.forceOpen&&((0,r.default)(this,"forceOpen",!this.isDMA&&this.settings.forceOpen),t.push("forceOpen")),t.length&&this.trigger("change",t),this.shouldUpdateFieldsOnSettingsChange&&(e.includes("rememberLastTradedSize")&&(this.settings.rememberLastTradedSize?this.settings.applyLastTradedSizeAndCurrency(this):this.resetSizeAndCurrency()),e.includes("rememberLastTradedStopTypeAndDistance")&&(this.settings.rememberLastTradedStopTypeAndDistance?this.settings.applyLastTradedStop(this):this.resetStop()),e.includes("rememberLastTradedLimitDistance")&&(this.settings.rememberLastTradedLimitDistance?this.settings.applyLastTradedLimit(this):this.resetLimit()),e.includes("rememberLastTradedPointsThroughCurrent")&&(this.settings.rememberLastTradedPointsThroughCurrent?this.settings.applyLastTradedPointsThroughCurrent(this):this.resetPointsThroughCurrent(this)))}},{key:"_onChange",value:function(e){e.includes("currency")&&this._updateCurrencyListeners(),e.includes("stopType")&&this._clearStepOnTypeChange(),(0,h.default)(ve,e)&&this._updateMargin(),(0,h.default)(this._validationDependentKeys,e)&&this._validate(),(0,h.default)(ge,e)&&this._updateIndicativeCostsAndCharges()}},{key:"_clearStepOnTypeChange",value:function(){this.stopType!==s.default.Type.TRAILING&&this.setProperties({stopStep:null,stopTrailingDistance:null})}},{key:"_getValidators",value:function(){return[]}},{key:"resetSizeAndCurrency",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.settings;e&&t.rememberLastTradedSize?t.applyLastTradedSizeAndCurrency(this):this.setProperties({size:null,currency:this.market.ticketDefaultCurrency})}},{key:"getDefaultStopType",value:function(){if(this.market&&this.market.defaultStopType)return s.default.getValidStopType(this.stopTypes,this.market.defaultStopType)}},{key:"resetStop",value:function(){this.setProperties({levelType:this.defaultLevelType,stopType:s.default.getValidStopType(this.stopTypes,this.getDefaultStopType()),stopLevel:null,stopLevelType:i.default.Type.ABSOLUTE,stopStep:null,stopTrailingDistance:null})}},{key:"resetLimit",value:function(){this.setProperties({limitLevel:null,limitType:this.defaultLevelType})}},{key:"resetPointsThroughCurrent",value:function(){this.set("pointsThroughCurrent",null)}},{key:"_updateMargin",value:function(){var e=this.triggerLevel||this.orderLevel;if(this._abortMarginRequest(),!this.marginService||this.controlledRisk&&this.stopAllowed&&!this.stopLevel||!this.size||!this.direction||!e)return this._throttledGetMargin.cancel(),void this.set("margin",null);this._throttledGetMargin()}},{key:"_getMarginHelper",value:function(){var e=this;this.set("margin",null);var t=this._getMargin();this._marginAborted=!1,this.set("marginRequest",t),t&&t.then((function(t){e._marginAborted||e.setProperties({marginRequest:null,margin:t})})).catch((function(t){e.setProperties({marginRequest:null,margin:null}),(0,y.default)(t)}))}},{key:"_getMargin",value:function(){return this.triggerLevel?this.marginService.getOrderMargin(this):this.marginService.getPositionMargin(this)}},{key:"_updateIndicativeCostsAndCharges",value:function(){if(this.indicativeCostsAndChargesService){var e=this.market.isOption?null!==this.iccPriceLevel&&void 0!==this.iccPriceLevel:this.iccPriceLevel;if(!this.currency||!this.iccSize||!this.direction||this._isInvalidIccEdit()||!e)return this._throttledGetIndicativeCostsAndCharges.cancel(),void this.indicativeCostsAndChargesService.reset(this);this.indicativeCostsAndChargesService.abortQuoteRequest(this),this.setProperties({indicativeCostsAndCharges:null,indicativeCostsAndChargesState:S.ICC_API_STATES.FETCHING}),this._throttledGetIndicativeCostsAndCharges()}}},{key:"_getIndicativeCostsAndCharges",value:function(){return Promise.resolve(S.INITIAL_ICC)}},{key:"_submitDeal",value:function(){return this._restService.create(this)}},{key:"submit",value:function(){var e=this;return this.trigger(p.default.DEAL_SUBMIT),this._ticketTransaction=this._submitDeal(),this._ticketTransaction.on("state",this._onTransactionChange,this),[p.default.FIRST_POLL,p.default.DEAL_FAILED,p.default.INITIAL_DEAL_RESPONSE,p.default.FINAL_DEAL_RESPONSE].forEach((function(t){e._ticketTransaction.on(t,(function r(){e.trigger(t),e._ticketTransaction.off(t,r,e)}),e)})),this._ticketTransaction}},{key:"_onTransactionChange",value:function(){var e=this._ticketTransaction;this._lastTransactionState=e.state,e.state===d.PENDING&&this._updatePerMarketSettings(),e.isComplete&&(e.off("state",this._onTransactionChange,this),this.set("dealReference",this._dealReferenceGenerator.generateDealReference()))}},{key:"_updatePerMarketSettings",value:function(){var e=(0,v.default)(this.settings,this.toJSON());this.market.setProperties(e)}},{key:"_hasGuaranteedStop",value:function(){return this.stopType===s.default.Type.GUARANTEED}},{key:"_hasTrailingStop",value:function(){return this.stopType===s.default.Type.TRAILING}},{key:"_calculateMarketLevel",value:function(){var e=this.isSell?this.bidPrice:this.offerPrice;return(0,_.default)(e)}},{key:"_calculateFirstTierMarketLevel",value:function(){var e=this.isSell?this.market.displayBid:this.market.displayOffer;return this.market.isKnockout&&void 0!==this.knockoutLevel?this.market.knockoutType===m.KNOCKOUT_TYPES.BEAR?Math.max(0,this.knockoutLevel-(0,_.default)(e)).toFixed(this.market.decimalPlacesFactor):Math.max(0,(0,_.default)(e)-this.knockoutLevel).toFixed(this.market.decimalPlacesFactor):(0,_.default)(e)}},{key:"getTierOrdinal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,E.calculateTierOrdinal)(this.market,this.currency&&this.currency.name,this.size,e,this.rdwBid,this.rdwOffer,t)}},{key:"getPiSLadder",value:function(e,t){return this.market?this.market.getPiSLadder(e,t):[]}},{key:"_calculateDistance",value:function(e,t){return i.default.pointsAway(e,t,this.orderLevel,this.scalingFactor,this.decimalPlacesFactor)}},{key:"_calculateLevel",value:function(e,t,r){var n=t===i.default.Type.RELATIVE;return i.default.absolute(e&&(n&&this.isBuy===r?-1:1)*e,t,this.orderLevel,this.scalingFactor,this.decimalPlacesFactor)}},{key:"_calculateIndicativeProfitLoss",value:function(e,t,r){if(!e||!this.size)return null;var n=t===i.default.Type.ABSOLUTE;if(n&&(r&&(this.isBuy&&e<this.openLevel||this.isSell&&e>this.openLevel)||!r&&(this.isBuy&&e>this.openLevel||this.isSell&&e<this.openLevel)))return null;var o=this.market,a=o.lotSize,s=void 0===a?1:a,u=o.scalingFactor,c=(0,b.calculateProfitAndLoss)(e,n?this.openLevel:0,s*(n?u:1),this.size);return c&&(r?1:-1)*Math.abs(c)}},{key:"allowsForStopType",value:function(e){return!!O.default.find(this.stopTypes,(function(t){return t.value===e&&t.valid}))}},{key:"_validate",value:function(){var e=this,t=this._validators.reduce((function(t,r){var n=r(e);return n.valid||(t[n.field]=n.error),t}),{});this.errors.setProperties(t)}},{key:"getLastTransactionState",value:function(){return this._ticketTransaction&&this._ticketTransaction.state||this._lastTransactionState}},{key:"toString",value:function(){return f.default.TICKET}},{key:"_abortMarginRequest",value:function(){this._marginAborted=!0}},{key:"destroy",value:function(){this._throttledGetMargin.cancel(),this._throttledGetIndicativeCostsAndCharges.cancel(),this._ticketTransaction&&(this._ticketTransaction.destroy(),this._ticketTransaction=null),this._abortMarginRequest(),this.indicativeCostsAndChargesService&&this.indicativeCostsAndChargesService.abortQuoteRequest(this),this._removeCurrencyListener(),this.settings.off("change",this._onSettingsChange,this),this.market.off("change",this._onMarketChange,this),ye(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"_getSubmittedTimestamp",value:function(){return this.heartbeat.getTime()}},{key:"_isInvalidIccEdit",value:function(){return this.isEditTicket&&(!this.isSubmittable||!this.settings.forceExAnteOpenEndpointForEdits&&(!this.iccStopLevel&&!this.iccLimitLevel||this.indicativeCostsAndChargesEditType===S.ICC_EDIT_TYPES.STOP&&!this.iccStopLevel||this.indicativeCostsAndChargesEditType===S.ICC_EDIT_TYPES.LIMIT&&!this.iccLimitLevel))}},{key:"_getPrecision",value:function(e){try{return e.toString().split(".")[1].length}catch(t){return 0}}},{key:"iccOpeningLevel",get:function(){return this.iccPriceLevel}},{key:"iccPriceLevel",get:function(){return this.triggerLevel||this.orderLevel}},{key:"iccStopLevel",get:function(){return this.absoluteStopLevel}},{key:"iccLimitLevel",get:function(){return this.absoluteLimitLevel}},{key:"iccSize",get:function(){return this.size}},{key:"iccDirection",get:function(){return this.direction}},{key:"isAuditing",get:function(){return this.market.isAuditing}},{key:"defaultLevelType",get:function(){return this.settings.defaultLevelType}},{key:"isBuy",get:function(){return"buy"===this.direction}},{key:"isSell",get:function(){return"sell"===this.direction}},{key:"isPriceInSizeEnabled",get:function(){return this._session.featureFlags.priceInSizeEnabled}},{key:"quoteId",get:function(){return"buy"===this.direction?this.market.sanitisedOfferQuoteId:this.market.sanitisedBidQuoteId}},{key:"minDealSizePts",get:function(){return this.market.minDealSize&&this.market.minDealSize.value}},{key:"minDealSize",get:function(){var e=(0,c.default)(this.minDealSizePts,this.currency?this.currency.exchangeRate:1,this.market.unit);return{unit:"pts",value:Math.round(100*e)/100}}},{key:"orderLevel",get:function(){return this._calculateMarketLevel()}},{key:"openLevel",get:function(){return this.orderLevel}},{key:"notionalValue",get:function(){var e=null;return this.isPriceInSizeEnabled?e=this.currentMarketLevel:this.triggerLevel?e=this.triggerLevel:this.isBuy?e=this.market.offer:this.isSell&&(e=this.market.bid),Boolean(this._session&&this._session.user&&this._session.user.isSpreadbet)?this.size*e:(0,g.default)(this.market.unit,e,this.size,this.market.scalingFactor,this.market.lotSize,this.market.scaled)}},{key:"profitLossPerPoint",get:function(){return this.market.valueOfOnePoint*this.size}},{key:"currentMarketLevel",get:function(){return this._calculateMarketLevel()}},{key:"currentFirstTierMarketLevel",get:function(){return this._calculateFirstTierMarketLevel()}},{key:"koUnderlyingDistance",get:function(){return this.market.knockoutType===m.KNOCKOUT_TYPES.BEAR?(0,T.round)(Math.abs(this.market.underlyingBid-this.knockoutLevel),this.market.decimalPlacesFactor):(0,T.round)(Math.abs(this.market.underlyingOffer-this.knockoutLevel),this.market.decimalPlacesFactor)}},{key:"showForceOpen",get:function(){return!(this.market.isKnockout||this._session.user.isFifo||this.market.isOption&&this.isOrder||this.isDMA)&&this.settings.showForceOpen}},{key:"bidPrice",get:function(){var e=this.isPriceInSizeEnabled?this.market["displayBid"+this.sellTierOrdinal]:this.market.displayBid;return this.market.isKnockout&&void 0!==this.knockoutLevel?this.market.knockoutType===m.KNOCKOUT_TYPES.BEAR?Math.max(0,this.knockoutLevel-(0,_.default)(e)).toFixed(this.market.decimalPlacesFactor):Math.max(0,(0,_.default)(e)-this.knockoutLevel).toFixed(this.market.decimalPlacesFactor):e}},{key:"offerPrice",get:function(){var e=this.isPriceInSizeEnabled?this.market["displayOffer"+this.buyTierOrdinal]:this.market.displayOffer;return this.market.isKnockout&&void 0!==this.knockoutLevel?this.market.knockoutType===m.KNOCKOUT_TYPES.BEAR?Math.max(0,this.knockoutLevel-(0,_.default)(e)).toFixed(this.market.decimalPlacesFactor):Math.max(0,(0,_.default)(e)-this.knockoutLevel).toFixed(this.market.decimalPlacesFactor):e}},{key:"sizeIncludingRDW",get:function(){return(0,E.calculateSizeIncludingRDW)(this.direction,this.size,this.rdwBid,this.rdwOffer)}},{key:"minimumTierSize",get:function(){var e=this.ladder;if(e.length)return e[0].size}},{key:"isSizeAboveMinimumTier",get:function(){var e=this.sizeIncludingRDW,t=this.minimumTierSize;return null!=e&&!isNaN(e)&&void 0!==t&&e>this.minimumTierSize}},{key:"isPiSLaddersDataAvailableForAnyTierAboveTierOne",get:function(){var e=this.ladder,t=this.market;return e.length>1&&t.arePricesAvailableForAnyPiSLaddersTierAboveTierOne}},{key:"buyTierOrdinal",get:function(){return this.getTierOrdinal("buy")}},{key:"sellTierOrdinal",get:function(){return this.getTierOrdinal("sell")}},{key:"tierOrdinal",get:function(){return this.getTierOrdinal(this.direction)}},{key:"ladder",get:function(){return this.direction?this.getPiSLadder(this.direction,this.currency&&this.currency.name):this.getPiSLadder("buy",this.currency&&this.currency.name)}},{key:"spread",get:function(){var e=parseFloat(this.offerPrice),t=parseFloat(this.bidPrice),r=this.market.scalingFactor||1,n=Math.max(this._getPrecision(e),this._getPrecision(t));if(!Number.isNaN(e)&&!Number.isNaN(t)){var i=void 0;return i=e-t,i=(i*=r).toFixed(n),(i=parseFloat(i.toString())).toString()}}},{key:"stopDistance",get:function(){return this._calculateDistance(this.stopLevel,this.stopLevelType)}},{key:"absoluteStopLevel",get:function(){return this._calculateLevel(this.stopLevel,this.stopLevelType,!0)}},{key:"minStepDistance",get:function(){if(null===this.market.dealingRules)return null;var e=this.market.dealingRules.minStepDistance,t=(0,u.default)(e,this.orderLevel,i.default.Type.RELATIVE,this.scalingFactor);return{unit:"pts",value:e&&"pct"===e.unit?Math.ceil(t):t}}},{key:"minStopDistance",get:function(){if(!this.market.dealingRules)return null;var e=s.default.getMinimumDistanceRuleInPoints(this.stopLevelType,this.stopType,(0,l.getMinimumDistanceFromMarket)(this.stopType,this.market),this.isOrder?this.orderLevel:this.currentFirstTierMarketLevel,this.scalingFactor);if(this.isPriceInSizeEnabled&&!this.isOrder){var t=Math.max(this._getPrecision(this.currentMarketLevel),this._getPrecision(this.currentFirstTierMarketLevel)),r=Math.pow(10,t),n=Math.abs((this.currentMarketLevel*r-this.currentFirstTierMarketLevel*r)/r),o=this.stopLevelType===i.default.Type.ABSOLUTE;return this.scalingFactor&&!o&&(n*=this.scalingFactor),{unit:e.unit,value:n+e.value}}return e}},{key:"minStopDistanceDisplay",get:function(){var e="JPY"===this.currency.name?0:i.default.POINTS_AWAY_DECIMAL_PLACES;return O.default.ceil(this.minStopDistance.value,e)}},{key:"minTrailingDistance",get:function(){var e=this.market.dealingRules&&this.market.dealingRules.minNormalStopOrLimitDistance;if(!e)return null;var t=s.default.getMinimumDistanceRuleInPoints(i.default.Type.RELATIVE,s.default.Type.TRAILING,(0,l.getMinimumDistanceFromMarket)(s.default.Type.TRAILING,this.market),this.orderLevel,this.scalingFactor);return"pct"===e.unit&&(t.value=Math.ceil(t.value)),t}},{key:"maxStopOrLimitDistance",get:function(){return this.direction&&this.market.dealingRules?{unit:"pts",value:(0,u.default)(this.market.dealingRules.maxStopOrLimitDistance,this.orderLevel,this.stopLevelType,this.scalingFactor)}:null}},{key:"limitDistance",get:function(){return this._calculateDistance(this.limitLevel,this.limitType)}},{key:"absoluteLimitLevel",get:function(){return this._calculateLevel(this.limitLevel,this.limitType,!1)}},{key:"indicativeProfit",get:function(){return this._calculateIndicativeProfitLoss(this.limitLevel,this.limitType,!0)}},{key:"indicativeLoss",get:function(){return this._calculateIndicativeProfitLoss(this.stopLevel,this.stopLevelType,!1)}},{key:"isSubmittable",get:function(){return!this.errors.hasErrors}},{key:"isMarketDealable",get:function(){return this.market.marketStatus===a.default.TRADEABLE}},{key:"_validationDependentKeys",get:function(){return["direction","size","market","limitType","limitLevel","stopStep","stopTrailingDistance","stopType","stopLevel","maxStopOrLimitDistance","minStopDistance","minDealSize","isAuditing"]}},{key:"isNewJapaneseTicket",get:function(){return(0,k.default)(this.market,this._session)}},{key:"isUSFx",get:function(){return this._session&&this._session.user&&this._session.user.isUSFx}},{key:"isOptionOrderEnabled",get:function(){return this._session.featureFlags.optionOrderEnabled}}]),t}(t.default),he(de.prototype,"isAuditing",[w],Object.getOwnPropertyDescriptor(de.prototype,"isAuditing"),de.prototype),he(de.prototype,"defaultLevelType",[L],Object.getOwnPropertyDescriptor(de.prototype,"defaultLevelType"),de.prototype),he(de.prototype,"isBuy",[A],Object.getOwnPropertyDescriptor(de.prototype,"isBuy"),de.prototype),he(de.prototype,"isSell",[D],Object.getOwnPropertyDescriptor(de.prototype,"isSell"),de.prototype),he(de.prototype,"quoteId",[I],Object.getOwnPropertyDescriptor(de.prototype,"quoteId"),de.prototype),he(de.prototype,"minDealSizePts",[C],Object.getOwnPropertyDescriptor(de.prototype,"minDealSizePts"),de.prototype),he(de.prototype,"minDealSize",[R],Object.getOwnPropertyDescriptor(de.prototype,"minDealSize"),de.prototype),he(de.prototype,"orderLevel",[j],Object.getOwnPropertyDescriptor(de.prototype,"orderLevel"),de.prototype),he(de.prototype,"openLevel",[M],Object.getOwnPropertyDescriptor(de.prototype,"openLevel"),de.prototype),he(de.prototype,"notionalValue",[N],Object.getOwnPropertyDescriptor(de.prototype,"notionalValue"),de.prototype),he(de.prototype,"profitLossPerPoint",[F],Object.getOwnPropertyDescriptor(de.prototype,"profitLossPerPoint"),de.prototype),he(de.prototype,"currentMarketLevel",[x],Object.getOwnPropertyDescriptor(de.prototype,"currentMarketLevel"),de.prototype),he(de.prototype,"currentFirstTierMarketLevel",[U],Object.getOwnPropertyDescriptor(de.prototype,"currentFirstTierMarketLevel"),de.prototype),he(de.prototype,"koUnderlyingDistance",[z],Object.getOwnPropertyDescriptor(de.prototype,"koUnderlyingDistance"),de.prototype),he(de.prototype,"showForceOpen",[B],Object.getOwnPropertyDescriptor(de.prototype,"showForceOpen"),de.prototype),he(de.prototype,"bidPrice",[V],Object.getOwnPropertyDescriptor(de.prototype,"bidPrice"),de.prototype),he(de.prototype,"offerPrice",[G],Object.getOwnPropertyDescriptor(de.prototype,"offerPrice"),de.prototype),he(de.prototype,"sizeIncludingRDW",[K],Object.getOwnPropertyDescriptor(de.prototype,"sizeIncludingRDW"),de.prototype),he(de.prototype,"minimumTierSize",[W],Object.getOwnPropertyDescriptor(de.prototype,"minimumTierSize"),de.prototype),he(de.prototype,"isSizeAboveMinimumTier",[q],Object.getOwnPropertyDescriptor(de.prototype,"isSizeAboveMinimumTier"),de.prototype),he(de.prototype,"isPiSLaddersDataAvailableForAnyTierAboveTierOne",[Q],Object.getOwnPropertyDescriptor(de.prototype,"isPiSLaddersDataAvailableForAnyTierAboveTierOne"),de.prototype),he(de.prototype,"buyTierOrdinal",[H],Object.getOwnPropertyDescriptor(de.prototype,"buyTierOrdinal"),de.prototype),he(de.prototype,"sellTierOrdinal",[Y],Object.getOwnPropertyDescriptor(de.prototype,"sellTierOrdinal"),de.prototype),he(de.prototype,"tierOrdinal",[J],Object.getOwnPropertyDescriptor(de.prototype,"tierOrdinal"),de.prototype),he(de.prototype,"ladder",[Z],Object.getOwnPropertyDescriptor(de.prototype,"ladder"),de.prototype),he(de.prototype,"spread",[X],Object.getOwnPropertyDescriptor(de.prototype,"spread"),de.prototype),he(de.prototype,"stopDistance",[$],Object.getOwnPropertyDescriptor(de.prototype,"stopDistance"),de.prototype),he(de.prototype,"absoluteStopLevel",[ee],Object.getOwnPropertyDescriptor(de.prototype,"absoluteStopLevel"),de.prototype),he(de.prototype,"minStepDistance",[te],Object.getOwnPropertyDescriptor(de.prototype,"minStepDistance"),de.prototype),he(de.prototype,"minStopDistance",[re],Object.getOwnPropertyDescriptor(de.prototype,"minStopDistance"),de.prototype),he(de.prototype,"minStopDistanceDisplay",[ne],Object.getOwnPropertyDescriptor(de.prototype,"minStopDistanceDisplay"),de.prototype),he(de.prototype,"minTrailingDistance",[ie],Object.getOwnPropertyDescriptor(de.prototype,"minTrailingDistance"),de.prototype),he(de.prototype,"maxStopOrLimitDistance",[oe],Object.getOwnPropertyDescriptor(de.prototype,"maxStopOrLimitDistance"),de.prototype),he(de.prototype,"limitDistance",[ae],Object.getOwnPropertyDescriptor(de.prototype,"limitDistance"),de.prototype),he(de.prototype,"absoluteLimitLevel",[se],Object.getOwnPropertyDescriptor(de.prototype,"absoluteLimitLevel"),de.prototype),he(de.prototype,"indicativeProfit",[ue],Object.getOwnPropertyDescriptor(de.prototype,"indicativeProfit"),de.prototype),he(de.prototype,"indicativeLoss",[ce],Object.getOwnPropertyDescriptor(de.prototype,"indicativeLoss"),de.prototype),he(de.prototype,"isSubmittable",[le],Object.getOwnPropertyDescriptor(de.prototype,"isSubmittable"),de.prototype),he(de.prototype,"isMarketDealable",[pe],Object.getOwnPropertyDescriptor(de.prototype,"isMarketDealable"),de.prototype),he(de.prototype,"isNewJapaneseTicket",[fe],Object.getOwnPropertyDescriptor(de.prototype,"isNewJapaneseTicket"),de.prototype),de);e.default=_e}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={QUANTITY:"QUANTITY",VALUE:"VALUE",VALUE_MARKET:"VALUE-MARKET",isConsideration:function(e){return"VALUE"===e||"VALUE-MARKET"===e}}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(0),r(155)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MERGE",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments[5];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lightstreamerService=t,this._subscriptionStr=r,this._subscribeMode=n,this._tickRate=i,this._dataAdapter=a,this._fakeSnapshot=o,this._handlers={},this._handlerCounters={},this._subscriptions={},this._snapshots={}}return n(e,[{key:"add",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=void 0,a=t.slice().sort(),s=i.length?":"+i.slice().sort().join(","):"",u=e+":"+a.join(",")+s,c=this._subscriptions[u];if(this._subscriptions[u])-1===(o=this._handlers[u].indexOf(n))?(this._handlers[u].push(n),this._handlerCounters[u].push(1)):this._handlerCounters[u][o]++;else{var l=this._subscriptionStr.replace("{id}",e).replace("{fids}",a).replace("{modifiers}",s);this._subscriptions[u]=this.lightstreamerService.subscribe(l,a,this._subscribeMode,this.onUpdate.bind(this,u),this._tickRate,this._dataAdapter),this._handlers[u]=[n],this._handlerCounters[u]=[1],this._fakeSnapshot&&(this._snapshots[u]=new r.default(!0))}if(this._fakeSnapshot&&c){var p=this._snapshots[u];p.hasData()&&n(p)}}},{key:"remove",value:function(e){var t=this._handlers,r=this._snapshots,n=this._handlerCounters,i=this._subscriptions,o=!0;return Object.keys(i).some((function(a){var s=t[a].indexOf(e);if(s>-1)return--n[a][s]||(t[a].splice(s,1),n[a].splice(s,1),t[a].length||(i[a].unsubscribe(),delete i[a],delete t[a],delete r[a],delete n[a],o=!1)),!0})),o}},{key:"onUpdate",value:function(e,t){var r=this;((this._handlers||{})[e]||[]).forEach((function(e){return e(t)})),this._fakeSnapshot&&t.forEachChangedField((function(t,n,i){r._snapshots[e].setField(t,i)}))}},{key:"removeAll",value:function(){t.default.invokeMap(this._subscriptions,"unsubscribe"),this._subscriptions={},this._handlerCounters={},this._handlers={}}},{key:"destroy",value:function(){this.removeAll(),this._subscriptions=null,this._handlerCounters=null,this._handlers=null}}]),e}();e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(31),r(9),r(8),r(48),r(3),r(2),r(75)],i=function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var c,l,p,f,d,y,h,v,g=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function _(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var O=(c=(0,a.default)("direction","stopType","triggerLevel"),l=(0,a.default)("direction","stopType","triggerLevel"),p=(0,a.default)("triggerLevel"),f=(0,a.default)("stopLevel","stopLevelType","orderLevel","direction","triggerLevel"),d=(0,a.default)("limitLevel","limitType","orderLevel","direction","triggerLevel"),y=(0,a.default)("market","market.bid","market.offer","direction","triggerLevel"),h=(0,a.default)("size","pointsThroughCurrent","triggerLevel","marketOrder"),v=function(e){function i(e,t,r,n,o,a,s,u){var c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c=i.__proto__||Object.getPrototypeOf(i)).call.apply(c,[this,{expiryTime:null,triggerLevel:null,stopRequired:!1,limitRequired:!1,isOneClickOrMicroDMA:!!u}].concat(Array.prototype.slice.call(arguments))));return n.applyLastTradedStop(l),n.applyLastTradedLimit(l),n.applyLastTradedSizeAndCurrency(l),n.applyDefaultLevel(l),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,e),u(i,[{key:"_calculateDistance",value:function(e,t){return n.default.pointsAway(e,t,this.triggerLevel,this.scalingFactor,this.decimalPlacesFactor)}},{key:"_getValidators",value:function(){return[o.controlledRiskTradingAvailable,o.dateBelowMin,o.direction,o.limit,o.marketDealable,o.triggerLevelWithinValidDistance,o.orderTypeLimitForOption,o.triggerLevelAboveZero,o.sizeAboveMin,o.stop,o.hasLiveData]}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.indicativeCostsAndChargesService.getIndicativeOpenQuote(this)}},{key:"toJSON",value:function(){var e=this.direction,t=this.expiryTime,r=this._hasTrailingStop(),n=this.market,i=this._session.user.broker,o={currencyCode:this.currency&&this.currency.name,dealReference:this.dealReference,direction:e?e.toUpperCase():null,epic:n.epic,expiry:n.prompt,goodTillDate:t,guaranteedStop:this._hasGuaranteedStop(),level:this.triggerLevel,limitDistance:this.limitDistance,size:this.size,stopDistance:this.stopDistance,submittedTimestamp:this.heartbeat.timestamp,timeInForce:t?"GOOD_TILL_DATE":"GOOD_TILL_CANCELLED",type:this.orderType,trailingStop:r,trailingStopIncrement:r?this.stopStep:null,quoteId:this.quoteId};return i&&i.decisionMakerAccountId&&(o.decisionMakerAccountId=i.decisionMakerAccountId),n.isOption||(o.forceOpen=this.forceOpen),o}},{key:"minStopDistance",get:function(){return g(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"minStopDistance",this)}},{key:"maxStopOrLimitDistance",get:function(){return g(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"maxStopOrLimitDistance",this)}},{key:"isMarketDealable",get:function(){return this.market.marketStatus===r.default.TRADEABLE||this.market.marketStatus===r.default.AUCTION||this.market.marketStatus===r.default.EDIT}},{key:"maxOrderDistance",get:function(){return this.direction&&null!==this.market.dealingRules&&Object.prototype.hasOwnProperty.call(this.market.dealingRules,"maxStopOrLimitDistance")?{unit:"pts",value:(0,t.default)(this.market.dealingRules.maxStopOrLimitDistance,this.currentMarketLevel,n.default.Type.ABSOLUTE,this.scalingFactor)}:null}},{key:"orderLevel",get:function(){return this.triggerLevel}},{key:"absoluteStopLevel",get:function(){return this._calculateLevel(this.stopLevel,this.stopLevelType,!0)}},{key:"absoluteLimitLevel",get:function(){return this._calculateLevel(this.limitLevel,this.limitType,!1)}},{key:"orderType",get:function(){var e=this._session.featureFlags.priceInSizeEnabled?this.currentFirstTierMarketLevel:this.currentMarketLevel,t=this.triggerLevel;return this.direction&&t?this.isBuy&&t>e||this.isSell&&t<e?"STOP":"LIMIT":null}},{key:"maximumRisk",get:function(){return this.isSell?(0,s.default)(this.size,this.pointsThroughCurrent,this.triggerLevel,this.market.valueOfOnePoint,this.marketOrder):this.size&&this.triggerLevel?0:null}},{key:"_validationDependentKeys",get:function(){return[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(g(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_validationDependentKeys",this)),["triggerLevel","expiryTime","timeInForce","maxOrderDistance","stopRequired","limitRequired"])}}]),i}(i.default),_(v.prototype,"minStopDistance",[c],Object.getOwnPropertyDescriptor(v.prototype,"minStopDistance"),v.prototype),_(v.prototype,"maxStopOrLimitDistance",[l],Object.getOwnPropertyDescriptor(v.prototype,"maxStopOrLimitDistance"),v.prototype),_(v.prototype,"orderLevel",[p],Object.getOwnPropertyDescriptor(v.prototype,"orderLevel"),v.prototype),_(v.prototype,"absoluteStopLevel",[f],Object.getOwnPropertyDescriptor(v.prototype,"absoluteStopLevel"),v.prototype),_(v.prototype,"absoluteLimitLevel",[d],Object.getOwnPropertyDescriptor(v.prototype,"absoluteLimitLevel"),v.prototype),_(v.prototype,"orderType",[y],Object.getOwnPropertyDescriptor(v.prototype,"orderType"),v.prototype),_(v.prototype,"maximumRisk",[h],Object.getOwnPropertyDescriptor(v.prototype,"maximumRisk"),v.prototype),v);e.default=O}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={MARKET:"Market",LIMIT:"MarketLimit",STOP:"MarketStop"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.calculateProfitAndLoss=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=0;if(!1===e||null===e)return a;a=(e-t)*n*(r||1),i&&(a*=-1);o&&(a+=parseFloat(n));return Math.round(1e4*a)/1e4},e.calculateProfitAndLossPercentage=function(e,t){var r=e/t*100;if(isNaN(r)||Math.abs(r)===1/0)return null;return Math.round(100*r)/100},e.calculateProfitLossFromBookCost=function(e,t,r){return(t-e)/r}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(0),r(6),r(2)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o,a,s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var u,c,l,p,f,d,y=Object.keys({bookCost:null,direction:null,expiryTime:null,level:null,limit:null,marketStatus:null,marketDealable:null,orderSize:null,orderType:null,timeInForce:null,size:null,stop:null,triggerLevel:null,delayedPrice:null,quantity:null,technicalIssues:null}),h=(o=n.default.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(y)),a=function(e){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var n={bookCost:null,direction:null,expiryTime:null,level:null,limit:null,marketStatus:null,marketDealable:null,orderSize:null,orderType:null,timeInForce:null,size:null,stop:null,triggerLevel:null,delayedPrice:null,quantity:null,technicalIssues:null};return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t.default.merge(n,e)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),i(r,[{key:"setProperties",value:function(e){s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setProperties",this).call(this,t.default.merge({bookCost:null,direction:null,expiryTime:null,level:null,limit:null,marketStatus:null,marketDealable:null,orderSize:null,orderType:null,timeInForce:null,size:null,stop:null,triggerLevel:null,delayedPrice:null,quantity:null,technicalIssues:null},e))}},{key:"hasErrors",get:function(){for(var e=0,t=y.length;e<t;e++)if(this[y[e]])return!0;return!1}}]),r}(r.default),u=a.prototype,c="hasErrors",l=[o],p=Object.getOwnPropertyDescriptor(a.prototype,"hasErrors"),f=a.prototype,d={},Object.keys(p).forEach((function(e){d[e]=p[e]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=l.slice().reverse().reduce((function(e,t){return t(u,c,e)||e}),d),f&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(f):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(u,c,d),d=null),a);h.Reason={BOOK_COST_FILLED:"BOOK_COST_FILLED",BUY_ORDER_TYPE_CANNOT_BE_STOP_MARKET:"BUY_ORDER_TYPE_CANNOT_BE_STOP_MARKET",CONTROLLED_RISK_TRADING_UNAVAILABLE:"CONTROLLED_RISK_TRADING_UNAVAILABLE",DATE_BELOW_MIN:"DATE_BELOW_MIN",DELAYED_PRICE:"DELAYED_PRICE",DIRECTION_NOT_SET:"DIRECTION_NOT_SET",INVALID_STOP_TYPE:"INVALID_STOP_TYPE",INVALID_LEVEL:"INVALID_LEVEL",LEVEL_REQUIRED:"LEVEL_REQUIRED",LIMIT_REQUIRED:"LIMIT_REQUIRED",LIMIT_BELOW_MIN_DISTANCE:"LIMIT_BELOW_MIN_DISTANCE",LIMIT_TOO_CLOSE:"LIMIT_TOO_CLOSE",LIMIT_TOO_FAR:"LIMIT_TOO_FAR",LIMIT_WRONG_SIDE:"LIMIT_WRONG_SIDE",LIMIT_SAME_AS_CURRENT_LEVEL:"LIMIT_SAME_AS_CURRENT_LEVEL",MARKET_NOT_DEALABLE:"MARKET_NOT_DEALABLE",NOT_AUDITING:"NOT_AUDITING",ORDER_TYPE_NOT_LIMIT_FOR_OPTION:"ORDER_TYPE_NOT_LIMIT_FOR_OPTION",ORDER_SIZE_ABOVE_ZERO:"ORDER_SIZE_ABOVE_ZERO",TECHNICAL_ISSUES:"TECHNICAL_ISSUES",SIZE_ABOVE_MAX:"SIZE_ABOVE_MAX",SIZE_ABOVE_ORIGINAL:"SIZE_ABOVE_ORIGINAL",SIZE_BELOW_PARTIAL:"SIZE_BELOW_PARTIAL",SIZE_BELOW_MIN:"SIZE_BELOW_MIN",SIZE_NOT_ABOVE_ZERO:"SIZE_NOT_ABOVE_ZERO",VALUE_NOT_ABOVE_ZERO:"VALUE_NOT_ABOVE_ZERO",STOP_REQUIRED:"STOP_REQUIRED",STOP_GUARANTEED_MOVE_AWAY:"STOP_GUARANTEED_MOVE_AWAY",STOP_GUARANTEED_CAN_NOT_BE_REMOVED:"STOP_GUARANTEED_CAN_NOT_BE_REMOVED",STOP_LEVEL_BELOW_TRAILING:"STOP_LEVEL_BELOW_TRAILING",STOP_LEVEL_BUY_BELOW_OFFER:"STOP_LEVEL_BUY_BELOW_OFFER",STOP_LEVEL_SELL_ABOVE_BID:"STOP_LEVEL_SELL_ABOVE_BID",STOP_REQUIRES_LEVEL:"STOP_REQUIRES_LEVEL",STOP_REQUIRES_DISTANCE:"STOP_REQUIRES_DISTANCE",STOP_TOO_CLOSE:"STOP_TOO_CLOSE",STOP_TOO_CLOSE_POINTS:"STOP_TOO_CLOSE_POINTS",STOP_TOO_FAR:"STOP_TOO_FAR",STOP_TYPE_CHANGE_INVALID:"STOP_TYPE_CHANGE_INVALID",STOP_WRONG_SIDE:"STOP_WRONG_SIDE",STOP_WRONG_SIDE_OF_KNOCKOUT_LEVEL:"STOP_WRONG_SIDE_OF_KNOCKOUT_LEVEL",TIME_IN_FORCE_NOT_VALID_FOR_ORDER_TYPE:"TIME_IN_FORCE_NOT_VALID_FOR_ORDER_TYPE",TRAILING_DISTANCE_BELOW_MIN:"TRAILING_DISTANCE_BELOW_MIN",TRAILING_STEP_BELOW_MIN:"TRAILING_STEP_BELOW_MIN",TRIGGER_LEVEL_REQUIRED:"TRIGGER_LEVEL_REQUIRED",TRIGGER_LEVEL_TOO_FAR:"TRIGGER_LEVEL_TOO_FAR",TRIGGER_LEVEL_TOO_HIGH:"TRIGGER_LEVEL_TOO_HIGH",TRIGGER_LEVEL_TOO_LOW:"TRIGGER_LEVEL_TOO_LOW",TRIGGER_LEVEL_INVALID_TICK:"TRIGGER_LEVEL_INVALID_TICK",QUANTITY_BELOW_FILLED:"QUANTITY_BELOW_FILLED",QUANTITY_NOT_ABOVE_ZERO:"QUANTITY_NOT_ABOVE_ZERO"},e.default=h}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(81),r(0),r(2),r(8),r(18),r(72),r(73),r(77),r(79),r(21),r(5),r(22)],i=function(e,t,r,n,i,o,a,s,u,c,l,p,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.POSITION_FID_SCHEMA=void 0;var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var y=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var h,v,g,_,O,b,m,T,k,S,E,P,w,L,A,D,I,C,R,j=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function M(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var N=e.POSITION_FID_SCHEMA={OPU_FMT_LIMIT_LEVEL:"limitLevel",OPU_SIZE:"dealSize",OPU_OPEN_LEVEL:"openLevel",OPU_FMT_STOP_LEVEL:"stopLevel",OPU_STOP_TYPE_ENUM:"stopType",OPU_TRAILING_STOP_DISTANCE:"trailingStopDistance",OPU_TRAILING_STEP:"trailingStep",OPU_BOOK_COST:"bookCost"},F=r.default.invert(N),x=(h=(0,n.default)("currency","currency.exchangeRate"),v=(0,n.default)("market","currencyCodeISO"),g=(0,n.default)("market","optionPrice","epicPrice","knockoutLevel","tierOrdinal"),_=(0,n.default)("market","optionPrice","epicPrice","knockoutLevel"),O=(0,n.default)("latest","dealSize","direction","contractSize"),b=(0,n.default)("positionValue","exchangeRate","sterlingToAccountCurrencyRate"),m=(0,n.default)("market","market.offer","market.bid"),T=(0,n.default)("latest","dealSize","direction"),k=(0,n.default)("currencyCodeISO"),S=(0,n.default)("notionalValue","exchangeRate","sterlingToAccountCurrencyRate","market"),E=(0,n.default)("market","market.displayUnderlyingBid","market.displayUnderlyingOffer"),P=(0,n.default)("market","epicPrice","knockoutLevel"),w=(0,n.default)("direction","dealSize","latest","rdwOffer.size","rdwBid.size"),L=(0,n.default)("dealSize","latest"),A=(0,n.default)("latest"),D=(0,n.default)("profitLoss","exchangeRate","sterlingToAccountCurrencyRate"),I=(0,n.default)("profitLoss","bookCost"),C=(0,n.default)("openLevel","latest"),R=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,d({},e,{sterlingToAccountCurrencyRate:1,rdwBid:null,rdwOffer:null})));return r.boundOnSterlingToAccountRateStreamedUpdate=r.onSterlingToAccountRateStreamedUpdate.bind(r),r.boundOnPositionRateStreamedUpdate=r.onPositionRateStreamedUpdate.bind(r),r.currency&&r._updateCurrencyListeners(),r.on("change",(function(e){e.includes("currency")&&r._updateCurrencyListeners()})),r.proxyChangesFor("rdwOffer","rdwBid"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),y(t,[{key:"_updateCurrencyListeners",value:function(){this._removeCurrencyListener(),this.currency&&(this.currency.on("change",this._onCurrencyChange,this),this._oldCurrency=this.currency)}},{key:"_removeCurrencyListener",value:function(){var e=this._oldCurrency;e&&e.off("change",this._onCurrencyChange,this),this._oldCurrency=null}},{key:"_onCurrencyChange",value:function(e){var t=this.batchChangesForKeys(e,"currency");t.length&&this.trigger("change",t)}},{key:"_parseOpenLevelUpdate",value:function(e){var t=parseFloat(e);return r.default.isFinite(t)?t:null}},{key:"shouldHideNotionalValue",value:function(){return/^OPT|^BINARY|^KNOCKOUTS/i.test(this.market.instrumentType)}},{key:"profitLossTieredPricesPartialClose",value:function(e){var t=this.isShort()?"buy":"sell",r=(0,f.calculateTierOrdinal)(this.market,this.currencyCodeISO,e,t,this.rdwBid,this.rdwOffer),n=(0,f.getTieredLatestPrice)(this.market,t,r);return(0,o.calculateProfitAndLoss)(n,this.openLevel,this.contractSize,e,this.isShort(),this.isPriceTypeBackOnly())}},{key:"onStreamedUpdate",value:function(e){var t=function(t){return e.getValue(F[t])},r=t("dealSize");if(null!==r){var n=(0,u.default)(t("stopLevel")||-1),i=(0,u.default)(t("limitLevel")||-1),o=(0,u.default)(t("trailingStopDistance")),a=(0,u.default)(t("trailingStep")),s=t("stopType"),c=+t("bookCost"),l=this._parseOpenLevelUpdate(t("openLevel"));this.setProperties({bookCost:c,dealSize:+r,limitLevel:i,openLevel:l,stopTrailingDistance:o,stopLevel:n,stopStep:a,stopType:s})}}},{key:"onSterlingToAccountRateStreamedUpdate",value:function(e){this.set("sterlingToAccountCurrencyRate",1/+e.getValue("OFR"))}},{key:"onPositionRateStreamedUpdate",value:function(e){var t=+e.getValue("OFR");this.market.updateCurrencyExchangeRate(this.currencyCodeISO,1/t)}},{key:"updateFromOther",value:function(e){j(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateFromOther",this).call(this,e),this.setProperties(r.default.pick(e,["stopLevel","stopType","stopStep","stopTrailingDistance","limitLevel","openLevel","dealSize","bookCost","sterlingToAccountCurrencyRate"]))}},{key:"canEdit",value:function(){return c.canEditPosition(this)}},{key:"canClose",value:function(){return c.canClosePosition(this)}},{key:"destroy",value:function(){j(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this._removeCurrencyListener()}},{key:"exchangeRate",get:function(){return this.currency?this.currency.exchangeRate:null}},{key:"currency",get:function(){if(!this.market)return null;var e=this.market.currencies,t=this.currencyCodeISO;return r.default.find(e,(function(e){return e.name===t}))}},{key:"latest",get:function(){if(!this.market)return null;if(this.priceInSizeShown){var e=this.isShort()?"buy":"sell";return(0,f.getTieredLatestPrice)(this.market,e,this.tierOrdinal,this.knockoutLevel)}var t=this.market.isKnockout?this.optionPrice:this.epicPrice;return isNaN(t)?null:t}},{key:"firstTierLatest",get:function(){if(!this.market)return null;if(this.priceInSizeShown){var e=this.isShort()?"buy":"sell";return(0,f.getTieredLatestPrice)(this.market,e,1,this.knockoutLevel)}var t=this.market.isKnockout?this.optionPrice:this.epicPrice;return isNaN(t)?null:t}},{key:"positionValue",get:function(){var e=this.isShort()?-1:1,t=this.contractSize||1;return this.latest*this.dealSize*t*e}},{key:"positionValueInBaseCurrency",get:function(){return this.currency?1===this.currency.baseExchangeRate?this.positionValue:(0,a.default)(this.sterlingToAccountCurrencyRate/this.currency.exchangeRate,this.positionValue):null}},{key:"epicPrice",get:function(){return this.market?this.isShort()?this.market.offer:this.market.bid:null}},{key:"notionalValue",get:function(){return this.shouldHideNotionalValue()?null:this.isSpreadbetAccount?this.dealSize*this.latest:(0,s.default)(this.market.unit,this.latest,this.dealSize,this.market.scalingFactor,this.market.lotSize,this.market.scaled)}},{key:"notionalValueCurrencyCodeISO",get:function(){return this.currencyCodeISO}},{key:"notionalValueInBaseCurrency",get:function(){return!this.currency||this.shouldHideNotionalValue()?null:this.market.isNonCryptoFx&&!this.isSpreadbetAccount?this.currency&&1===this.currency.baseExchangeRate?this.notionalValue:(0,a.default)(this.currency.baseExchangeRate,this.notionalValue):this.currency&&1===this.currency.baseExchangeRate?this.notionalValue:(0,a.default)(this.sterlingToAccountCurrencyRate/this.currency.exchangeRate,this.notionalValue)}},{key:"underlyingPrice",get:function(){return this.market?this.market.knockoutType===p.KNOCKOUT_TYPES.BEAR||this.isShort()?this.market.displayUnderlyingOffer:this.market.displayUnderlyingBid:null}},{key:"optionPrice",get:function(){return this.market?this.market.knockoutType===p.KNOCKOUT_TYPES.BEAR?(0,l.round)(Math.max(0,this.knockoutLevel-this.epicPrice),this.market.decimalPlacesFactor):(0,l.round)(Math.max(0,this.epicPrice-this.knockoutLevel),this.market.decimalPlacesFactor):null}},{key:"tierOrdinal",get:function(){var e=this.isShort()?"buy":"sell";return(0,f.calculateTierOrdinal)(this.market,this.currencyCodeISO,this.dealSize,e,this.rdwBid,this.rdwOffer)}},{key:"profitLoss",get:function(){return(0,o.calculateProfitAndLoss)(this.latest,this.openLevel,this.contractSize,this.dealSize,this.isShort(),this.isPriceTypeBackOnly())}},{key:"profitLossInBaseCurrency",get:function(){return this.currency?1===this.currency.baseExchangeRate?this.profitLoss:(0,a.default)(this.sterlingToAccountCurrencyRate/this.currency.exchangeRate,this.profitLoss):null}},{key:"profitLossPercentage",get:function(){return(0,o.calculateProfitAndLossPercentage)(this.profitLoss,this.bookCost)}},{key:"pointsMoved",get:function(){return t.getPointsMoved(this)}}],[{key:"getPointsMoved",value:function(e){if(!e.market)return null;var t=(e.latest-e.openLevel)*e.market.scalingFactor;return e.isShort()&&(t*=-1),isNaN(t)&&(t=0),t}},{key:"isValidEpic",value:function(e){return"string"==typeof e&&!e.match(/^FM\./)}},{key:"fromOPU",value:function(e,r){var n=e.epic,i=e.openPosition;return i.contractSize=(n.lotSize||1)*n.scalingFactor,i.createdDate=i.createdUTCDate,i.limitLevel=i.formattedLimitLevel,i.stopLevel=i.formattedStopLevel,i.displayName=n.displayName,t.fromDealingRestPosition(e,r)}},{key:"fromDealingRestPosition",value:function(e,r){var n=e.openPosition.openPositionData||e.openPosition,o=n.epic;if(o&&!t.isValidEpic(o))return null;var a=n.trailingStep||-1,s=a>-1,c={epic:o,exchangeRateFid:n.exchangeRateFid,bookCost:n.bookCost,indicativeCollateralValue:n.indicativeCollateralValue,contractSize:n.contractSize,currencyCodeISO:n.currencyCodeISO,currencySymbol:n.currencySymbol,createdDate:new Date(n.createdDate),channel:n.channel,dealId:n.dealId,dealSize:n.dealSize,direction:n.direction,displayPeriod:n.displayPeriod,period:n.period,epicOpenLevel:n.epicOpenLevel,isDMA:Object.prototype.hasOwnProperty.call(n,"isDMA")?n.isDMA:!!n.dma,limitLevel:(0,u.default)(n.limitLevel),limitType:i.default.Type.ABSOLUTE,stopLevelType:i.default.Type.ABSOLUTE,openLevel:n.openLevel,priceType:n.priceType,stopLevel:(0,u.default)(n.stopLevel),stopType:n.stopType,knockoutLevel:n.knockoutLevel,displayName:n.displayName,dmaOrderType:n.dma&&n.dma.orderType,dmaTimeInForce:n.dma&&n.dma.timeInForce,dmaPartiallyFilled:n.dma&&"Y"===n.dma.isPseudoPosition,priceInSizeShown:r&&r.featureFlags&&r.featureFlags.priceInSizeEnabled};return s&&(c.stopStep=a,c.stopTrailingDistance=n.trailingStopDistance),c.isSpreadbetAccount=Boolean(r&&r.user&&r.user.isSpreadbet),new t(c)}}]),t}(t.default),M(R.prototype,"exchangeRate",[h],Object.getOwnPropertyDescriptor(R.prototype,"exchangeRate"),R.prototype),M(R.prototype,"currency",[v],Object.getOwnPropertyDescriptor(R.prototype,"currency"),R.prototype),M(R.prototype,"latest",[g],Object.getOwnPropertyDescriptor(R.prototype,"latest"),R.prototype),M(R.prototype,"firstTierLatest",[_],Object.getOwnPropertyDescriptor(R.prototype,"firstTierLatest"),R.prototype),M(R.prototype,"positionValue",[O],Object.getOwnPropertyDescriptor(R.prototype,"positionValue"),R.prototype),M(R.prototype,"positionValueInBaseCurrency",[b],Object.getOwnPropertyDescriptor(R.prototype,"positionValueInBaseCurrency"),R.prototype),M(R.prototype,"epicPrice",[m],Object.getOwnPropertyDescriptor(R.prototype,"epicPrice"),R.prototype),M(R.prototype,"notionalValue",[T],Object.getOwnPropertyDescriptor(R.prototype,"notionalValue"),R.prototype),M(R.prototype,"notionalValueCurrencyCodeISO",[k],Object.getOwnPropertyDescriptor(R.prototype,"notionalValueCurrencyCodeISO"),R.prototype),M(R.prototype,"notionalValueInBaseCurrency",[S],Object.getOwnPropertyDescriptor(R.prototype,"notionalValueInBaseCurrency"),R.prototype),M(R.prototype,"underlyingPrice",[E],Object.getOwnPropertyDescriptor(R.prototype,"underlyingPrice"),R.prototype),M(R.prototype,"optionPrice",[P],Object.getOwnPropertyDescriptor(R.prototype,"optionPrice"),R.prototype),M(R.prototype,"tierOrdinal",[w],Object.getOwnPropertyDescriptor(R.prototype,"tierOrdinal"),R.prototype),M(R.prototype,"profitLoss",[L],Object.getOwnPropertyDescriptor(R.prototype,"profitLoss"),R.prototype),M(R.prototype,"profitLossTieredPricesPartialClose",[A],Object.getOwnPropertyDescriptor(R.prototype,"profitLossTieredPricesPartialClose"),R.prototype),M(R.prototype,"profitLossInBaseCurrency",[D],Object.getOwnPropertyDescriptor(R.prototype,"profitLossInBaseCurrency"),R.prototype),M(R.prototype,"profitLossPercentage",[I],Object.getOwnPropertyDescriptor(R.prototype,"profitLossPercentage"),R.prototype),M(R.prototype,"pointsMoved",[C],Object.getOwnPropertyDescriptor(R.prototype,"pointsMoved"),R.prototype),R);e.default=x}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ceil=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if("number"!=typeof e)return null;var r=Math.pow(10,t);return Math.ceil(Math.abs(e)*r)/r},e.round=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if("number"!=typeof e)return null;var r=Math.pow(10,t);return Math.round(Math.abs(e)*r)/r}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(5)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.calculateTierOrdinal=function(e,t,r,i,o,a){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!e)return 1;var u=e.getPiSLadder(i,t),c=u.length;if(c){var l=!0===s?r:n(i,r,o,a);if(null!==l&&!isNaN(l)){var p=u.findIndex((function(e){return l<=e.size}));return-1!==p?p+1:c}}return 1},e.calculateSizeIncludingRDW=n,e.getTieredLatestPrice=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments[3],o=e[("sell"===r?"bid":"offer")+n];return e.isKnockout&&void 0!==i?function(e,r,n){var i=Math.pow(10,e.decimalPlacesFactor);return e.knockoutType===t.KNOCKOUT_TYPES.BEAR?Math.round(Math.max(0,n-r)*i)/i:Math.round(Math.max(0,r-n)*i)/i}(e,o,i):o},e.adjustPrecisionOfTierSizeData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];if(!e||!Array.isArray(e))return[];return e.map((function(e){return r(e,{displaySize:e.displaySize&&i(parseFloat(e.displaySize),t).toString(),size:e.size&&i(e.size,t)})}))};var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function n(e,t,r,n){return!["buy","sell"].includes(e)||null===t||isNaN(t)?t:t+("buy"===e&&n&&n.size||"sell"===e&&r&&r.size||0||0)}function i(e,t){var r=Math.pow(10,t);return Math.trunc(e*r)/r}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={NON_GUARANTEED:"NON_GUARANTEED",GUARANTEED:"GUARANTEED",TRAILING:"TRAILING"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={DEAL_SUBMIT:"DEAL_SUBMIT",DEAL_FAILED:"DEAL_FAILED",FIRST_POLL:"FIRST_POLL",FINAL_DEAL_RESPONSE:"FINAL_DEAL_RESPONSE",INITIAL_DEAL_RESPONSE:"INITIAL_DEAL_RESPONSE"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(9),r(17),r(30),r(0)],i=function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getValidDMAOrderTypesFromMarketData=function(e,r,n,i){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!e)return[];var a=n===t.default.AUCTION,s=n===t.default.EDIT,u=r?e.close:e.new,c=a?u.AUCTION:u.CONTINUOUS;if(o&&s)return c.filter((function(e){return e.suitableForQueuedOrder}));if(o&&i)return c.filter((function(e){return e.suitableForConsiderationOrder}));return c},e.getValidExpiries=a,e.getFirstValidDMAOrderTypeFromMarketData=function(e,t,n,a){if(!e||!e.length)return{};var s=o(e,1)[0];if(n&&t)return(0,i.find)(e,{orderType:r.default[n]})||s;if(a)return(0,i.find)(e,{orderType:r.default[a]})||s;return s},e.getFirstValidOrderExpiry=function(e,t,r,i,o){var s=a(e,t.orderType),u=n.default[i],c=n.default[o];if(u&&s.includes(u)&&r)return u;if(c&&s.includes(c))return c;return t.timeInForce};var o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function a(e,t){return e.filter((function(e){return e.orderType===t})).map((function(e){return e.timeInForce}))}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=e.Condition={HIGHER:"HIGHER",LOWER:"LOWER"},r=e.PriceType={SELL_PRICE:"BID_PRICE",BUY_PRICE:"OFFER_PRICE"},n=e.ChangeType={PERCENT:"PERCENT",POINTS:"POINTS"},i=e.TimePeriod={FIVE_MINUTES:"FIVE_MINUTES",ONE_HOUR:"ONE_HOUR",ONE_DAY:"ONE_DAY"},o=e.Type={PRICE_CHANGE_ALERT:"PRICE_CHANGE_ALERT",PRICE_LEVEL_ALERT:"PRICE_ALERT",INDICATOR_ALERT:"INDICATOR_ALERT",ECON_ALERT:"ECON_ALERT",ECON_NEWSLETTER:"ECON_NEWSLETTER"},a=e.Status={TRIGGERED:"TRIGGERED",WAITING:"WAITING"};e.default={Type:o,PriceType:r,ChangeType:n,Condition:t,Status:a,TimePeriod:i}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(81),r(8),r(10),r(0),r(2),r(77),r(127),r(79),r(74)],i=function(e,t,r,n,i,o,a,s,u,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.ORDER_FID_SCHEMA=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var p,f,d,y,h,v=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function g(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var _=Object.freeze({WORKING:"WORKING",NOT_WORKING:"NOT_WORKING"}),O=e.ORDER_FID_SCHEMA={WO_LEVEL:"level",WO_CONTRACT_SIZE:"size",WO_RESERVED_CASH:"reservedCash",WO_STOP:"contingentStop",WO_STOP_TYPE_ENUM:"stopType",WO_TRAILING_STOP_DISTANCE:"trailingStopDistance",WO_TRAILING_STOP_INCREMENT:"trailingStopIncrement",WO_LIMIT:"contingentLimit",WO_TRAILING_TRIGGER_DISTANCE:"trailingTriggerDistance",WO_TRAILING_TRIGGER_INCREMENT:"trailingTriggerIncrement",WO_GOOD_TILL:"goodTill",WO_REQUEST_TYPE:"requestType",WO_WORKING_INDICATOR:"workingIndicator",WO_RELATIONSHIPS:"relationships",WO_RESTATED_SIZE:"restatedSize"},b=i.default.invert(O),m=(p=(0,o.default)("market","market.bid","market.offer"),f=(0,o.default)("goodTill","normalisedGoodTill","market"),d=(0,o.default)("triggeredBy","market.delayTime"),y=(0,o.default)("quantity","dealSize"),h=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),l(t,[{key:"canEdit",value:function(){return u.canEditOrder(this)}},{key:"canClose",value:function(){return u.canDeleteOrder(this)}},{key:"onStreamedUpdate",value:function(e){var t=function(t){return e.getValue(b[t])},r=(0,a.default)(t("contingentStop")||-1),n=(0,a.default)(t("trailingStopDistance")),i=(0,a.default)(t("trailingStopIncrement")),o=t("goodTill"),u=t("stopType"),c=t("workingIndicator"),l=t("relationships")||null,p=!1;if(l)try{p=JSON.parse(l)}catch(v){console.error("Cannot parse streamed order relationships!")}var f=(0,s.parseRelationships)(p),d=f.triggersOtherOrders,y=f.triggeredBy,h=f.cancelledBy;this.setProperties({dealSize:parseFloat(t("size")),quantity:parseFloat(t("restatedSize")),goodTill:o,openLevel:parseFloat(t("level")),orderType:t("requestType"),limitLevel:(0,a.default)(t("contingentLimit")),stopTrailingDistance:n,stopLevel:r,stopStep:i,stopType:u,isWorking:c===_.WORKING,relationships:p,triggersOtherOrders:d,triggeredBy:y,cancelledBy:h,reservedCash:parseFloat(t("reservedCash"))})}},{key:"updateFromOther",value:function(e){v(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateFromOther",this).call(this,e),this.setProperties(i.default.pick(e,["stopLevel","stopType","stopStep","stopTrailingDistance","limitLevel","openLevel","dealSize","quantity","goodTill","orderType","isWorking","reservedCash","relationships","triggersOtherOrders","triggeredBy","cancelledBy"]))}},{key:"latest",get:function(){if(!this.market)return null;var e=parseFloat(this.isShort()?this.market.bid:this.market.offer);return isNaN(e)?null:e}},{key:"goodTillUTCMillis",get:function(){return this.market?(0,c.toUTCMillisFromAccountTime)(this.normalisedGoodTill||this.goodTill,this.market.timezoneOffset):null}},{key:"triggerLevelEditable",get:function(){return!(this.triggeredBy||this.market&&this.market.delayTime)}},{key:"filledQuantity",get:function(){return this.quantity&&this.dealSize?this.quantity-this.dealSize:null}}],[{key:"fromWOU",value:function(e){return e.createdDate=e.createdUTCDate,e.dma=e.DMA,t.fromDealingRestOrder({workingOrder:{workingOrderData:e}})}},{key:"fromDealingRestOrder",value:function(e){var i=e.workingOrderData||e.workingOrder.workingOrderData,o=i.epic,u=i.trailingStopIncrement||-1,c=u>-1,l=(0,s.parseRelationships)(i.relationships),p=l.triggersOtherOrders,f=l.triggeredBy,d=l.cancelledBy,y={epic:o,currencyCodeISO:i.currencyCodeISO,currencySymbol:i.currency,createdDate:new Date(i.createdDate),clientOrderId:i.clientOrderId,dealId:i.dealId,dealSize:parseFloat(i.size),direction:i.direction,displayPeriod:i.displayPeriod,isDMA:i.isDMA,limitType:r.default.Type.RELATIVE,limitLevel:(0,a.default)(i.contingentLimit),openLevel:parseFloat(i.level),orderType:i.requestType,goodTill:i.goodTill,level:parseFloat(i.level),orderStopLevel:parseFloat(i.orderStopLevel),stopLevel:(0,a.default)(i.contingentStop),stopLevelType:r.default.Type.RELATIVE,stopType:i.stopType||n.default.Type.NON_GUARANTEED,isWorking:i.workingIndicator===_.WORKING,relationships:i.relationships||[],triggersOtherOrders:p,triggeredBy:f,cancelledBy:d,reservedCash:i.reservedCash,reservedCashCurrency:i.reservedCashCurrency,igInstrumentId:i.igInstrumentId,quantity:i.dma&&i.dma.fullDMASize,dmaOrderType:i.dma&&i.dma.orderType,dmaTimeInForce:i.dma&&i.dma.timeInForce};return c&&(y.stopStep=u,y.stopTrailingDistance=i.trailingStopDistance),new t(y)}}]),t}(t.default),g(h.prototype,"latest",[p],Object.getOwnPropertyDescriptor(h.prototype,"latest"),h.prototype),g(h.prototype,"goodTillUTCMillis",[f],Object.getOwnPropertyDescriptor(h.prototype,"goodTillUTCMillis"),h.prototype),g(h.prototype,"triggerLevelEditable",[d],Object.getOwnPropertyDescriptor(h.prototype,"triggerLevelEditable"),h.prototype),g(h.prototype,"filledQuantity",[y],Object.getOwnPropertyDescriptor(h.prototype,"filledQuantity"),h.prototype),h);e.default=m}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";var t;function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(e,"__esModule",{value:!0});var n="ACKNOWLEDGE",i="CANCELED",o="EDIT",a="EDIT_BOOKCOST",s="FULL_FILL",u="PARTIAL_FILL",c="REJECTION",l="UNSUPPORTED",p=(r(t={},c,7),r(t,s,6),r(t,u,5),r(t,i,4),r(t,o,3),r(t,a,2),r(t,n,1),r(t,l,0),t),f=[c,s];e.ACKNOWLEDGE=n,e.CANCELLED=i,e.EDIT=o,e.EDIT_BOOKCOST=a,e.FULL_FILL=s,e.PARTIAL_FILL=u,e.REJECTION=c,e.UNSUPPORTED=l,e.REPORT_TYPE_PRIORITIES=p,e.IMMEDIATE_RESPONSE_REPORT_TYPES=f}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(82),r(3),r(2),r(75),r(124),r(0)],i=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var u,c,l,p,f,d,y=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function h(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var v=(u=(0,n.default)("size","pointsThroughCurrent","isSell","offerPrice","bidPrice","marketOrder"),c=(0,n.default)("maximumRisk","currency"),l=(0,n.default)("size","market.commissionsRateType","market.commissionsCharge","market.commissionsMinCharge"),p=(0,n.default)("size","direction","market.swapRateShort","market.swapRateLong","market.valueOfOnePip"),f=(0,n.default)("swapCost","currency"),d=function(e){function t(e,r,n,i){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o=t.__proto__||Object.getPrototypeOf(t)).call.apply(o,[this,{stopRequired:!1,limitRequired:!1}].concat(Array.prototype.slice.call(arguments))));if(a.market.isOption&&a.market.strikeLevel||(i.applyLastTradedStop(a),i.applyLastTradedLimit(a),i.applyLastTradedSizeAndCurrency(a),i.applyLastTradedPointsThroughCurrent(a)),i.applyDefaultLevel(a),a.market&&a.market.isKnockout&&!a.knockoutLevel){var s=a.market.knockoutLevels&&a.market.knockoutLevels[0];a.knockoutLevel=a.market.knockoutDefaultLevel||s}return a._validate(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"_getValidators",value:function(){var e=[r.direction,r.marketDealable,r.sizeAboveMin,r.sizeAboveZero,r.controlledRiskTradingAvailable,r.hasLiveData],t=this.market.instrumentType;return t.match(/^OPT|^BINARY/i)||(e=e.concat([r.stop])),"BINARY"!==t&&(e=e.concat([r.limit])),e}},{key:"toJSON",value:function(){var e=this.market,t=this.settings,r=this._hasTrailingStop(),n=this.direction,i=t.showPartialFill?this.partialFill:t.partialFill,o=this.pointsThroughCurrent,a=this.margin,s=this.knockoutLevel,u=this._session.user.broker,c={currencyCode:this.currency.name,dealReference:this.dealReference,direction:n?n.toUpperCase():null,guaranteedStop:this._hasGuaranteedStop(),level:this.orderLevel,epic:e.epic,limitDistance:this.limitDistance,orderType:this.orderType,size:this.size,stopDistance:this.stopDistance,submittedTimestamp:+this._getSubmittedTimestamp(),timeInForce:i?"EXECUTE_AND_ELIMINATE":"FILL_OR_KILL",trailingStop:r,trailingStopIncrement:r?this.stopStep:null,expiry:e.prompt,quoteId:this.quoteId};if(u&&u.decisionMakerAccountId&&(c.decisionMakerAccountId=u.decisionMakerAccountId),e.isKnockout||(c.forceOpen=this.forceOpen),(0===o||o>0)&&(c.pointsThroughCurrent=o),s&&(c.knockoutLevel=s),a){var l=a.depositDeltaAccountCcy.currencyCode,p=a.depositDeltaAccountCcy.amount;c.dealTicketMargin={},l&&(c.dealTicketMargin.marginCurrency=l),p&&(c.dealTicketMargin.marginValue=String(p))}return c}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.showClosing?this.indicativeCostsAndChargesService.getIndicativeCloseQuote(this):this.indicativeCostsAndChargesService.getIndicativeOpenQuote(this)}},{key:"iccDirection",get:function(){return this.showClosing?"sell"===this.direction?"buy":"sell":this.direction}},{key:"maximumRisk",get:function(){return(0,i.default)(this.size,this.pointsThroughCurrent,this.isSell?this.bidPrice:this.offerPrice,this.market.valueOfOnePoint,this.marketOrder)}},{key:"maximumRiskInAccountCurrency",get:function(){return this.currency.baseExchangeRate?this.maximumRisk/this.currency.baseExchangeRate:null}},{key:"commission",get:function(){return(0,o.default)(this.size,this.market.commissionsRateType,this.market.commissionsCharge,this.market.commissionsMinCharge)}},{key:"swapCost",get:function(){var e=this.size,t=this.direction,r=this.isSell?this.market.swapRateShort:this.market.swapRateLong,n=this.market&&this.market.valueOfOnePip;return e&&t&&!(0,a.isNil)(r)&&n?r*e*n:null}},{key:"swapCostInAccountCurrency",get:function(){return(0,a.isNil)(this.swapCost)?null:this.swapCost/this.currency.baseExchangeRate}},{key:"_validationDependentKeys",get:function(){return[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_validationDependentKeys",this)),["stopRequired","limitRequired"])}}]),t}(t.default),h(d.prototype,"maximumRisk",[u],Object.getOwnPropertyDescriptor(d.prototype,"maximumRisk"),d.prototype),h(d.prototype,"maximumRiskInAccountCurrency",[c],Object.getOwnPropertyDescriptor(d.prototype,"maximumRiskInAccountCurrency"),d.prototype),h(d.prototype,"commission",[l],Object.getOwnPropertyDescriptor(d.prototype,"commission"),d.prototype),h(d.prototype,"swapCost",[p],Object.getOwnPropertyDescriptor(d.prototype,"swapCost"),d.prototype),h(d.prototype,"swapCostInAccountCurrency",[f],Object.getOwnPropertyDescriptor(d.prototype,"swapCostInAccountCurrency"),d.prototype),d);e.default=v}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={GOOD_FOR_DAY:"GoodForDay",GOOD_FOR_DAY_ALL_SESSIONS:"GoodForDayAllSessions",GOOD_TILL_CANCELLED:"GoodTillCancelled",EXECUTE_AND_ELIMINATE:"ExecuteAndEliminate",FILL_OR_KILL:"FillOrKill"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(8),r(0)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=i===t.default.Type.ABSOLUTE;if((0,r.isEmpty)(e))return null;if("pts"===e.unit)return a?e.value/o:e.value;if("pct"===e.unit&&n)return a||(n*=o),n*e.value/100;return null}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(23),r(8),r(0)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getMinimumDistanceFromMarket=function(e,r){if(n.default.isEmpty(e)||n.default.isEmpty(r)||n.default.isEmpty(r.dealingRules))return null;if(e===t.default.GUARANTEED)return r.dealingRules.minControlledRiskStopDistance;return r.dealingRules.minNormalStopOrLimitDistance},e.getMinimumDistanceValueForExistingPosition=function(e,i,o){var a=function(e){return e===t.default.GUARANTEED};if(e.stopLevelType!==r.default.Type.ABSOLUTE||n.default.isNil(i)||n.default.isNil(e.stopLevel)||a(e.stopType)!==a(o))return i;var s=("-"===e.direction?1:-1)*(e.stopLevel-e.firstTierLatest);return Math.min(Math.max(0,s),i)}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(7)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var i=function(e){function t(e,r,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o._subscriptionString=e,o._messageKey=r,o._lightstreamerService=n,o._isJson=i,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_handleMessage",value:function(e){var r=this._messageKey,n=r.length,i=e.getValue(r);if(i.substring(0,n)===r&&(i=i.substring(n+1)),this._isJson)try{this.trigger(t.Events.UPDATED,JSON.parse(i))}catch(o){}else this.trigger(t.Events.UPDATED,i)}},{key:"startListening",value:function(e){if(!this._subscription){var t=this._subscriptionString.replace("{identifier}",e);this._subscription=this._lightstreamerService.subscribe(t,[this._messageKey],"RAW",this._handleMessage.bind(this))}return this}},{key:"stopListening",value:function(){return this._subscription&&(this._subscription.unsubscribe(),this._subscription=null),this}},{key:"destroy",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.stopListening()}}]),t}(t.default);i.Events={UPDATED:"UPDATED"},e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(6),r(20),r(10),r(8),r(2),r(0),r(23),r(18),r(22),r(72)],i=function(e,t,r,n,i,o,a,s,u,c,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var f,d,y,h,v,g,_,O,b,m,T,k,S,E=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function P(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var w=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var L=(f=(0,o.default)("dealSize","positions"),d=(0,o.default)("dealSize","positions"),y=(0,o.default)("market","latest"),h=(0,o.default)("market","direction","dealSize","latest","rdwOffer","rdwBid"),v=(0,o.default)("latest"),g=(0,o.default)("latest","openLevel"),_=(0,o.default)("profitLoss"),O=(0,o.default)("dealSize","latest"),b=(0,o.default)("dealSize","latest"),m=(0,o.default)("latest","dealSize","direction","market"),T=(0,o.default)("positionValue","contractSize"),k=(0,o.default)("notionalValue"),S=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e[0],o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{epic:n.epic,contractSize:n.contractSize,currency:n.currency,currencyCodeISO:n.currencyCodeISO,displayName:n.displayName,displayPeriod:n.displayPeriod,direction:n.direction,id:t.generateAggregateId(n),isPriceTypeBackOnly:null,isUS:r,market:n.market,period:n.period,positions:[],riskType:n.riskType,limitType:i.default.Type.ABSOLUTE,stopLevelType:i.default.Type.ABSOLUTE,rdwBid:null,rdwOffer:null,priceInSizeShown:n.priceInSizeShown,sterlingToAccountCurrencyRate:n.sterlingToAccountCurrencyRate}));return o._latestWithDependencies=["latest"].concat(o.batchChangesForKeys(["latest"])),e.forEach(o.addPosition,o),o.proxyChangesFor("rdwOffer","rdwBid"),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),p(t,[{key:"addPosition",value:function(e){var r=this.positions;r.length||this._subscribeToFirstPosition(e),r.push(e),this._onPositionChange(t.positionKeys),e.on("change",this._onPositionChange,this)}},{key:"_onFirstPositionChange",value:function(e){var t=[];e.includes("latest")&&(t=t.concat(this._latestWithDependencies)),(e.includes("exchangeRate")||e.includes("sterlingToAccountCurrencyRate"))&&t.push("profitLossInBaseCurrency","notionalValueInBaseCurrency"),e.includes("underlyingPrice")&&t.push("underlyingPrice"),t.length&&this.trigger("change",t)}},{key:"_onPositionChange",value:function(e){var r=a.default.intersection(t.positionKeys,e);r.length&&this.trigger("change",r.concat(this.batchChangesForKeys(r)))}},{key:"removePosition",value:function(e){var r=this.positions;if(r.length){var n=r.indexOf(e);-1!==n&&(e.off("change",this._onPositionChange,this),e.off("change",this._onFirstPositionChange,this),r.splice(n,1),0===n&&r[0]&&this._subscribeToFirstPosition(r[0])),this._onPositionChange(t.positionKeys)}}},{key:"_subscribeToFirstPosition",value:function(e){this.setProperties({isPriceTypeBackOnly:e.isPriceTypeBackOnly()}),e.on("change",this._onFirstPositionChange,this)}},{key:"canEdit",value:function(){return this.positions.every((function(e){return e.canEdit()}))}},{key:"canClose",value:function(){return this.positions.every((function(e){return e.canClose()}))}},{key:"isShort",value:function(){return"-"===this.direction}},{key:"_calculateWeightedAverage",value:function(e){return this.positions.length?a.default.sumBy(this.positions,(function(t){return t[e]*t.dealSize}))/this.dealSize:null}},{key:"profitLossTieredPricesPartialClose",value:function(e){var t=this.isShort()?"buy":"sell",r=(0,c.calculateTierOrdinal)(this.market,this.currencyCodeISO,e,t,this.rdwBid,this.rdwOffer),n=(0,c.getTieredLatestPrice)(this.market,t,r);return(0,u.calculateProfitAndLoss)(n,this.openLevel,this.contractSize,e,this.isShort(),this.isPriceTypeBackOnly)}},{key:"_sumOfPositions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.positions;return r.length?t&&r.every((function(t){return null===t[e]}))?null:Math.round(1e4*a.default.sumBy(r,(function(t){return+t[e]||0})))/1e4:null}},{key:"destroy",value:function(){var e=this;this.positions.forEach((function(t){t.off("change",e._onPositionChange,e),t.off("change",e._onFirstPositionChange,e)})),E(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"dmaPartiallyFilled",get:function(){return this.positions.some((function(e){return e.dmaPartiallyFilled}))}},{key:"isDMA",get:function(){return this.positions.some((function(e){return e.isDMA}))}},{key:"isAllDMAPositions",get:function(){return this.positions.every((function(e){return e.isDMA}))}},{key:"openLevel",get:function(){return this._calculateWeightedAverage("openLevel")}},{key:"epicOpenLevel",get:function(){return this._calculateWeightedAverage("epicOpenLevel")}},{key:"latest",get:function(){if(this.priceInSizeShown){var e=this.isShort()?"buy":"sell";return(0,c.getTieredLatestPrice)(this.market,e,this.tierOrdinal,this.knockoutLevel)}return this.positions.length?this.positions[0].latest:null}},{key:"firstTierLatest",get:function(){if(this.priceInSizeShown){var e=this.isShort()?"buy":"sell";return(0,c.getTieredLatestPrice)(this.market,e,1,this.knockoutLevel)}return this.positions.length?this.positions[0].latest:null}},{key:"tierOrdinal",get:function(){var e=this.isShort()?"buy":"sell";return(0,c.calculateTierOrdinal)(this.market,this.currencyCodeISO,this.dealSize,e,this.rdwBid,this.rdwOffer)}},{key:"underlyingPrice",get:function(){return this.positions.length?this.positions[0].underlyingPrice:null}},{key:"optionPrice",get:function(){return this.positions.length?this.positions[0].optionPrice:null}},{key:"knockoutLevel",get:function(){return this.positions.length?this.positions[0].knockoutLevel:null}},{key:"pointsMoved",get:function(){return r.default.getPointsMoved(this)}},{key:"limitLevel",get:function(){var e=this.positions.map((function(e){return e.limitLevel}));return function(e){if(!e.length)return!1;var t=e[0];return!!t&&e.every((function(e){return e===t}))}(e)?e[0]:null}},{key:"stopLevel",get:function(){var e=this.positions.map((function(e){return{level:e.stopLevel,type:e.stopType,trailingStopDistance:e.stopTrailingDistance,trailingStopIncrement:e.stopStep}}));return function(e,t){if(!e.length)return!1;var r=w(e,1)[0],i=r.level,o=r.type,a=r.trailingStopDistance,s=r.trailingStopIncrement;return!(!i||t&&o===n.default.Type.GUARANTEED||!t&&o===n.default.Type.TRAILING)&&e.every((function(e){var r=!0;return t&&o===n.default.Type.TRAILING&&(r=e.trailingStopDistance===a&&e.trailingStopIncrement===s),e.level===i&&e.type===o&&r}))}(e,this.isUS)?e[0].level:null}},{key:"stopTrailingDistance",get:function(){if(this.isUS&&this.stopLevel){var e=this.positions.length&&this.positions[0].stopTrailingDistance;if(e&&this.positions.every((function(t){return t.stopTrailingDistance===e})))return e}return null}},{key:"stopStep",get:function(){if(this.isUS&&this.stopLevel){var e=this.positions.length&&this.positions[0].stopStep;if(e&&this.positions.every((function(t){return t.stopStep===e})))return e}return null}},{key:"stopType",get:function(){var e=this.positions.length&&this.positions[0].stopType===n.default.Type.GUARANTEED,t=this.isUS&&this.positions.length&&this.positions[0].stopType===n.default.Type.TRAILING;return e?n.default.Type.GUARANTEED:t?n.default.Type.TRAILING:n.default.Type.NON_GUARANTEED}},{key:"dealSize",get:function(){return this._sumOfPositions("dealSize")}},{key:"profitLossInBaseCurrency",get:function(){return this.priceInSizeShown?this.currency?1===this.currency.exchangeRate?this.profitLoss:(0,l.default)(this.currency.baseExchangeRate,this.profitLoss):null:this._sumOfPositions("profitLossInBaseCurrency")}},{key:"profitLoss",get:function(){return this.priceInSizeShown?(0,u.calculateProfitAndLoss)(this.latest,this.openLevel,this.contractSize,this.dealSize,this.isShort(),this.isPriceTypeBackOnly):this._sumOfPositions("profitLoss")}},{key:"positionValue",get:function(){return this._sumOfPositions("positionValue")}},{key:"notionalValue",get:function(){return this._sumOfPositions("notionalValue",!0)}},{key:"notionalValueInBaseCurrency",get:function(){return this._sumOfPositions("notionalValueInBaseCurrency",!0)}},{key:"notionalValueCurrencyCodeISO",get:function(){return this.positions.length?this.positions[0].notionalValueCurrencyCodeISO:null}}],[{key:"generateAggregateId",value:function(e){var t=e.knockoutLevel?"-"+e.knockoutLevel:"",r=e.period&&e.market&&e.market.isKnockout?"-"+e.period.trim():"",n=e.stopType===s.default.GUARANTEED?2:1;return e.epic+"-"+e.direction+"-"+e.currencyCodeISO+"-"+n+t+r}},{key:"positionKeys",get:function(){return["dealSize","limitLevel","stopLevel","stopType","stopStep","stopTrailingDistance"]}}]),t}(t.default),P(S.prototype,"openLevel",[f],Object.getOwnPropertyDescriptor(S.prototype,"openLevel"),S.prototype),P(S.prototype,"epicOpenLevel",[d],Object.getOwnPropertyDescriptor(S.prototype,"epicOpenLevel"),S.prototype),P(S.prototype,"firstTierLatest",[y],Object.getOwnPropertyDescriptor(S.prototype,"firstTierLatest"),S.prototype),P(S.prototype,"tierOrdinal",[h],Object.getOwnPropertyDescriptor(S.prototype,"tierOrdinal"),S.prototype),P(S.prototype,"optionPrice",[v],Object.getOwnPropertyDescriptor(S.prototype,"optionPrice"),S.prototype),P(S.prototype,"pointsMoved",[g],Object.getOwnPropertyDescriptor(S.prototype,"pointsMoved"),S.prototype),P(S.prototype,"profitLossInBaseCurrency",[_],Object.getOwnPropertyDescriptor(S.prototype,"profitLossInBaseCurrency"),S.prototype),P(S.prototype,"profitLoss",[O],Object.getOwnPropertyDescriptor(S.prototype,"profitLoss"),S.prototype),P(S.prototype,"profitLossTieredPricesPartialClose",[b],Object.getOwnPropertyDescriptor(S.prototype,"profitLossTieredPricesPartialClose"),S.prototype),P(S.prototype,"positionValue",[m],Object.getOwnPropertyDescriptor(S.prototype,"positionValue"),S.prototype),P(S.prototype,"notionalValue",[T],Object.getOwnPropertyDescriptor(S.prototype,"notionalValue"),S.prototype),P(S.prototype,"notionalValueInBaseCurrency",[k],Object.getOwnPropertyDescriptor(S.prototype,"notionalValueInBaseCurrency"),S.prototype),S);e.default=L}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(6),r(10),r(8),r(0)],i=function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.defaultSettings=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=e.defaultSettings={defaultLevelType:n.default.Type.RELATIVE,forceOpen:!1,marketOrder:!1,partialFill:!1,rememberLastTradedLimitDistance:!1,rememberLastTradedSize:!1,rememberLastTradedStopTypeAndDistance:!1,rememberLastTradedPointsThroughCurrent:!1,rememberLastTradedOrderTypeAndExpiry:!1,showForceOpen:!1,showMarketOrder:!1,showPartialFill:!1,showPointsThroughCurrent:!1,showNotionalValue:!1,_usedDefaultForceOpen:!1,_usedDefaultShowForceOpen:!1},s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i.default.merge({},a,e)));return r._usedDefaultForceOpen=!e||!Object.prototype.hasOwnProperty.call(e,"forceOpen")||Object.prototype.hasOwnProperty.call(e,"_usedDefaultForceOpen")&&e._usedDefaultForceOpen,r._usedDefaultShowForceOpen=!e||!Object.prototype.hasOwnProperty.call(e,"showForceOpen")||Object.prototype.hasOwnProperty.call(e,"_usedDefaultShowForceOpen")&&e._usedDefaultShowForceOpen,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"applyLastTradedCurrency",value:function(e){if(this.rememberLastTradedSize){var t=i.default.find(e.currencies,(function(t){return t.name===e.market.lastTradedCurrency}));e.set("currency",t||e.currency)}}},{key:"applyLastTradedSizeAndCurrency",value:function(e){if(this.rememberLastTradedSize){var t=i.default.find(e.currencies,(function(t){return t.name===e.market.lastTradedCurrency}));e.set("currency",t||e.currency),e.set("size",e.market.lastTradedSize)}}},{key:"applyLastTradedStop",value:function(e){var t=e.getDefaultStopType();if(this.rememberLastTradedStopTypeAndDistance){var i=this.defaultLevelType;e.set("stopType",r.default.getValidStopType(e.stopTypes,e.market.lastTradedStopType||t||r.default.Type.NON_GUARANTEED));var o=null;i===n.default.Type.RELATIVE&&(o=e.market.lastTradedStopDistance||null),e.setProperties({stopStep:e.market.lastTradedTrailingStopIncrement,stopLevel:o,stopLevelType:i})}else t&&e.set("stopType",t)}},{key:"applyLastTradedLimit",value:function(e){if(this.rememberLastTradedLimitDistance){var t=this.defaultLevelType,r=void 0;r=t===n.default.Type.RELATIVE?e.market.lastTradedLimitDistance:null,e.setProperties({limitLevel:r,limitType:t})}}},{key:"applyLastTradedPointsThroughCurrent",value:function(e){this.rememberLastTradedPointsThroughCurrent&&e.set("pointsThroughCurrent",e.market.lastTradedPointsThroughCurrent)}},{key:"applyDefaultLevel",value:function(e){var t=this.defaultLevelType;e.setProperties({stopLevelType:t,limitType:t})}}]),t}(t.default);e.default=s}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(1),r(83)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.INITIAL_ICC=e.ICC_EDIT_TYPES=e.ICC_API_STATES=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=Object.freeze(["atm","atf","dem","def","det","esm","esf","est","frm","frf","frt","itm","itf","itt","nlm","nlf","nlt","nom","nof","not","sem","sef","set","iem","ief","iet","iei","eng","enf","ent","por","pof"]),a=Object.freeze(["atm","atf","dem","def","esm","esf","frm","frf","itm","itf","nlm","nlf","nom","nof","sem","sef","iem","ief","iei","eng","enf","por","pof"]),s=Object.freeze(["igm","igi"]),u=Object.freeze(["sgx"]),c=Object.freeze(["aum"]),l=Object.freeze(["dbm"]),p=e.ICC_API_STATES=Object.freeze({NOT_FETCHED:"NOT_FETCHED",FETCHING:"FETCHING",FETCHED:"FETCHED",ERROR:"ERROR"}),f=Object.freeze({OPEN:"/open",EDIT:"/edit",CLOSE:"/close"}),d=(e.ICC_EDIT_TYPES=Object.freeze({STOP:"STOP",LIMIT:"LIMIT"}),e.INITIAL_ICC={indicativeCostsAndCharges:null,indicativeCostsAndChargesState:p.NOT_FETCHED}),y=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._heartbeat=r;var i=t.environment,p=void 0===i?{}:i,f=t.user,d=void 0===f?{}:f,y="PWA_IG"===p.platform,h=y?a:o,v=y?[]:s,g=y?[]:u,_=y?[]:l;this.showExAnteCostsAndCharges=n||!0===d.isRetailAccount&&h.includes(d.siteId),this.showUkCostsAndCharges=!0===d.isRetailAccount&&v.includes(d.siteId),this.showSingaporeanCostsAndCharges=g.includes(d.siteId),this.showAustralianCostsAndCharges=!y&&c.includes(d.siteId)&&"en-GB"===d.locale,this.showDubaianCostsAndCharges=_.includes(d.siteId)}return i(e,[{key:"reset",value:function(e){this.abortQuoteRequest(e),e.setProperties(d)}},{key:"abortQuoteRequest",value:function(e){e._indicativeCostsAndChargesAbortController&&(e._indicativeCostsAndChargesAbortController.abort(),e._indicativeCostsAndChargesAbortController=null)}},{key:"getIndicativeOpenQuote",value:function(e){return this._getIndicativeQuote(e,f.OPEN,{priceLevel:e.iccPriceLevel,stop:e.iccStopLevel,limit:e.iccLimitLevel,epic:e.market.epic,dma:e.isDMA})}},{key:"getIndicativeEditQuote",value:function(e){var t=e.position&&this._isDmaCostQuote(e.position);return this._getIndicativeQuote(e,f.EDIT,{openingLevel:e.iccPriceLevel,stopLevel:e.iccStopLevel,limitLevel:e.iccLimitLevel,dma:t})}},{key:"getIndicativeCloseQuote",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={openingLevel:e.iccOpeningLevel,stopLevel:e.iccStopLevel,dma:e.isDMA};return t&&(r.priceLevel=e.iccPriceLevel),this._getIndicativeQuote(e,f.CLOSE,r)}},{key:"_isDmaCostQuote",value:function(e){var t=e.positions,r=e.isAllDMAPositions,n=e.isDMA;return t?r:n}},{key:"_getIndicativeQuote",value:function(e,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.abortQuoteRequest(e),e._indicativeCostsAndChargesAbortController=new r.AbortController,e.setProperties({indicativeCostsAndCharges:null,indicativeCostsAndChargesState:p.FETCHING}),e.skipICCRequest)return Promise.resolve();var a=this._session.user,s=a.broker&&a.broker.currentAccountId?"/dealing-gateway/costsandcharges/broker/"+a.clientId+"/account/"+a.accountId+"/proxyAccount/"+a.broker.currentAccountId+i:"/dealing-gateway/costsandcharges/"+a.accountId+i,u=n({},this._createCommonQuoteJSON(e),o);return i===f.EDIT&&(u.editType=e.indicativeCostsAndChargesEditType),t.post(s,this._session,u,{},e._indicativeCostsAndChargesAbortController).then((function(t){e.setProperties({indicativeCostsAndCharges:t,indicativeCostsAndChargesState:p.FETCHED})})).catch((function(t){"AbortError"!==t.name&&e.setProperties({indicativeCostsAndCharges:null,indicativeCostsAndChargesState:p.ERROR})})).finally((function(){e._indicativeCostsAndChargesAbortController=null}))}},{key:"_createCommonQuoteJSON",value:function(e){var t=this._session.user.isSpreadbet&&e.isEditTicket&&e.isOrder,r=this._session.user.isSpreadbet&&e.isCloseTicket&&e.isPosition,n=t||r,i=null;return n&&(i=t?e.order.currencyCodeISO:e.position.currencyCodeISO),{accountId:this._session.user.accountId,ask:parseFloat(e.offerPrice),bid:parseFloat(e.bidPrice),dealCurrencyCode:n?i:e.currency.name,dealReference:e.dealReference,direction:e.iccDirection.toUpperCase(),editType:null,guaranteedStop:e._hasGuaranteedStop(),instrumentId:e.market.igInstrumentId,knockoutPremium:e.market.knockoutPremium?e.market.knockoutPremium:null,size:e.iccSize}}}]),e}();e.default=y}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(27),r(5),r(142),r(143),r(144),r(61),r(1),r(0)],i=function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._confirmationStreamingClient=r,this._dealReferenceGenerator=n}return c(e,[{key:"create",value:function(e){return new n.default(e,this._session,this._confirmationStreamingClient)}},{key:"delete",value:function(e){return new i.default(e,this._session,this._confirmationStreamingClient)}},{key:"getAll",value:function(){var r="/"+this._session.environment.path+"/wtp/orders/workingorders";return s.get(r,this._session).then((function(r){var n=e.parseMarkets(r);return{orders:r.map((function(e){return e.marketData?t.default.fromDealingRestOrder(e):null})).filter(u.default.identity),markets:n}}))}},{key:"edit",value:function(e){return new o.default(e,this._session,this._confirmationStreamingClient)}},{key:"destroy",value:function(){this._session=null,this._dealReferenceGenerator=null}}],[{key:"getStreamingClient",value:function(e){return new a.default(e)}},{key:"parseMarkets",value:function(e){var t=u.default.uniqBy(e,"workingOrderData.epic").map((function(e){var t=e.marketData;return r.default.populateWithV2MarketData(t)})).filter(Boolean);return u.default.keyBy(t,"epic")}}]),e}();e.default=l}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t="STARTED",r="PENDING",n="CANCELED",i="CONFIRMED",o="REJECTED",a="UNVERIFIED",s="FAILED",u="ABORTED",c=[u,s,o,a,n],l=c.concat(i),p=[t,r];e.NOT_STARTED="NOT_STARTED",e.STARTED=t,e.PENDING=r,e.CONFIRMED=i,e.CANCELLED=n,e.REJECTED=o,e.UNVERIFIED=a,e.FAILED=s,e.ABORTED=u,e.IN_PROGRESS_STATES=p,e.UNSUCCESSFUL_COMPLETED_STATES=c,e.COMPLETED_STATES=l}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(0),r(7),r(28)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var a=function(e){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n._lightstreamerService=e,n._accountId=t,n._listeners=[],n._updates=[],n._removeListenersImmediately=!0,n._startListening(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),i(r,[{key:"waitForConfirm",value:function(e){var t=this;return new Promise((function(r,n){t._listeners.push(t.getListener(e,r,n)),t._tryResolveOrReject()}))}},{key:"getListener",value:function(e,t,r){return{dealReference:e,resolve:t,reject:r}}},{key:"destroy",value:function(){this._subscription&&(this._subscription.unsubscribe(),this._subscription=null),this._updates=null,this._listeners=null,o(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"_startListening",value:function(){var e=this._accountId;this._subscription=this._lightstreamerService.subscribe("V2-M-MESSAGE_EVENT_HANDLER|"+e+"-ERS",["update"],"RAW",this._handleUpdateFromLightstreamer.bind(this),2)}},{key:"_tryResolveOrReject",value:function(){var e=this,r=t.default.map(this._updates,"content.dealReference"),i=t.default.map(this._listeners,"dealReference"),o=t.default.intersection(r,i);t.default.filter(this._updates,(function(e){return t.default.includes(o,e.content.dealReference)})).forEach((function(r){var i=t.default.get(r,"content.reportType"),o=t.default.filter(e._listeners,(function(e){return e.dealReference===r.content.dealReference}));"DMA"===r.category||"OTC"===r.category||"EXCHANGE"===r.category&&i!==n.CANCELLED?o.forEach((function(e){return e.resolve(r)})):(["OTC_REJECTED","EXCHANGE_REJECTED","DMA_REJECTED"].includes(r.category)||"EXCHANGE"===r.category&&i===n.CANCELLED)&&o.forEach((function(e){return e.reject(r)})),e._removeListenersImmediately&&(e._listeners=t.default.difference(e._listeners,o))})),this._updates=t.default.takeRight(this._updates,500)}},{key:"_handleUpdateFromLightstreamer",value:function(e){var t=e.getValue("update");if("INV"!==t){var r=JSON.parse(t);r.category&&(this._updateRDW(r),this._updates.push(r),this._tryResolveOrReject())}}},{key:"_updateRDW",value:function(e){var t=e.content.epic,r=e.content.currency,n=e.content.direction,i=e.content.repeatDealingWindow&&e.content.repeatDealingWindow.entries;t&&r&&n&&i&&this.trigger("rdw",[t,r,n.toLowerCase(),i])}}]),r}(r.default);e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(15),r(5)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var o=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i="PRICE:"+n.user.accountId+":{id}{modifiers}",o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,"MERGE",r,!0,"Pricing"));return o._session=n,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"add",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e.isUnpriced){var o=Object.keys(r.PIS_FID_SCHEMA);e.isKnockout||(o=o.filter((function(e){return"KO_PREMIUM"!==e}))),this._session.user.isMTF&&(o=o.filter((function(e){return"MIDPRICE"!==e}))),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e.epic,o,e.boundOnStreamedPriceUpdate,n)}}},{key:"remove",value:function(e){return!e.isUnpriced&&i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e.boundOnStreamedPriceUpdate)}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(20),r(15)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var o=Object.keys(t.POSITION_FID_SCHEMA),a=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"V2-M-{fids}{modifiers}|{id}","MERGE",r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"add",value:function(e){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e.dealId,this.getFids(),e.boundOnStreamedUpdate)}},{key:"remove",value:function(e){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e.boundOnStreamedUpdate)}},{key:"getFids",value:function(){return o}}]),t}(r.default);e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(15),r(5)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.BINARY_FIDS=e.KO_V2_FIDS=e.KO_FIDS=e.FIDS=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var o=e.FIDS=Object.keys(r.V2_TO_V4_FID_MAPPING).filter((function(e){return"MKT"!==e})),a=e.KO_FIDS=Object.keys(r.KO_FID_SCHEMA),s=e.KO_V2_FIDS=Object.keys(r.KO_V2_FID_SCHEMA),u=e.BINARY_FIDS=Object.keys(r.V2_TO_V4_FID_MAPPING),c=/(?:\.FREE)*$/,l=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"V2-F-{fids}{modifiers}|{id}","MERGE",r,!0))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"add",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=arguments[2];if(!e.isUnpriced){var l=e.isBinary?u:o,p=e.isKnockoutV2?[]:r.default.getFidsForSwapRate(c,["LONG","SHORT"]),f=e.isKnockout?a:[],d=e.isKnockoutV2?s:[];i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,this._getEpicForStreaming(e),l.concat(p,f,d),e.boundOnStreamedV2Update,n.concat(e.getSubscriptionModifiers()))}}},{key:"remove",value:function(e){if(!e.isUnpriced)return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e.boundOnStreamedV2Update)}},{key:"_getEpicForStreaming",value:function(e){var t=e.epic;return e.isFree?t.replace(c,".FREE"):t}}]),t}(t.default);e.default=l}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0),r(29),r(3),r(2),r(9),r(22)],i=function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var c,l,p,f,d,y,h=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function v(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var g=(c=(0,i.default)("size","position","position.priceInSizeShown","position.profitLoss","position.dealSize"),l=(0,i.default)("market","market.marketStatus"),p=(0,i.default)("position.latest","market.lotSize","size"),f=(0,i.default)("direction","size","sizeIncludingRDW","ladder","position.currency"),d=(0,i.default)("position.dealSize"),y=function(e){function r(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=r.__proto__||Object.getPrototypeOf(r)).call.apply(n,[this,e,t.market].concat(o)));return s.set("isCloseTicket",!0),s.set("position",t),s.set("stopLevel",t.stopLevel),s.set("stopType",t.stopType),s.set("stopLevelType",t.stopLevelType),s.set("limitLevel",t.limitLevel),s.set("limitType",t.limitType),s.set("size",t.dealSize),s.set("direction","+"===t.direction?"sell":"buy"),s.set("sizeMaxDecimalPlaces","S"===t.market.unit?0:2),s.position.on("change",s._onPositionChange,s),s.market&&s.market.isKnockout&&(s.knockoutLevel=t.knockoutLevel),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),u(r,[{key:"_onPositionChange",value:function(e){var t=this.batchChangesForKeys(e,"position");t.length&&this.trigger("change",t),e.includes("stopLevel")&&this.set("stopLevel",this.position.stopLevel)}},{key:"_getValidators",value:function(){return[n.direction,n.marketDealable,n.sizeBelowMax,n.sizeAboveZero]}},{key:"_getMargin",value:function(){return this.marginService.getClosePositionMargin(this)}},{key:"_submitDeal",value:function(){return this._restService.delete(this)}},{key:"_updatePerMarketSettings",value:function(){}},{key:"toJSON",value:function(){var e=this.position,n=!!e.positions,i=e.market.epic,o=e.dealId,a=t.default.pick(h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"toJSON",this).call(this),["currencyCode","dealReference","decisionMakerAccountId","submittedTimestamp","size","direction","orderType","timeInForce","quoteId","pointsThroughCurrent","dealTicketMargin"]);a.pointsThroughCurrent&&(a.pointsThroughCurrentPrice=a.pointsThroughCurrent,delete a.pointsThroughCurrent);var u={expiry:e.market.isKnockout&&e.period?e.period:e.market.displayPeriod,level:e.latest,currencyCodeISO:e.currencyCodeISO,guaranteed:this._hasGuaranteedStop()};return n?u.epic=i:u.dealId=o,this.knockoutLevel&&(u.knockoutLevel=this.knockoutLevel),s({},a,u)}},{key:"getTierOrdinal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments[2];return(0,a.calculateTierOrdinal)(this.market,r&&r.name||this.currency&&this.currency.name,this.size,e,this.rdwBid,this.rdwOffer,t)}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.indicativeCostsAndChargesService.getIndicativeCloseQuote(this)}},{key:"destroy",value:function(){this.position.off("change",this._onPositionChange,this),h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"roundedOpenLevel",get:function(){return Math.round(this.position.openLevel*Math.pow(10,this.market.decimalPlacesFactor))/Math.pow(10,this.market.decimalPlacesFactor)}},{key:"iccPriceLevel",get:function(){return this.roundedOpenLevel||h(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"iccPriceLevel",this)||this.position&&this.position.latest}},{key:"iccDirection",get:function(){return"sell"===this.direction?"buy":"sell"}},{key:"profitLoss",get:function(){var e=this.position.dealSize;return e&&0!==this.size?this.position.priceInSizeShown?this.size<e?this.position.profitLossTieredPricesPartialClose(this.size):this.position.profitLoss:this.position.profitLoss/e*this.size:0}},{key:"isMarketDealable",get:function(){return this.market.marketStatus===o.default.TRADEABLE||this.market.marketStatus===o.default.CLOSE_ONLY}},{key:"premiumValue",get:function(){return this.position.latest*this.market.lotSize*this.size}},{key:"tierOrdinal",get:function(){return this.getTierOrdinal(this.direction,!1,this.position.currency)}},{key:"maxSize",get:function(){return this.position&&this.position.dealSize||-1}}]),r}(r.default),v(y.prototype,"profitLoss",[c],Object.getOwnPropertyDescriptor(y.prototype,"profitLoss"),y.prototype),v(y.prototype,"isMarketDealable",[l],Object.getOwnPropertyDescriptor(y.prototype,"isMarketDealable"),y.prototype),v(y.prototype,"premiumValue",[p],Object.getOwnPropertyDescriptor(y.prototype,"premiumValue"),y.prototype),v(y.prototype,"tierOrdinal",[f],Object.getOwnPropertyDescriptor(y.prototype,"tierOrdinal"),y.prototype),v(y.prototype,"maxSize",[d],Object.getOwnPropertyDescriptor(y.prototype,"maxSize"),y.prototype),y);e.default=g}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,t){return t.some((function(t){return e.includes(t)}))}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){if(0===e.status)return;if(e.status>0){var t=JSON.stringify({url:e.url,statusText:e.status+" "+e.statusText,status:e.status});throw new Error("Failed request: "+t)}throw e}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(23)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,r,n){var i={},o=t.default.GUARANTEED,a=t.default.NON_GUARANTEED,s=t.default.TRAILING;e.rememberLastTradedSize&&(Object.prototype.hasOwnProperty.call(r,"displayOrderSize")||Object.prototype.hasOwnProperty.call(r,"size"))&&(i.lastTradedSize=r.displayOrderSize||r.size,i.lastTradedCurrency=r.currencyCode);e.rememberLastTradedStopTypeAndDistance&&Object.prototype.hasOwnProperty.call(r,"stopDistance")&&(i.lastTradedStopDistance=r.stopDistance,r.trailingStop?(i.lastTradedStopType=s,i.lastTradedTrailingStopIncrement=r.trailingStopIncrement):r.guaranteedStop?(i.lastTradedStopType=o,i.lastTradedTrailingStopIncrement=null):(i.lastTradedStopType=a,i.lastTradedTrailingStopIncrement=null));e.rememberLastTradedLimitDistance&&Object.prototype.hasOwnProperty.call(r,"limitDistance")&&(i.lastTradedLimitDistance=r.limitDistance);e.rememberLastTradedPointsThroughCurrent&&Object.prototype.hasOwnProperty.call(r,"pointsThroughCurrent")&&(i.lastTradedPointsThroughCurrent=r.pointsThroughCurrent);e.rememberLastTradedOrderTypeAndExpiry&&n&&(i.lastTradedOrderType=n);return i}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(13),r(11),r(3),r(2),r(18),r(52),r(21)],i=function(e,t,r,n,i,o,a,s){"use strict";function u(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var p,f,d,y,h,v,g,_,O,b,m=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function T(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var k=(p=(0,i.default)("direction","referencePosition","sellOrdersQuantity","referencePosition.dealSize"),f=(0,i.default)("direction","triggerLevel","stopPrice","size","bidPrice","offerPrice","orderType"),d=(0,i.default)("consideration","currency","market"),y=(0,i.default)("currentMarketLevel","tolerance"),h=(0,i.default)("priceWithTolerance","decimalPlacesFactor"),v=(0,i.default)("priceWithTolerance","size"),g=(0,i.default)("considerationWithTolerance","currency","market"),_=(0,i.default)("size","triggerLevel","orderType","referencePosition","referencePosition.profitLoss","referencePosition.dealSize","referencePosition.latest"),O=(0,i.default)("profitLoss","currency"),b=function(e){function t(e,r,n,i,o,s,u){var l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var p=arguments.length,f=Array(p>7?p-7:0),d=7;d<p;d++)f[d-7]=arguments[d];var y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l=t.__proto__||Object.getPrototypeOf(t)).call.apply(l,[this,{},e,r,n,i,o,s,u].concat(f)));return c(y,{orderType:"LIMIT",timeInForce:"GOOD_FOR_DAY",tolerance:a.default.E0_20,dealSizeDecimalPlaces:0,sellOrdersQuantity:null,triggerLevel:null,stopPrice:null,referencePosition:u,isExchangeTraded:!0}),!r.defaultDealSize||r.lastTradedSize&&i.rememberLastTradedSize||y.set("size",r.defaultDealSize),y._updateReferencePositionListeners(),y._validate(),y}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),l(t,[{key:"_onChange",value:function(e){m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onChange",this).call(this,e),e.includes("referencePosition")&&this._updateReferencePositionListeners(),e.includes("orderType")&&this._updateIndicativeCostsAndCharges()}},{key:"_onMarketChange",value:function(e){m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onMarketChange",this).call(this,e),(e.includes("displayBid")||e.includes("displayOffer"))&&this._validate()}},{key:"_updateReferencePositionListeners",value:function(){this._removeReferencePositionListener(),this.referencePosition&&(this.referencePosition.on("change",this._onReferencePositionChange,this),this._oldReferencePosition=this.referencePosition)}},{key:"_removeReferencePositionListener",value:function(){var e=this._oldReferencePosition;e&&e.off("change",this._onReferencePositionChange,this),this._oldReferencePosition=null}},{key:"_onReferencePositionChange",value:function(e){var t=this,r=[];["dealSize","latest","profitLoss"].forEach((function(n){e.includes(n)&&r.push.apply(r,u(t.batchChangesForKeys(["referencePosition."+n])))})),r.length&&this.trigger("change",r)}},{key:"destroy",value:function(){this._removeReferencePositionListener(),m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"_getMargin",value:function(){return null}},{key:"_getValidators",value:function(){return[n.direction,n.marketDealable,n.sizeAboveZero,n.sizeBelowMax,n.controlledRiskTradingAvailable,n.hasLiveData,n.stopPriceAboveZeroForStopOrder,n.stopPriceNotInRangeOfBidOfferPrice,n.triggerLevelAboveZeroForLimitOrder,n.technicalIssues,n.noBuyingStopMarketOrders]}},{key:"_convertConsiderationToAccountCurrency",value:function(e){var t=1/this.currency.baseExchangeRate,r=this.market.dealingRules.currencyOffset;if(e&&t&&r){var n=t*r*.01;return e*(this.isSell?t-n:t+n)}return null}},{key:"addConsiderationWithoutTolerance",value:function(e){var t=JSON.parse(JSON.stringify(e));return t.minMaxConsiderationTradeCurrency=t.totalConsiderationTradeCurrency,t.minMaxConsiderationUsersBaseCurrency=t.totalConsiderationUsersBaseCurrency,t.totalConsiderationTradeCurrency={amount:this.consideration,currencyCode:e.totalConsiderationTradeCurrency.currencyCode},t.totalConsiderationUsersBaseCurrency={amount:this.considerationInAccountCurrency,currencyCode:e.totalConsiderationUsersBaseCurrency.currencyCode},t}},{key:"getEstimatedCharges",value:function(){var e=this._restService.getEstimatedCharges(this);return"MARKET"===this.orderType?e.then(this.addConsiderationWithoutTolerance.bind(this)):e}},{key:"toString",value:function(){return r.default.POSITION}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.showClosing?this.indicativeCostsAndChargesService.getIndicativeCloseQuote(this,!0):this.indicativeCostsAndChargesService.getIndicativeOpenQuote(this)}},{key:"_validationDependentKeys",get:function(){return[].concat(u(m(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_validationDependentKeys",this)),["orderType","timeInForce","triggerLevel","stopPrice","sellOrdersQuantity","market.displayOffer","market.displayBid"])}},{key:"roundedOpenLevel",get:function(){return Math.round(this.referencePosition.openLevel*Math.pow(10,this.market.decimalPlacesFactor))/Math.pow(10,this.market.decimalPlacesFactor)}},{key:"iccOpeningLevel",get:function(){return this.showClosing&&this.referencePosition?this.roundedOpenLevel:this.iccPriceLevel}},{key:"iccPriceLevel",get:function(){return"MARKET"===this.orderType?this.currentMarketLevel:"STOP_MARKET"===this.orderType?this.stopPrice:"STOP_LIMIT"!==this.orderType||this.stopPrice?this.triggerLevel:null}},{key:"iccStopLevel",get:function(){return null}},{key:"iccLimitLevel",get:function(){return null}},{key:"iccDirection",get:function(){return this.showClosing?"buy":this.direction}},{key:"maxSize",get:function(){var e=this.referencePosition&&this.referencePosition.dealSize,t=this.sellOrdersQuantity||0,r=Math.max(e-t,0);return this.isSell?r:null}},{key:"consideration",get:function(){var e=this.isSell?this.bidPrice:this.offerPrice;return("MARKET"===this.orderType?e*this.size:"STOP_MARKET"===this.orderType?this.stopPrice*this.size:this.triggerLevel*this.size)||null}},{key:"considerationInAccountCurrency",get:function(){return this._convertConsiderationToAccountCurrency(this.consideration)}},{key:"priceWithTolerance",get:function(){return this.isBuy?(0,s.round)(this.currentMarketLevel+this.tolerance,10):(0,s.round)(Math.max(this.currentMarketLevel-this.tolerance,.01),10)}},{key:"displayPriceWithTolerance",get:function(){return this.priceWithTolerance.toFixed(this.decimalPlacesFactor)}},{key:"considerationWithTolerance",get:function(){return this.size?this.priceWithTolerance*this.size:null}},{key:"considerationWithToleranceInAccountCurrency",get:function(){return this._convertConsiderationToAccountCurrency(this.considerationWithTolerance)}},{key:"profitLoss",get:function(){var e=this.referencePosition&&this.referencePosition.dealSize,t=this.size;if(!e||!t||"STOP_MARKET"===this.orderType&&!this.stopPrice||this.orderType.includes("LIMIT")&&!this.triggerLevel)return null;var r=void 0;if("MARKET"===this.orderType)r=this.referencePosition.profitLoss;else if(this.orderType.includes("LIMIT")||"STOP_MARKET"===this.orderType){var n=this.orderType.includes("LIMIT")?this.triggerLevel:this.stopPrice;r=(0,o.calculateProfitAndLoss)(n,this.referencePosition.openLevel,this.referencePosition.contractSize,this.referencePosition.dealSize,this.referencePosition.isShort(),this.referencePosition.isPriceTypeBackOnly())}return r/e*t}},{key:"profitLossInAccountCurrency",get:function(){return this.profitLoss&&this.currency.baseExchangeRate?this.profitLoss/this.currency.baseExchangeRate:null}}]),t}(t.default),T(b.prototype,"maxSize",[p],Object.getOwnPropertyDescriptor(b.prototype,"maxSize"),b.prototype),T(b.prototype,"consideration",[f],Object.getOwnPropertyDescriptor(b.prototype,"consideration"),b.prototype),T(b.prototype,"considerationInAccountCurrency",[d],Object.getOwnPropertyDescriptor(b.prototype,"considerationInAccountCurrency"),b.prototype),T(b.prototype,"priceWithTolerance",[y],Object.getOwnPropertyDescriptor(b.prototype,"priceWithTolerance"),b.prototype),T(b.prototype,"displayPriceWithTolerance",[h],Object.getOwnPropertyDescriptor(b.prototype,"displayPriceWithTolerance"),b.prototype),T(b.prototype,"considerationWithTolerance",[v],Object.getOwnPropertyDescriptor(b.prototype,"considerationWithTolerance"),b.prototype),T(b.prototype,"considerationWithToleranceInAccountCurrency",[g],Object.getOwnPropertyDescriptor(b.prototype,"considerationWithToleranceInAccountCurrency"),b.prototype),T(b.prototype,"profitLoss",[_],Object.getOwnPropertyDescriptor(b.prototype,"profitLoss"),b.prototype),T(b.prototype,"profitLossInAccountCurrency",[O],Object.getOwnPropertyDescriptor(b.prototype,"profitLossInAccountCurrency"),b.prototype),b);e.default=k}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(10),r(13),r(11)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var a=function(e){function r(e,t,n,i,o,a,s){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);for(var c=arguments.length,l=Array(c>7?c-7:0),p=7;p<c;p++)l[p-7]=arguments[p];var f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u=r.__proto__||Object.getPrototypeOf(r)).call.apply(u,[this,e,t,n,i,o,a,s].concat(l)));return f.isOrder=!0,f}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),i(r,[{key:"_onChange",value:function(e){o(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_onChange",this).call(this,e),e.includes("triggerLevel")&&this._updateMargin()}},{key:"toString",value:function(){return n.default.ORDER}},{key:"stopTypes",get:function(){var e=this.market.controlledRisk,r=this.market.guaranteedStopsAllowed,n=this.market.trailingStopsAllowedPreference,i=this.market.isLimitedRisk;return t.default.getStopTypes(e,r,n,i).filter((function(e){return e.value!==t.default.Type.TRAILING}))}}]),r}(r.default);e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r="0123456789ABCDEFGHJKMNPQRSTVWXYZ",n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._accountId=t,this._generatedCount=1}return t(e,[{key:"generateDealReference",value:function(e){return""+this._toAlphaNumeric(this._convertAccountIdToNumber(this._accountId))+this._toAlphaNumeric(e||Date.now())+this._toAlphaNumeric(this._generatedCount++).substr(0,2)}},{key:"_convertAccountIdToNumber",value:function(e){return parseInt(e.toUpperCase().replace(/[A-Z]/g,(function(e){var t=e.charCodeAt(0)-64;return(t<10?"0":"")+t})),10)}},{key:"_toAlphaNumeric",value:function(e){for(var t=[],n=15,i=e,o=void 0;--n>=0;)o=31&i,t[n]=r[o],i=Math.floor(i/32);return this._removePadding(t.join(""))}},{key:"_removePadding",value:function(e){return e.replace(/^0+/,"")}}]),e}();e.default=n}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,t){if(!t||!t.user||!e)return!1;var r=t.user,n=t.featureFlags,i=r.igCompany,o=r.assetClass,a="igjp"===i&&("FOREX"===o||n.forceJapaneseTicket||n.showNewJapaneseTicket&&["COMMODITIES","INDICES","BONDS","FOREX"].includes(o)),s=e.isKnockout,u=e.isOption,c=e.isBinary,l=e.isKnockoutV2,p=!(s||u||c||l);return Boolean(a&&p)}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(6)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{timestamp:void 0,offset:void 0}));return r._lsService=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"getTime",value:function(){return Date.now()+("number"==typeof this.offset?this.offset:0)}},{key:"prepare",value:function(){var e=this;return this._subscription||(this._subscription=this._lsService.subscribe("V2-M-HEARTBEAT|HB.U.HEARTBEAT.IP",["MSG_UPDATE"],"MERGE",this._handleUpdate.bind(this))),"number"==typeof this.timestamp?Promise.resolve(this):new Promise((function(t,r){e.once("change",(function(){return t(e)}),e),e.once("destroyed",(function(){return r(new Error("Heartbeat model destroyed before heartbeat started streaming"))}),e)}))}},{key:"_handleUpdate",value:function(e){var r=t.convertToJSTimestamp(e.getValue("MSG_UPDATE"));if("number"==typeof r){var n=r-Date.now();this.setProperties({timestamp:r,offset:n})}}},{key:"destroy",value:function(){this._subscription&&(this._subscription.unsubscribe(),delete this._subscription),delete this.timestamp,delete this.offset,n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}],[{key:"convertToJSTimestamp",value:function(e){var t=void 0;if("string"==typeof e){if(e.includes(".")){var r=e.match(/^(\d+)/);if(!r)return null;e=r[1]}if(10===e.length)t=parseInt(e+"000",10);else{if(13!==e.length)return null;t=parseInt(e,10)}}else if("number"==typeof e)if(e>=1e9&&e<1e10)t=1e3*e;else{if(!(e>=1e12&&e<1e13))return null;t=e}return Number.isNaN(t)||Math.abs(Date.now()-t)>31536e6?null:t}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={E0_20:.2,E0_50:.5,E1_00:1}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(12),r(1),r(26),r(129),r(5),r(7),r(59),r(0)],i=function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c,l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f="/signals-gateway/alerts/",d=(p(c={},n.default.Type.PRICE_LEVEL_ALERT,f+"price/"),p(c,n.default.Type.PRICE_CHANGE_ALERT,f+"price/change/"),c),y=function(e){function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.default.Type.PRICE_LEVEL_ALERT;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments));return r._session=e,r._alertType=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,e),l(a,[{key:"getAll",value:function(){var e=this;return r.get(this.getUrl(),this._session).then((function(e){return a.enrichMarkets(e)})).then((function(t){var r=t.priceAlerts,n=t.markets;return r.filter((function(e){return n[e.epic]})).map((function(t){return a.createAlertObjectFromMarkets(t,n,e._alertType)}))}))}},{key:"delete",value:function(e){var n=this;return r.del(""+this.getUrl()+e,this._session).then((function(){return n.trigger(t.default.REMOVED,e),{id:e}}))}},{key:"create",value:function(e){var n=this,i=this._alertType;return r.post(this.getUrl(),this._session,a.createPostData(e,i)).then((function(e){var r=o.default.populateWithV2MarketData(e.market),s=a.createAlertObject(e.priceAlert,r,i);return n.trigger(t.default.ADDED,s),s}))}},{key:"update",value:function(e){var n=this,i=u.default.omit(e,["id"]);return r.put(""+this.getUrl()+e.id,this._session,i).then((function(r){return n.trigger(t.default.UPDATED,e),r}))}},{key:"getUrl",value:function(){return d[this._alertType]}}],[{key:"createPostData",value:function(e,t){return t!==n.default.Type.PRICE_LEVEL_ALERT?e:{message:e.message,level:e.level,marketAttribute:e.priceType,epic:e.epic,notifications:[]}}},{key:"createAlertObjectFromMarkets",value:function(e,t,r){var n=t[e.epic];return a.createAlertObject(e,n,r)}},{key:"createAlertObject",value:function(e,t,r){return r&&r!==n.default.Type.PRICE_LEVEL_ALERT?a.createPriceChangeDealingRestAlert(e,t):a.createPriceLevelDealingRestAlert(e,t)}},{key:"enrichMarkets",value:function(e){var t=e.priceAlerts,r=e.markets;return{priceAlerts:t,markets:Object.keys(r).reduce((function(e,t){return e[t]=o.default.populateWithV2MarketData(r[t]),e}),{})}}},{key:"getStreamingClient",value:function(e){return new s.default(e)}},{key:"createPriceLevelDealingRestAlert",value:function(e,t){return i.default.fromDealingRestAlert({id:e.id,message:e.message,status:e.status,timestamp:e.timestamp,epic:e.epic,condition:e.condition,marketAttribute:e.marketAttribute,level:e.level,market:t})}},{key:"createPriceChangeDealingRestAlert",value:function(e,t){return i.default.fromDealingRestAlert({id:e.id,message:e.message,epic:e.epic,priceChange:e.priceChange,timePeriod:e.timePeriod,changeType:e.changeType,creationTime:e.creationTime,triggeredTime:e.triggeredTime,market:t})}}]),a}(a.default);e.default=y}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(1)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t}return r(e,[{key:"getPositionMargin",value:function(e){return t.post("/"+this._session.environment.path+"/v3/margin/positions/otc",this._session,e)}},{key:"getClosePositionMargin",value:function(e){var r="/"+this._session.environment.path+"/v3/margin/positions/",n=e.isDMA?r+"dma":r+"otc";return"function"==typeof e.toMarginJSON&&(e=e.toMarginJSON()),t.del(n,this._session,e)}},{key:"getEditOrderMargin",value:function(e){return t.put("/"+this._session.environment.path+"/v3/margin/workingorders/otc/"+e.order.dealId,this._session,e)}},{key:"getEditAggregatePositionMargin",value:function(e){return t.put("/"+this._session.environment.path+"/v3/margin/positions/otc/aggr",this._session,e)}},{key:"getEditPositionMargin",value:function(e){return t.put("/"+this._session.environment.path+"/v3/margin/positions/otc/"+e.position.dealId,this._session,e)}},{key:"getOrderMargin",value:function(e){var r="/"+this._session.environment.path+"/v3/margin/workingorders/",n=e.isDMA?r+"dma":r+"otc";return"function"==typeof e.toMarginJSON&&(e=e.toMarginJSON()),t.post(n,this._session,e)}}]),e}();e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(5),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t}return n(e,[{key:"findByEpic",value:function(e){var n=this._session,i=n.featureFlags.usePriceSubscription,o=new URLSearchParams("epic="+e);i&&o.set("priceInSizeFlag","true");var a="/"+n.environment.path+"/v3/markets/details?"+o.toString();return r.get(a,n,!1,{"IG-ACCOUNT-ID":n.user.accountId}).then((function(e){return t.default.populateWithV3MarketData(e,i)}))}},{key:"findByEpics",value:function(e){var t=this;return Promise.all(e.map((function(e){return t.findByEpic(e)})))}},{key:"getMarketInfo",value:function(e){var t=this._session,n="/"+t.environment.path+"/markets/summary/"+e;return r.get(n,t)}},{key:"getByWatchlist",value:function(e){var n=this._session,i=n.featureFlags.usePriceSubscription,o=i?"?priceInSizeFlag=true":"",a="/"+n.environment.path+"/wtp/markets/watchlists/"+e+o;return r.get(a,n,!1,{"IG-ACCOUNT-ID":this._session.user.accountId}).then((function(e){return e.map((function(e){return e.dynamicHierarchyEpic=e.instrumentData.dynamicHierarchyEpic,e}))})).then((function(e){return e.map((function(e){return t.default.populateWithV2MarketData(e,i)}))}))}},{key:"getDealingRules",value:function(e){var t="/"+this._session.environment.path+"/wtp/markets/dealingrules/"+e;return r.get(t,this._session)}}]),e}();e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(20),r(5),r(146),r(145),r(147),r(62),r(1),r(0)],i=function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._confirmationStreamingClient=r,this._dealReferenceGenerator=n}return c(e,[{key:"getAll",value:function(){var r=this._session,n=r.featureFlags.usePriceSubscription,i=n?"?priceInSizeFlag=true":"",o="/"+r.environment.path+"/wtp/orders/positions"+i;return s.get(o,r).then((function(i){var o=e.parseMarkets(i,n);return{positions:i.map((function(e){return e.marketDetails||e.market?(e.marketDetails=e.marketDetails||e.market,t.default.fromDealingRestPosition(e,r)):null})).filter(u.default.identity),markets:o}}))}},{key:"create",value:function(e){return new n.default(e,this._session,this._confirmationStreamingClient)}},{key:"delete",value:function(e){return new i.default(e,this._session,this._confirmationStreamingClient)}},{key:"edit",value:function(e){return new o.default(e,this._session,this._confirmationStreamingClient)}},{key:"destroy",value:function(){this._session=null,this._dealReferenceGenerator=null}}],[{key:"getStreamingClient",value:function(e,t){return new a.default(e,t)}},{key:"parseMarkets",value:function(e,t){var n=u.default.uniqBy(e,"openPosition.openPositionData.epic").map((function(e){return r.default.populateFromPositionResponse(e,t)})).filter(Boolean);return u.default.keyBy(n,"epic")}}]),e}();e.default=l}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(35)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._userPreferencesService=r,this._settings=null}return r(e,[{key:"_getSettings",value:function(e){return this._settings||(this._settings=new t.default(e)),this._settings}},{key:"getSettings",value:function(){var e=this;return this._userPreferencesService?this._userPreferencesService.getPreferences().then((function(t){return e._getSettings(t)})):Promise.resolve(this._getSettings())}},{key:"saveSettings",value:function(e){return this._userPreferencesService.setPreferences(e.snapshot())}},{key:"destroy",value:function(){this._settings.destroy(),this._settings=null}}]),e}();e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(7),r(157),r(12),r(71),r(153)],i=function(e,t,r,n,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var u=function(e){function t(e,r,i,a,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return u._store=new o.default(e,r,i,a),u._store.on(n.default.ADDED,(function(e){return u.trigger(n.default.ADDED,e)}),u),u._store.on(n.default.REMOVED,(function(e){return u.trigger(n.default.REMOVED,e)}),u),u._lsService=s,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"getTrades",value:function(){var e=this;return this._reconnectionMonitor||(this._reconnectionMonitor=new r.default(this._lsService),this._reconnectionMonitor.on(i.default.RECONNECTED,this.update,this)),this._tradesPromise&&!this._pendingUpdate?Promise.resolve(this._store.getCurrentTrades()):(this._tradesPromise&&this._pendingUpdate||(this._pendingUpdate=!0,this._tradesPromise=this._store.updateTrades().catch((function(t){throw delete e._tradesPromise,t})).finally((function(){e._pendingUpdate=!1}))),this._tradesPromise)}},{key:"update",value:function(){delete this._tradesPromise,delete this._pendingUpdate,this.getTrades()}},{key:"destroy",value:function(){this._tradesPromise&&(delete this._tradesPromise,delete this._pendingUpdate),this._reconnectionMonitor&&(this._reconnectionMonitor.destroy(),delete this._reconnectionMonitor),this._store&&(this._store.destroy(),delete this._store),delete this._lsService,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(t.default);e.default=u}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(12),r(33),r(7)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var s=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._lightstreamerService=e,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),o(n,[{key:"startListening",value:function(e){return this._subscription=new r.default("V2-M-MESSAGE_EVENT_HANDLER|{identifier}-ACTION","ALU",this._lightstreamerService,!1).startListening(e),this._subscription.on(r.default.Events.UPDATED,this._handleStreamingUpdate.bind(this)),this}},{key:"_handleStreamingUpdate",value:function(e){var r=e.split("|").reduce((function(e,t){var r=t.split("="),n=i(r,2),o=n[0],a=n[1];return e[o]=a,e}),{});this.trigger(t.default.UPDATED,r)}},{key:"stopListening",value:function(){this._subscription&&(this._subscription.destroy(),this._subscription=null),this.off()}},{key:"destroy",value:function(){this.stopListening(),a(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this),this._lightstreamerService=null}}]),n}(n.default);e.default=s}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(27),r(41)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=Object.keys(t.ORDER_FID_SCHEMA),o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"getFids",value:function(){return i}}]),t}(r.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(12),r(33),r(7),r(27)],i=function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var s=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._lightstreamerService=e,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),o(n,[{key:"startListening",value:function(e){return this._subscription=new r.default("V2-M-MESSAGE_EVENT_HANDLER|{identifier}-WO-JSON","WOU",this._lightstreamerService).startListening(e),this._subscription.on(r.default.Events.UPDATED,this._handleStreamingUpdate.bind(this)),this}},{key:"_handleStreamingUpdate",value:function(e){var r=e.header.contentType,n=e.body;if(r.match(/Add$/)){var o=i.default.fromWOU(n.workingOrder);this.trigger(t.default.ADDED,o)}else r.match(/Delete$/)&&this.trigger(t.default.REMOVED,n.workingOrder.dealId)}},{key:"stopListening",value:function(){this._subscription&&(this._subscription.destroy(),this._subscription=null),this.off()}},{key:"destroy",value:function(){this.stopListening(),a(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this),this._lightstreamerService=null}}]),n}(n.default);e.default=s}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(12),r(33),r(7),r(20)],i=function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var s=function(e){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._lightstreamerService=e,r._session=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),o(n,[{key:"startListening",value:function(e){return this._subscription=new r.default("V2-M-MESSAGE_EVENT_HANDLER|{identifier}-OP-JSON","OPU",this._lightstreamerService).startListening(e),this._subscription.on(r.default.Events.UPDATED,this._handleStreamingUpdate.bind(this)),this}},{key:"_handleStreamingUpdate",value:function(e){var r=e.header.contentType,n=e.body;if(r.match(/Add$/)){var o=n.openPosition.epic;if(i.default.isValidEpic(o)){var a=i.default.fromOPU(n,this._session);this.trigger(t.default.ADDED,a)}}else r.match(/Delete$/)&&this.trigger(t.default.REMOVED,n.openPosition.dealId)}},{key:"stopListening",value:function(){this._subscription&&(this._subscription.destroy(),this._subscription=null),this.off()}},{key:"destroy",value:function(){this.stopListening(),a(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this),this._lightstreamerService=null}}]),n}(n.default);e.default=s}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(132),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=Object.freeze({EPIC:"E",IG_INSTRUMENT_ID:"G",ISIN:"I",L2_INSTRUMENT_ID:"L",UV_MARKET_COMMODITY:"M",RIC:"R"}),a=function(){function e(t,i,o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._streamingClient=i,this._heartbeat=o,this._rdws=new Map,this._objectsToUpdate=new Set,this._objectChangeCallbacks=new Map,this._objectDestroyCallbacks=new Map,this._boundRDWUpdateCallback=function(e){return a._setRDWValues.apply(a,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e))};var s=this._heartbeat.prepare();Promise.all([r.get("/dealing-gateway/repeat-deal-window/"+t.user.accountId,t),s]).then((function(e){var t=n(e,1)[0];a._rdws&&t.repeatDealingEntryList&&a._processRDWRESTPayload(t.repeatDealingEntryList)})),s.then((function(){a._streamingClient&&a._streamingClient.on("rdw",a._boundRDWUpdateCallback,a)}))}return i(e,[{key:"add",value:function(e){var t=this;if(!this._objectsToUpdate.has(e)){var r=function(r){(r.includes("market")||r.includes("currency"))&&t._setRDWOnObject(e)},n=function(){return t.remove(e)};e.on("change",r,this),e.once("destroyed",n,this),this._objectsToUpdate.add(e),this._objectChangeCallbacks.set(e,r),this._objectDestroyCallbacks.set(e,n),this._setRDWOnObject(e)}}},{key:"remove",value:function(e){return!!this._objectsToUpdate.has(e)&&(e.off("change",this._objectChangeCallbacks.get(e),this),e.off("destroyed",this._objectDestroyCallbacks.get(e),this),this._objectsToUpdate.delete(e),this._objectChangeCallbacks.delete(e),this._objectDestroyCallbacks.delete(e),(e.rdwOffer||e.rdwBid)&&e.setProperties({rdwOffer:e.rdwOffer&&e.rdwOffer.snapshot()||null,rdwBid:e.rdwBid&&e.rdwBid.snapshot()||null}),!0)}},{key:"removeAll",value:function(){this._objectsToUpdate.forEach(this.remove,this)}},{key:"getRDW",value:function(e,r,n){var i=e+"|"+r+"|"+n;if(this._rdws.has(i))return this._rdws.get(i);var o=new t.default(this._heartbeat,[],e,r,n);return this._rdws.set(i,o),o}},{key:"_setRDWOnObject",value:function(e){var t=e.market&&e.market.epic,r=e.currency&&e.currency.name;t&&r?e.setProperties({rdwOffer:this.getRDW(t,r,"buy"),rdwBid:this.getRDW(t,r,"sell")}):(e.rdwOffer||e.rdwBid)&&e.setProperties({rdwOffer:null,rdwBid:null})}},{key:"_setRDWValues",value:function(e,t,r,n){this.getRDW(e,t,r).setRDW(n)}},{key:"_processRDWRESTPayload",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,u=s.instrumentSource,c=s.instrumentValue,l=s.currencyList;if(u===o.EPIC&&l){var p=!0,f=!1,d=void 0;try{for(var y,h=l[Symbol.iterator]();!(p=(y=h.next()).done);p=!0){var v=y.value,g=v.currency,_=v.buy,O=v.sell;this._setRDWValues(c,g,"buy",_),this._setRDWValues(c,g,"sell",O)}}catch(b){f=!0,d=b}finally{try{!p&&h.return&&h.return()}finally{if(f)throw d}}}}}catch(b){r=!0,n=b}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}}},{key:"destroy",value:function(){this._streamingClient&&(this._streamingClient.off("rdw",this._boundRDWUpdateCallback,this),delete this._streamingClient),this._objectsToUpdate&&(this.removeAll(),delete this._objectsToUpdate,delete this._objectChangeCallbacks,delete this._objectDestroyCallbacks),this._rdws&&(this._rdws.forEach((function(e){return e.destroy()})),this._rdws.clear(),delete this._rdws)}}]),e}();e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(5),r(15)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.BINARY_FIDS=e.KO_V2_FIDS=e.KO_FIDS=e.FIDS=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var o=e.FIDS=Object.keys(t.MARKET_V4_FID_SCHEMA).filter((function(e){return"MARKET_NAME"!==e})),a=e.KO_FIDS=Object.keys(t.KO_FID_SCHEMA),s=e.KO_V2_FIDS=Object.keys(t.KO_V2_FID_SCHEMA),u=e.BINARY_FIDS=Object.keys(t.MARKET_V4_FID_SCHEMA),c=Object.freeze(["MARKET_NAME","KO_UND_BID","KO_UND_ASK","DELTA","SWAP_1_SHORT","SWAP_1_LONG","SWAP_2_SHORT","SWAP_2_LONG","SWAP_3_SHORT","SWAP_3_LONG","SWAP_4_SHORT","SWAP_4_LONG","SWAP_5_SHORT","SWAP_5_LONG","SWAP_6_SHORT","SWAP_6_LONG","SWAP_7_SHORT","SWAP_7_LONG","SWAP_8_SHORT","SWAP_8_LONG"]),l=function(e){function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,"MARKET_V4:"+n.user.accountId+":{id}{modifiers}","MERGE",t,!0));return i._session=n,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),n(r,[{key:"add",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],l=arguments[2];if(!e.isUnpriced){var p=e.isBinary?u:o,f=e.isKnockoutV2?[]:t.default.getFidsForSwapRate(l,["LONG","SHORT"]),d=e.isKnockout?a:[],y=e.isKnockoutV2?s:[],h=p.concat(f,d,y),v=this._session.user.isMTF?h.filter((function(e){return"MID"!==e})):h;this._session.featureFlags.usePriceSubscription&&(v=v.filter((function(e){return c.includes(e)}))),i(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"add",this).call(this,e.epic,v,e.boundOnStreamedV4Update,n)}}},{key:"remove",value:function(e){if(!e.isUnpriced)return i(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"remove",this).call(this,e.boundOnStreamedV4Update)}}]),r}(r.default);e.default=l}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={CONSTANT_LEVERAGE_INDICES:"CONSTANT_LEVERAGE_INDICES",CONSTANT_LEVERAGE_COMMODITIES:"CONSTANT_LEVERAGE_COMMODITIES",CONSTANT_LEVERAGE_CURRENCIES:"CONSTANT_LEVERAGE_CURRENCIES",CONSTANT_LEVERAGE_SHARES:"CONSTANT_LEVERAGE_SHARES"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(48),r(3)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var o=function(e){function t(e,r){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,{},e,r.market].concat(o)));return s.setProperties({order:r,dealId:r.dealId,isDMA:r.isDMA}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_getValidators",value:function(){return[r.marketDealable]}},{key:"_submitDeal",value:function(){return this._restService.delete(this)}},{key:"toJSON",value:function(){var e={timeStamp:this.heartbeat.timestamp,dealReference:this.dealReference},t=this._session.user.broker;return t&&t.decisionMakerAccountId&&(e.decisionMakerAccountId=t.decisionMakerAccountId),e}},{key:"isMarketDealable",get:function(){var e=this.order;return e&&e.canClose()}},{key:"_validationDependentKeys",get:function(){return[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_validationDependentKeys",this)),["order"])}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0),r(16),r(10),r(3),r(2)],i=function(e,t,r,n,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var s,u,c=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var l,p,f,d,y,h,v=(s=(0,o.default)("order","order.stopType"),u=function(e){function r(e,t){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);for(var o=arguments.length,a=Array(o>2?o-2:0),s=2;s<o;s++)a[s-2]=arguments[s];var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i=r.__proto__||Object.getPrototypeOf(r)).call.apply(i,[this,e,t.market].concat(a)));return u.setProperties({expiryTime:t.goodTillUTCMillis,isEditTicket:!0,order:t,direction:"+"===t.direction?"buy":"sell",limitLevel:t.limitLevel,limitType:t.limitType,size:t.dealSize,triggerLevel:t.openLevel,stopStep:t.stopStep,stopTrailingDistance:t.stopTrailingDistance,stopLevel:t.stopLevel,stopLevelType:t.stopLevelType,stopType:t.stopType}),u.set("stopType",t.stopType||n.default.getFirstValidStopType(u.stopTypes)),u.order.on("change",u._onOrderChange,u),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),a(r,[{key:"_onOrderChange",value:function(e){var t=this.batchChangesForKeys(e,"order");t.length&&this.trigger("change",t),e.includes("goodTillUTCMillis")&&this.set("expiryTime",this.order.goodTillUTCMillis),e.includes("limitLevel")&&this.set("limitLevel",this.order.limitLevel),e.includes("stopLevel")&&this.set("stopLevel",this.order.stopLevel)}},{key:"_getMargin",value:function(){return this.marginService.getEditOrderMargin(this)}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.settings.forceExAnteOpenEndpointForEdits?this.indicativeCostsAndChargesService.getIndicativeOpenQuote(this):this.indicativeCostsAndChargesService.getIndicativeEditQuote(this)}},{key:"_getValidators",value:function(){return[i.dateBelowMin,i.direction,i.limit,i.marketDealable,i.triggerLevelWithinValidDistance,i.triggerLevelValidForOrderType,i.orderTypeLimitForOption,i.triggerLevelAboveZero,i.stop,i.stopSizeChangeAllowed,i.controlledRiskUser,i.hasLiveData]}},{key:"_submitDeal",value:function(){return this._restService.edit(this)}},{key:"toJSON",value:function(){return t.default.pick(c(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"toJSON",this).call(this),["dealReference","decisionMakerAccountId","goodTillDate","guaranteedStop","level","limitDistance","stopDistance","submittedTimestamp","timeInForce","trailingStop","trailingStopIncrement","type","quoteId"])}},{key:"destroy",value:function(){this.order.off("change",this._onOrderChange,this),c(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"stopTypes",get:function(){return n.default.getStopTypes(this.market.controlledRisk,this.market.guaranteedStopsAllowed,this.market.trailingStopsAllowedPreference,this.market.isLimitedRisk).filter((function(e){return!0===e.valid&&e.value!==n.default.Type.TRAILING}))}},{key:"openLevel",get:function(){return this.order.openLevel}},{key:"isMarketDealable",get:function(){var e=this.order;return e&&e.canEdit()}}]),r}(r.default),l=u.prototype,p="stopTypes",f=[s],d=Object.getOwnPropertyDescriptor(u.prototype,"stopTypes"),y=u.prototype,h={},Object.keys(d).forEach((function(e){h[e]=d[e]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=f.slice().reverse().reduce((function(e,t){return t(l,p,e)||e}),h),y&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(y):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(l,p,h),h=null),u);e.default=v}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0),r(82),r(10),r(3),r(32),r(2),r(23)],i=function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var c,l,p,f=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function d(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var y=(c=(0,a.default)("position","position.stopType","session"),l=(0,a.default)("position","position.latest"),p=function(e){function r(e,t,i,o,a,s){var u,c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);for(var l=arguments.length,p=Array(l>7?l-7:0),f=7;f<l;f++)p[f-7]=arguments[f];var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u=r.__proto__||Object.getPrototypeOf(r)).call.apply(u,[this,{isEditTicket:!0,currency:t.currency,direction:"+"===t.direction?"buy":"sell",size:t.dealSize,limitLevel:t.limitLevel,limitType:t.limitType,position:t,stopStep:t.stopStep,stopLevel:t.stopLevel,stopLevelType:t.stopLevelType,stopTrailingDistance:t.stopTrailingDistance,canEditTrailingDistance:!0,allowGuaranteedStopRemoval:c},e,t.market,i,o,a,s].concat(p)));return d.market&&d.market.isKnockout&&!d.knockoutLevel&&(d.knockoutLevel=t.knockoutLevel),d.set("isUS",s.user&&s.user.isUSFx||!1),d.set("stopType",t.stopType||n.default.getFirstValidStopType(d.stopTypes)),d.position.on("change",d._onPositionChange,d),d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),u(r,[{key:"_onPositionChange",value:function(e){var t=this.batchChangesForKeys(e,"position");t.length&&this.trigger("change",t),e.includes("stopLevel")&&this.set("stopLevel",this.position.stopLevel),e.includes("limitLevel")&&this.set("limitLevel",this.position.limitLevel),e.includes("stopType")&&this.set("stopType",this.position.stopType||this.defaultStopType)}},{key:"_getMargin",value:function(){return this.position.positions?this.marginService.getEditAggregatePositionMargin(this):this.marginService.getEditPositionMargin(this)}},{key:"_getValidators",value:function(){var e=[i.direction,i.marketDealable,i.stop,i.stopSizeChangeAllowed,i.limit,i.controlledRiskUser,i.hasLiveData];return this.allowGuaranteedStopRemoval||e.push(i.guaranteedStopIsEmptyValidator),e}},{key:"_submitDeal",value:function(){return this._restService.edit(this)}},{key:"toJSON",value:function(){var e=this._session.user.broker,t=this.position.positions?this._toAggregatePositionJson():this._toSinglePositionJson();return e&&e.decisionMakerAccountId&&(t.decisionMakerAccountId=e.decisionMakerAccountId),t}},{key:"_toSinglePositionJson",value:function(){var e=this.position,r=this.stopLevel,i=this.stopTrailingDistance,o=this.stopStep,a=!!(r&&i&&o),s={limitLevel:this.limitLevel,stopLevel:r,trailingStop:a&&this.stopType===n.default.Type.TRAILING,trailingStopDistance:i,trailingStopIncrement:o};return t.default.assign({dealReference:this.dealReference,guaranteedStop:this._hasGuaranteedStop(),limitLevel:e.limitLevel,stopLevel:e.stopLevel,trailingStop:this._hasTrailingStop(),trailingStopDistance:e.stopTrailingDistance,trailingStopIncrement:e.stopStep,submittedTimestamp:this._getSubmittedTimestamp(),quoteId:this.quoteId},s)}},{key:"_toAggregatePositionJson",value:function(){var e=this.position,t=this.stopLevel,r=this.stopType,n=this.stopTrailingDistance,i=this.stopStep,o=this.limitLevel||"",a=!(!e.limitLevel||o),u=!(!e.stopLevel||t);return{dealReference:this.dealReference,token2:"",tokenVO:"",dealLevelBid:""+e.market.bid,dealLevelOffer:""+e.market.offer,guaranteedStop:r===s.default.GUARANTEED,limitLevel:""+o,lsServerName:"",stopLevel:""+(t||""),timeStamp:this.heartbeat.timestamp,trailingStopDistance:n,trailingStopIncrement:i,trailingStop:r===s.default.TRAILING,dealIds:e.positions.map((function(e){return e.dealId})),removeLimits:a,removeStops:u,quoteId:this.quoteId}}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.indicativeCostsAndChargesService.getIndicativeEditQuote(this)}},{key:"destroy",value:function(){this.position.off("change",this._onPositionChange,this),f(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"isMarketDealable",get:function(){return this.position.canEdit()}},{key:"stopTypes",get:function(){return!this.isUS&&this.position.positions?n.default.getStopTypes(this.market.controlledRisk,this.market.guaranteedStopsAllowed,this.market.trailingStopsAllowedPreference,this.market.isLimitedRisk).filter((function(e){return e.value!==n.default.Type.TRAILING})):n.default.getStopTypes(this.market.controlledRisk,!this.position.isDMA&&this.market.guaranteedStopsAllowed,!this.position.isDMA&&this.market.trailingStopsAllowedPreference,this.market.isLimitedRisk)}},{key:"roundedOpenLevel",get:function(){return Math.round(this.position.openLevel*Math.pow(10,this.market.decimalPlacesFactor))/Math.pow(10,this.market.decimalPlacesFactor)}},{key:"iccPriceLevel",get:function(){return this.roundedOpenLevel||f(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"iccPriceLevel",this)||this.position&&this.position.latest}},{key:"orderLevel",get:function(){return this.position.latest}},{key:"openLevel",get:function(){return this.position.openLevel}},{key:"minStopDistance",get:function(){if(!this.market.dealingRules)return null;var e=this.stopType;return n.default.getMinimumDistanceRuleInPoints(this.stopLevelType,e,(0,o.getMinimumDistanceFromMarket)(e,this.market),this.position.firstTierLatest,this.scalingFactor,this.position)}}]),r}(r.default),d(p.prototype,"stopTypes",[c],Object.getOwnPropertyDescriptor(p.prototype,"stopTypes"),p.prototype),d(p.prototype,"orderLevel",[l],Object.getOwnPropertyDescriptor(p.prototype,"orderLevel"),p.prototype),p);e.default=y}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(29),r(2),r(8),r(125)],i=function(e,t,r,n,i){"use strict";function o(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var u,c,l,p,f,d,y,h,v,g,_,O=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function b(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var m=(u=(0,r.default)("direction","referencePosition"),c=(0,r.default)("hasPositionInSameDirection","referencePosition.stopLevel"),l=(0,r.default)("hasPositionInSameDirection","referencePosition.limitLevel"),p=(0,r.default)("_stopLevel","isPositionStopUsed","referencePosition"),f=(0,r.default)("_stopStep","isPositionStopUsed","referencePosition","referencePosition.stopStep"),d=(0,r.default)("_stopType","isPositionStopUsed","referencePosition","referencePosition.stopType"),y=(0,r.default)("_stopLevelType","isPositionStopUsed","referencePosition"),h=(0,r.default)("_stopTrailingDistance","isPositionStopUsed","referencePosition","referencePosition.stopTrailingDistance"),v=(0,r.default)("_limitLevel","isPositionLimitUsed","referencePosition","referencePosition.limitLevel"),g=(0,r.default)("_limitType","isPositionLimitUsed","referencePosition","referencePosition.limitType"),_=function(e){function t(e,r,n,i,o,s,u){var c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,p=Array(l>7?l-7:0),f=7;f<l;f++)p[f-7]=arguments[f];var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c=t.__proto__||Object.getPrototypeOf(t)).call.apply(c,[this,e,r,n,i,o,s].concat(p)));return a(d,{_stopLevel:d.stopLevel,_stopStep:d.stopStep,_stopType:d.stopType,_stopLevelType:d.stopLevelType,_stopTrailingDistance:d.stopTrailingDistance,_limitLevel:d.limitLevel,_limitType:d.limitType,referencePosition:u}),d._updateReferencePositionListeners(),d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"_onChange",value:function(e){O(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onChange",this).call(this,e),e.includes("referencePosition")&&this._updateReferencePositionListeners()}},{key:"_updateReferencePositionListeners",value:function(){this._removeReferencePositionListener(),this.referencePosition&&(this.referencePosition.on("change",this._onReferencePositionChange,this),this._oldReferencePosition=this.referencePosition)}},{key:"_removeReferencePositionListener",value:function(){var e=this._oldReferencePosition;e&&e.off("change",this._onReferencePositionChange,this),this._oldReferencePosition=null}},{key:"_onReferencePositionChange",value:function(e){var t=[];e.includes("stopLevel")&&t.push.apply(t,o(this.batchChangesForKeys(["referencePosition.stopLevel"]))),e.includes("limitLevel")&&t.push.apply(t,o(this.batchChangesForKeys(["referencePosition.limitLevel"]))),t.length&&this.trigger("change",t)}},{key:"toJSON",value:function(){var e=O(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this);return this.isPositionStopUsed&&delete e.stopDistance,this.isPositionLimitUsed&&delete e.limitDistance,e}},{key:"destroy",value:function(){this._removeReferencePositionListener(),O(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"hasPositionInSameDirection",get:function(){return!(!this.referencePosition||!(0,i.default)(this.direction,this.referencePosition.direction))}},{key:"isPositionStopUsed",get:function(){return!(!this.hasPositionInSameDirection||!this.referencePosition.stopLevel)}},{key:"isPositionLimitUsed",get:function(){return!(!this.hasPositionInSameDirection||!this.referencePosition.limitLevel)}},{key:"stopLevel",get:function(){return this.isPositionStopUsed?this.referencePosition.stopLevel:this._stopLevel},set:function(e){this.isPositionStopUsed||(this._stopLevel=e)}},{key:"stopStep",get:function(){return this.isPositionStopUsed?this.referencePosition.stopStep:this._stopStep},set:function(e){this.isPositionStopUsed||(this._stopStep=e)}},{key:"stopType",get:function(){return this.isPositionStopUsed?this.referencePosition.stopType:this._stopType},set:function(e){this.isPositionStopUsed||(this._stopType=e)}},{key:"stopLevelType",get:function(){return this.isPositionStopUsed?n.default.Type.ABSOLUTE:this._stopLevelType},set:function(e){this.isPositionStopUsed||(this._stopLevelType=e)}},{key:"stopTrailingDistance",get:function(){return this.isPositionStopUsed?this.referencePosition.stopTrailingDistance:this._stopTrailingDistance},set:function(e){this.isPositionStopUsed||(this._stopTrailingDistance=e)}},{key:"limitLevel",get:function(){return this.isPositionLimitUsed?this.referencePosition.limitLevel:this._limitLevel},set:function(e){this.isPositionLimitUsed||(this._limitLevel=e)}},{key:"limitType",get:function(){return this.isPositionLimitUsed?this.referencePosition.limitType:this._limitType},set:function(e){this.isPositionLimitUsed||(this._limitType=e)}}]),t}(t.default),b(_.prototype,"hasPositionInSameDirection",[u],Object.getOwnPropertyDescriptor(_.prototype,"hasPositionInSameDirection"),_.prototype),b(_.prototype,"isPositionStopUsed",[c],Object.getOwnPropertyDescriptor(_.prototype,"isPositionStopUsed"),_.prototype),b(_.prototype,"isPositionLimitUsed",[l],Object.getOwnPropertyDescriptor(_.prototype,"isPositionLimitUsed"),_.prototype),b(_.prototype,"stopLevel",[p],Object.getOwnPropertyDescriptor(_.prototype,"stopLevel"),_.prototype),b(_.prototype,"stopStep",[f],Object.getOwnPropertyDescriptor(_.prototype,"stopStep"),_.prototype),b(_.prototype,"stopType",[d],Object.getOwnPropertyDescriptor(_.prototype,"stopType"),_.prototype),b(_.prototype,"stopLevelType",[y],Object.getOwnPropertyDescriptor(_.prototype,"stopLevelType"),_.prototype),b(_.prototype,"stopTrailingDistance",[h],Object.getOwnPropertyDescriptor(_.prototype,"stopTrailingDistance"),_.prototype),b(_.prototype,"limitLevel",[v],Object.getOwnPropertyDescriptor(_.prototype,"limitLevel"),_.prototype),b(_.prototype,"limitType",[g],Object.getOwnPropertyDescriptor(_.prototype,"limitType"),_.prototype),_);e.default=m}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={QUOTE:"QUOTE",EXCHANGE:"EXCHANGE"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={RECONNECTED:"RECONNECTED"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=void 0;isNaN(e)||isNaN(t)||0===e||(n=t/e);isNaN(n)||parseInt(n,10)===n||(n=+n.toFixed(r));return n}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(5)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,r,n,i,o,a){if(n&&r){if(e===t.UNITS.SHARES)return r*(i*o)*n;if(e===t.UNITS.CONTRACTS)return(a?r*i:r)*(n*o)}return null}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=/(\d{2})\/(\d{2})\/(\d{2}) (\d{2}):(\d{2})/,n=/0?(\d\d?):?(\d\d)?(am)?/,i=(e.toUTCMillisFromAccountTime=function(e,n){var o=e&&e.match(r);if(!o)return null;var a=t(o,6),s=a[1],u=a[2],c=a[3],l=a[4],p=a[5];return i(c=20+c,u,s,l,p)&&l--,Date.UTC(c,u-1,s,l,p)-60*n*60*1e3},e.toAccountTimeFromLondonTime=function(e,r){var i=e.match(n);if(!i)return null;var o=t(i,4),a=o[1],s=void 0===a?0:a,u=o[2],c=void 0===u?0:u,l=o[3];s=+s,l&&12===s?s=0:l||12===s||(s+=12);var p=(s=((s+=+r)+24)%24)<12?"am":"pm";return s=s%12||12,c?s+":"+c+p:""+s+p},function(e,t,r,n,i){var o=new Date(e,t-1,r,n,i),a=new Date(e,2,24),s=new Date(e,9,24);return a.setDate(31-a.getDay()),a.setHours(1),s.setDate(31-s.getDay()),s.setHours(2),o>=a&&o<s})}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,t,r,n,i){if(i)return 1/0;if(t=t||0,n=n||1,!e||!r)return null;return n*(+r+ +t)*e}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(0)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var r=parseFloat(e);return t.default.isNaN(r)?null:r}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){e&&(e=parseFloat(e));return t.default.isFinite(e)&&e>0?e:null}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,t,r){e[t]=r}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(9)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.canEditPosition=function(e){var r=e.market;return r.isAvailableForOnlineTrading()&&r.areEditsAndOrdersAllowed()&&[t.default.TRADEABLE,t.default.EDIT,t.default.AUCTION].includes(r.marketStatus)&&(e.isDMA?r.canTradeDMA():r.canTradeOTC())},e.canClosePosition=function(e){var r=e.market;return!e.isDMA&&r.isAvailableForOnlineTrading()&&r.marketStatus===t.default.TRADEABLE&&r.canTradeOTC()},e.canEditOrder=function(e){var r=e.market;return r.isAvailableForOnlineTrading()&&r.areEditsAndOrdersAllowed()&&[t.default.TRADEABLE,t.default.EDIT,t.default.AUCTION].includes(r.marketStatus)&&(e.isDMA?r.canTradeDMA():r.canTradeOTC())},e.canDeleteOrder=function(e){var r=e.market;return r.isAvailableForOnlineTrading()&&r.areEditsAndOrdersAllowed()&&[t.default.TRADEABLE,t.default.EDIT,t.default.AUCTION].includes(r.marketStatus)&&(e.isDMA?r.canTradeDMA():r.canTradeOTC())}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(6),r(9),r(2)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var o,a,s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var u,c,l,p,f,d,y=(o=(0,n.default)("epic"),a=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i({auditCount:0,displayBid:null,displayOffer:null,currencies:[],isAuditing:!1},e)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"populateWith",value:function(e){this.setProperties(e)}},{key:"isAvailableForOnlineTrading",value:function(){var e=this.marketStatus;return e!==r.default.CLOSED&&(e!==r.default.OFFLINE&&e!==r.default.SUSPENDED)}},{key:"areEditsAndOrdersAllowed",value:function(){return!(!this.stopAllowed&&!this.limitAllowed)}},{key:"canTradeOTC",value:function(){var e="CURRENCIES"===(this.instrumentType||"").toUpperCase(),t=(this.viewPermission||"").toUpperCase();return!(!this.otcTradeable||this.canTradeDMA()&&e&&"L2"===t)}},{key:"canTradeDMA",value:function(){return!!this.dmaTradeable}},{key:"isUnpriced",get:function(){return t.isUnpriced(this.epic)}}],[{key:"isUnpriced",value:function(e){return e===t.unpricedEpic}},{key:"unpricedEpic",get:function(){return"ZZ.Z.UNPRICED.DEAL.IP"}}]),t}(t.default),u=a.prototype,c="isUnpriced",l=[o],p=Object.getOwnPropertyDescriptor(a.prototype,"isUnpriced"),f=a.prototype,d={},Object.keys(p).forEach((function(e){d[e]=p[e]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=l.slice().reverse().reduce((function(e,t){return t(u,c,e)||e}),d),f&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(f):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(u,c,d),d=null),a);e.default=y}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(6)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.boundOnStreamedUpdate=r.onStreamedUpdate.bind(r),r.market&&r._updateMarketListeners(),r.on("change",(function(e){e.includes("market")&&r._updateMarketListeners()})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_updateMarketListeners",value:function(){this._removeMarketListener(),this.market&&(this.market.on("change",this._onMarketChange,this),this._oldMarket=this.market)}},{key:"_removeMarketListener",value:function(){var e=this._oldMarket;e&&e.off("change",this._onMarketChange,this),this._oldMarket=null}},{key:"_onMarketChange",value:function(e){var t=this.batchChangesForKeys(e,"market");t.length&&this.trigger("change",t)}},{key:"isShort",value:function(){return"-"===this.direction}},{key:"isPriceTypeBackOnly",value:function(){return"B"===this.priceType}},{key:"onStreamedUpdate",value:function(){}},{key:"updateFromOther",value:function(e){if(e.dealId!==this.dealId)throw new Error("Attempted to update trade from an incompatible instance: "+this.dealId+" is different from "+e.dealId)}},{key:"destroy",value:function(){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this._removeMarketListener()}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(10),r(13),r(11),r(2),r(0)],i=function(e,t,r,n,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var s,u,c,l,p,f,d,y=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function h(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var v=(s=(0,i.default)("settings","settings.showPartialFill"),u=(0,i.default)("settings","settings.showPointsThroughCurrent"),c=(0,i.default)("pointsThroughCurrent","market","bidPrice","market.scalingFactor"),l=(0,i.default)("pointsThroughCurrent","market","offerPrice","market.scalingFactor"),p=(0,i.default)("marketOrder","pointsThroughCurrent","market"),f=(0,i.default)("settings","settings.showMarketOrder","market","market.dealingRules"),d=function(e){function r(e,t,n,i,a,s,u){var c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var l=a.showPointsThroughCurrent&&a.rememberLastTradedPointsThroughCurrent;o.default.merge(e,{pointsThroughCurrent:l?n.lastTradedPointsThroughCurrent:null,partialFill:a.partialFill});for(var p=arguments.length,f=Array(p>7?p-7:0),d=7;d<p;d++)f[d-7]=arguments[d];var y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c=r.__proto__||Object.getPrototypeOf(r)).call.apply(c,[this,e,t,n,i,a,s,u].concat(f)));return y.marketOrder=y._getMarketOrder(),y.isPosition=!0,y}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),a(r,[{key:"_onChange",value:function(e){y(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_onChange",this).call(this,e),e.includes("marketOrder")&&(this.isNewJapaneseTicket?this.marketOrder&&this.set("pointsThroughCurrent",void 0):this.set("pointsThroughCurrent",void 0)),e.includes("market")&&this.set("marketOrder",this._getMarketOrder())}},{key:"_onMarketChange",value:function(e){y(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_onMarketChange",this).call(this,e),e.includes("dealingRules")&&this.set("marketOrder",this._getMarketOrder())}},{key:"_onSettingsChange",value:function(e){y(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_onSettingsChange",this).call(this,e),e.includes("marketOrder")&&this.set("marketOrder",this._getMarketOrder()),e.includes("partialFill")&&this.set("partialFill",this.settings.partialFill)}},{key:"_getMarketOrder",value:function(){var e=!!this.market&&this.market.dealingRules;return!!e&&"HIDE"!==e.marketOrderPreference&&this.settings.marketOrder&&this.market.marketOrderAllowed}},{key:"toString",value:function(){return n.default.POSITION}},{key:"showPartialFill",get:function(){return this.settings.showPartialFill}},{key:"showPointsThroughCurrent",get:function(){return this.settings.showPointsThroughCurrent}},{key:"stopTypes",get:function(){var e=this.market,r=e.controlledRisk,n=e.guaranteedStopsAllowed,i=e.trailingStopsAllowedPreference,o=e.isLimitedRisk;return t.default.getStopTypes(r,n,i,o)}},{key:"minBid",get:function(){var e=+this.pointsThroughCurrent/this.market.scalingFactor;return e?Math.max(this.bidPrice-e,0).toFixed(this.market.decimalPlacesFactor):null}},{key:"maxOffer",get:function(){var e=+this.pointsThroughCurrent/this.market.scalingFactor,t=+this.offerPrice,r=void 0;return r="Binary"===this.market.instrumentType?Math.min(t+e,100):t+e,e?r.toFixed(this.market.decimalPlacesFactor):null}},{key:"orderType",get:function(){return this.isNewJapaneseTicket?0===this.pointsThroughCurrent||"0"===this.pointsThroughCurrent?"QUOTE":this.pointsThroughCurrent?"LIMIT":"MARKET":this.marketOrder&&this.market.marketOrderAllowed?"MARKET":this.pointsThroughCurrent?"LIMIT":"QUOTE"}},{key:"showMarketOrder",get:function(){return"HIDE"!==this.market.dealingRules.marketOrderPreference&&this.settings.showMarketOrder}}]),r}(r.default),h(d.prototype,"showPartialFill",[s],Object.getOwnPropertyDescriptor(d.prototype,"showPartialFill"),d.prototype),h(d.prototype,"showPointsThroughCurrent",[u],Object.getOwnPropertyDescriptor(d.prototype,"showPointsThroughCurrent"),d.prototype),h(d.prototype,"minBid",[c],Object.getOwnPropertyDescriptor(d.prototype,"minBid"),d.prototype),h(d.prototype,"maxOffer",[l],Object.getOwnPropertyDescriptor(d.prototype,"maxOffer"),d.prototype),h(d.prototype,"orderType",[p],Object.getOwnPropertyDescriptor(d.prototype,"orderType"),d.prototype),h(d.prototype,"showMarketOrder",[f],Object.getOwnPropertyDescriptor(d.prototype,"showMarketOrder"),d.prototype),d);e.default=v}.apply(t,n),void 0===i||(e.exports=i)},function(e,r){e.exports=t},function(e,t,r){var n,i;n=[t,r(0),r(6),r(26),r(51),r(57),r(54),r(56),r(58),r(37),r(55),r(53),r(42),r(60),r(41),r(69),r(29),r(16),r(68),r(43),r(67),r(66),r(11),r(49),r(39),r(36),r(40),r(63),r(64)],i=function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,y,h,v,g,_,O,b,m,T,k,S,E,P,w,L){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var A=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};var D=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),I=function(){function e(t,r,u,h){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._lightstreamerService=r,this._dealReferenceGenerator=new k.default(t.user.accountId),this._marketService=new l.default(t),this._marginService=new a.default(this._session),this._alertPriceLevelService=new p.default(t,n.default.Type.PRICE_LEVEL_ALERT),this._alertPriceChangeService=new p.default(t,n.default.Type.PRICE_CHANGE_ALERT),this._alertService=new p.default(t),this._confirmationStreamingClient=new S.default(this._lightstreamerService,this._session.user.accountId),this._heartbeat=new i.default(r),this._indicativeCostsAndChargesService=new E.default(this._session,this._heartbeat),this._v2InstrumentGroupSubscription=new f.default(r,5),this._v4InstrumentGroupSubscription=new L.default(r,5,t),this._instrumentPriceGroupSubscription=new P.default(r,5,t),this._orderGroupSubscription=new d.default(r,1),this._positionGroupSubscription=new y.default(r,1),this._settingsService=new o.default(t,h),this._positionService=new s.default(t,this._confirmationStreamingClient,this._dealReferenceGenerator),this._orderService=new c.default(t,this._confirmationStreamingClient,this._dealReferenceGenerator),this._dependenciesPromise=Promise.all([this._settingsService.getSettings(),this._heartbeat.prepare()])}return D(e,[{key:"getMarketService",value:function(){return this._marketService}},{key:"getAlertService",value:function(){return this._alertService}},{key:"getAlertPriceLevelService",value:function(){return this._alertPriceLevelService}},{key:"getAlertPriceChangeService",value:function(){return this._alertPriceChangeService}},{key:"getMarginService",value:function(){return this._marginService}},{key:"getIndicativeCostsAndChargesService",value:function(){return this._indicativeCostsAndChargesService}},{key:"getPositionService",value:function(){return this._positionService}},{key:"getOrderService",value:function(){return this._orderService}},{key:"getSettingsService",value:function(){return this._settingsService}},{key:"getHeartbeat",value:function(){return this._heartbeat}},{key:"getV2InstrumentGroupSubscription",value:function(){return this._v2InstrumentGroupSubscription}},{key:"getV4InstrumentGroupSubscription",value:function(){return this._v4InstrumentGroupSubscription}},{key:"getInstrumentPriceGroupSubscription",value:function(){return this._instrumentPriceGroupSubscription}},{key:"getOrderGroupSubscription",value:function(){return this._orderGroupSubscription}},{key:"getPositionGroupSubscription",value:function(){return this._positionGroupSubscription}},{key:"getRepeatDealWindowGroupSubscription",value:function(){return this._rdwGroupSubscription||(this._rdwGroupSubscription=new w.default(this._session,this._confirmationStreamingClient,this._heartbeat)),this._rdwGroupSubscription}},{key:"getPositionStore",value:function(){var e=s.default.getStreamingClient(this._lightstreamerService,this._session);return new u.default(this._session,this._positionService,this._marketService,e,this._lightstreamerService)}},{key:"getOrderStore",value:function(){var e=c.default.getStreamingClient(this._lightstreamerService);return new u.default(this._session,this._orderService,this._marketService,e,this._lightstreamerService)}},{key:"createOpenPositionTickets",value:function(e){var t=this;return this._getOpenTicketDependenciesFor(e).then((function(e){var r=A(e,2),n=r[0],i=A(r[1],2),o=i[0],a=i[1];return n.map((function(e){return new v.default(t._positionService,e,a,o,t._dealReferenceGenerator,t._session)}))}))}},{key:"createOpenPositionTicket",value:function(e){return this.createOpenPositionTickets([e]).then(t.default.head)}},{key:"createOpenFifoPositionTicket",value:function(e,r){var n=this;return this._getOpenTicketDependenciesFor([e]).then((function(e){var t=A(e,2),i=t[0],o=A(t[1],2),a=o[0],s=o[1];return i.map((function(e){return new h.default(n._positionService,e,s,a,n._dealReferenceGenerator,n._session,r)}))})).then(t.default.head)}},{key:"createOpenOrderTickets",value:function(e){var t=this;return this._getOpenTicketDependenciesFor(e).then((function(e){var r=A(e,2),n=r[0],i=A(r[1],2),o=i[0],a=i[1];return n.map((function(e){return new g.default(t._orderService,e,a,o,t._dealReferenceGenerator,t._session)}))}))}},{key:"createOpenOrderTicket",value:function(e){return this.createOpenOrderTickets([e]).then(t.default.head)}},{key:"createEditPositionTickets",value:function(e){var t=this;return this._dependenciesPromise.then((function(r){var n=A(r,2),i=n[0],o=n[1];return e.map((function(e){return new _.default(t._positionService,e,o,i,t._dealReferenceGenerator,t._session)}))}))}},{key:"createEditPositionTicket",value:function(e){return this.createEditPositionTickets([e]).then(t.default.head)}},{key:"createClosePositionTickets",value:function(e){var t=this;return this._dependenciesPromise.then((function(r){var n=A(r,2),i=n[0],o=n[1];return e.map((function(e){return new O.default(t._positionService,e,o,i,t._dealReferenceGenerator,t._session)}))}))}},{key:"createClosePositionTicket",value:function(e){return this.createClosePositionTickets([e]).then(t.default.head)}},{key:"createEditOrderTickets",value:function(e){var t=this;return this._dependenciesPromise.then((function(r){var n=A(r,2),i=n[0],o=n[1];return e.map((function(e){return new b.default(t._orderService,e,o,i,t._dealReferenceGenerator,t._session)}))}))}},{key:"createDeleteOrderTicket",value:function(e){return this.createDeleteOrderTickets([e]).then(t.default.head)}},{key:"createDeleteOrderTickets",value:function(e){var t=this;return this._dependenciesPromise.then((function(r){var n=A(r,2),i=n[0],o=n[1];return e.map((function(e){return new m.default(t._orderService,e,o,i,t._dealReferenceGenerator,t._session)}))}))}},{key:"createEditOrderTicket",value:function(e){return this.createEditOrderTickets([e]).then(t.default.head)}},{key:"switchTicket",value:function(e,t){var r=e.market,n=e.toString(),i=void 0;if(n===t)return Promise.resolve(e);switch(t){case T.default.ORDER:i=this.createOpenOrderTicket(r);break;case T.default.POSITION:i=this.createOpenPositionTicket(r);break;default:i=n===T.default.POSITION?this.createOpenOrderTicket(r):this.createOpenPositionTicket(r)}return i.then((function(t){return t.allowsForStopType(e.stopType)&&t.setProperties({stopLevel:e.stopLevel,stopLevelType:e.stopLevelType,stopType:e.stopType,stopStep:e.stopStep}),t.setProperties({currency:e.currency,direction:e.direction,limitLevel:e.limitLevel,limitType:e.limitType,size:e.size,shouldUpdateFieldsOnSettingsChange:e.shouldUpdateFieldsOnSettingsChange}),t}))}},{key:"_getOpenTicketDependenciesFor",value:function(e){return Promise.all([r.default.isModel(e[0])?Promise.resolve(e):this._marketService.findByEpics(e),this._dependenciesPromise])}},{key:"getTicketDependencies",value:function(){return{dependenciesPromise:this._dependenciesPromise,dealReferenceGenerator:this._dealReferenceGenerator,confirmationClient:this._confirmationStreamingClient,session:this._session}}},{key:"destroy",value:function(){var e=this;this._dependenciesPromise.then((function(t){A(t,2)[1].destroy();for(var r=["_positionService","_orderService","_settingsService","_confirmationStreamingClient","_v2InstrumentGroupSubscription","_v4InstrumentGroupSubscription","_instrumentPriceGroupSubscription","_rdwGroupSubscription","_orderGroupSubscription","_positionGroupSubscription"],n=0;n<r.length;n++){var i=r[n];e[i]&&(e[i].destroy(),e[i]=null)}}))}}]),e}();e.default=I}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,t,r,n,i){return+(e/t/i/r).toFixed(n)}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return e*(1-t/100)}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var t=e.buyPrice,r=e.sellPrice;if(null===t&&null===r)return!1;return(t=t||0)-(r=r||0)>.1*t||0===t||0===r}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";function t(e){var t=void 0;return 0===e.length?t="empty":/^\d*$/.test(e)?e.length<8||e.length>9?t="length":"123456782"!==e&&function(e){for(var t=[10,7,8,4,6,3,5,2,1],r=parseInt(e,10),n=t.length-1,i=0;n>=0;)i+=t[n]*(r%10),8===e.length&&8===n?n-=2:n--,r=Math.floor(r/10);return i%11==0}(e)||(t="other"):t="character",t?{isValid:!1,error:{key:t}}:{isValid:!0}}function r(e){return["000000000","00000000","333333333","444444441","444444442","555555555","666666666","777777777","888888888","987654321"].includes(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.isValid=t,e.isExempt=r,e.default={isValid:t,isExempt:r}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentAccountId=null,this.decisionMakerAccountId=null,this.accounts=t}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function e(t,r,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"deal",u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.origin=t||"",this.path=s,this.applicationType=r,this.deviceType=o,this.platform=n,this.view=a,this.version=i,this.component=u,this.componentVersion=c,Object.freeze(this)}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.environment=t,this.user=r,this.featureFlags=n,Object.freeze(this)}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(0),r(35)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var a=function(e){function a(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var o=t.without.apply(void 0,[Object.keys(r.defaultSettings)].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(Object.keys(e)))),s=o.reduce((function(e,t){return e[t]=i[t],e}),{}),u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,n({},s,e)));return u._globalSettingsKeys=o,u._globalSettings=i,u._globalSettings.on("change",u._onGlobalSettingsChange,u),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,e),i(a,[{key:"_onGlobalSettingsChange",value:function(e){var r=(0,t.intersection)(e,this._globalSettingsKeys),n=r.length;if(n){for(var i={},o=0;o<n;o++){var a=r[o];i[a]=this._globalSettings[a]}this.setProperties(i)}}},{key:"destroy",value:function(){this._globalSettings.off("change",this._onGlobalSettingsChange,this),o(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"destroy",this).call(this)}}]),a}(r.default);e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r=function(){function e(t,r,n,i,o,a,s,u,c,l,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{accountId:{value:t,enumerable:!0,writable:!1},ssoToken:{value:r,enumerable:!0,writable:!1},cstToken:{value:n,enumerable:!0,writable:!1},locale:{value:i,enumerable:!0,writable:!1},siteId:{value:o,enumerable:!0,writable:!1},siteType:{value:a,enumerable:!0,writable:!1},productCode:{value:s,enumerable:!0,writable:!1},igCompany:{value:u,enumerable:!0,writable:!1},assetClass:{value:c,enumerable:!0,writable:!1},isRetailAccount:{value:l,enumerable:!0,writable:!1},clientId:{value:p,enumerable:!0,writable:!1},broker:{value:null,enumerable:!0,writable:!0}}),Object.seal(this)}return t(e,[{key:"isUSFx",get:function(){return"usa"===this.siteId}},{key:"isCFD",get:function(){return"CFD"===this.siteType}},{key:"isSpreadbet",get:function(){return"SPREAD_BET"===this.siteType}},{key:"isOptions",get:function(){return"IGFUTOPT"===this.productCode}},{key:"isFifo",get:function(){return["usa","usi"].includes(this.siteId)}},{key:"isMTF",get:function(){return"PHYSICAL"===this.siteType&&"MTFTURBO"===this.productCode}}]),e}();e.default=r}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(37),r(136),r(137),r(138)],i=function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var a=function(e){function t(e,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n));return o._lsServerName=i,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"delete",value:function(e){return new r.default(e,this._session,this._confirmationStreamingClient,this._lsServerName)}},{key:"edit",value:function(e){return new n.default(e,this._session,this._confirmationStreamingClient)}},{key:"close",value:function(e){return new i.default(e,this._session,this._confirmationStreamingClient)}},{key:"lightstreamerServerAddress",get:function(){return this._lsServerName}}]),t}(t.default);e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(7),r(154),r(0)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15e3;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return n.debounceTime=r,n.lightstreamerService=e,n.subscriptions={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"_handleMarketUpdate",value:function(e){this.trigger(e)}},{key:"add",value:function(e,i){if(!this.subscriptions[e]){var o=t.generateEventName(e),a=new r.default(this.lightstreamerService);i.length&&(i.forEach((function(e){return a.add(e)})),this.subscriptions[e]=a,a.on(r.default.UPDATE_EVENT,n.default.debounce(this._handleMarketUpdate.bind(this,o),this.debounceTime),this))}}},{key:"remove",value:function(e){this.subscriptions[e]&&(this.subscriptions[e].destroy(),this.subscriptions[e]=null)}},{key:"destroy",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){e.remove(t)})),this.off()}}],[{key:"generateEventName",value:function(e){return"watchlist-change-"+n.default.kebabCase(e)}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(1),r(0)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t}return i(e,[{key:"queryApi",value:function(e,i,o,a){var s=n({},e,{fields:encodeURIComponent(i.join(",")),includes:encodeURIComponent(o.join(",")),sort:encodeURIComponent(e.sort||a.join(",")),pageSize:e.pageSize||1e3}),u=r.default.pickBy(s),c="/findergateway/v1/instruments"+this.createUrlParams(u);return t.get(c,this._session)}},{key:"queryApiWithInstrumentTypes",value:function(e,i,o,a,s){var u=n({},e,{fields:encodeURIComponent(i.join(",")),includes:encodeURIComponent(o.join(",")),sort:encodeURIComponent(e.sort||a.join(",")),pageSize:e.pageSize||1e3}),c=r.default.pickBy(u),l="/findergateway/v2/instruments"+this.createUrlParams(c);return s&&s.length&&s.forEach((function(e){l+="&instrumentType="+e})),t.get(l,this._session)}},{key:"createUrlParams",value:function(e){return"?"+Object.keys(e).map((function(t){return t+"="+e[t]})).join("&")}}]),e}();e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(158)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n="function"==typeof t.get?t:t.default&&"function"==typeof t.default.get?t.default:(console.warn("Could not import js-cookie, using a dummy implementation"),Object.freeze({get:function(){return null},set:function(){}})),i=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._deprecatedLocalStorageKey=r,this._localStorageKey=this._session.user.accountId+"_"+r,this._migrationCookieKey=this._localStorageKey+"_awsMigration"}return r(e,[{key:"getData",value:function(){var e=this._getLocalStorageItem();return e||(e=this._getMigrateCookie(),localStorage.setItem(this._localStorageKey,e)),JSON.parse(e||"{}")[this._session.user.accountId]||null}},{key:"setData",value:function(e){var t=JSON.stringify(function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},this._session.user.accountId,e));localStorage.setItem(this._localStorageKey,t),this._setMigrateCookie(t)}},{key:"_getLocalStorageItem",value:function(){return localStorage.getItem(this._localStorageKey)||localStorage.getItem(this._deprecatedLocalStorageKey)}},{key:"_getMigrateCookie",value:function(){return n.get(this._migrationCookieKey)}},{key:"_setMigrateCookie",value:function(e){n.set(this._migrationCookieKey,e,{domain:"ig.com",expires:365})}}]),e}();e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(139),r(140),r(141),r(1)],i=function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._confirmationStreamingClient=r,this._dealReferenceGenerator=n}return o(e,[{key:"create",value:function(e){return new t.default(e,this._session,this._confirmationStreamingClient)}},{key:"edit",value:function(e){return new n.default(e,this._session,this._confirmationStreamingClient)}},{key:"delete",value:function(e){return new r.default(e,this._session,this._confirmationStreamingClient)}},{key:"getEstimatedCharges",value:function(e){var t="/"+this._session.environment.path+"/orders/considerations/estimatecharges",r={currencyCode:e.currency.name,direction:e.direction.toUpperCase(),epic:e.market.epic,size:e.size};return"LIMIT"===e.orderType||"STOP_LIMIT"===e.orderType?r.level=e.triggerLevel:"STOP_MARKET"===e.orderType?r.level=e.stopPrice:"MARKET"===e.orderType?r.level=e.priceWithTolerance:"buy"===e.direction?r.level=e.market.offer:r.level=e.market.bid,i.post(t,this._session,r)}}]),e}();e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(1),r(0),r(14)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._lightstreamerService=t,this._session=r,this._subscriptionString="V2-M-MESSAGE_EVENT_HANDLER|QMS_"+r.user.accountId,this._listeners={},this._pollTimeoutIds={},this._pollTimeout=n,this._startListening(this._subscriptionString)}return o(e,[{key:"getQuote",value:function(e,o){var a=this,s=n.default.isConsideration(e.sizeUnit),u="/"+o.environment.path+"/stockbroking/"+(s?"consideration":"")+"quote",c={dealReference:e.quoteDealReference,direction:e.direction.toUpperCase(),epic:e.market.epic},l={isoCurrencyCode:e.currency.name,size:e.size,submittedTimestamp:e.heartbeat.timestamp},p={considerationAmount:e.size,considerationCurrencyCode:e.sizeUnit===n.default.VALUE?e.considerationCurrency:e.currency.name,orderLevel:e.openLevel,tradeCurrencyCode:e.currency.name,submittedTimestamp:e.heartbeat.timestamp/1e3},f=i({},c,s?p:l),d="/"+o.environment.path+"/stockbroking/quote/"+e.quoteDealReference;return new Promise((function(n,i){var s=(0,r.curry)((function(t,r){a._clearPoll(e.quoteDealReference),delete a._listeners[e.quoteDealReference],t(r)}));a._listeners[e.quoteDealReference]={resolve:s(n),reject:s(i)},t.post(u,o,f).then((function(){a._listeners[e.quoteDealReference]&&a._schedulePoll(s(i),0,a._pollTimeout,e.quoteDealReference,d)})).catch((function(t){delete a._listeners[e.quoteDealReference],i(t)}))}))}},{key:"destroy",value:function(){this._stopListening(),this._clearAllPolls()}},{key:"_stopListening",value:function(){this._subscription&&(this._subscription.unsubscribe(),this._subscription=null)}},{key:"_clearAllPolls",value:function(){var e=this;Object.keys(this._pollTimeoutIds).forEach((function(t){clearTimeout(e._pollTimeoutIds[t])})),this._pollTimeoutIds={}}},{key:"_clearPoll",value:function(e){this._pollTimeoutIds[e]&&(clearTimeout(this._pollTimeoutIds[e]),delete this._pollTimeoutIds[e])}},{key:"_startListening",value:function(e){this._subscription=this._lightstreamerService.subscribe(e,["update"],"RAW",this._handleLightstreamerMessage.bind(this))}},{key:"_handleLightstreamerMessage",value:function(e){var t=e.getValue("update");if("INV"!==t){var r=JSON.parse(t);this._resolveOrReject(r)}}},{key:"_resolveOrReject",value:function(e){var t=this._listeners[e.content.requestId];t&&("QUOTE"===e.category?t.resolve(e):"QUOTE_REJECTED"===e.category&&t.reject(e))}},{key:"_schedulePoll",value:function(e,t,r,n,i){var o=this;this._pollTimeoutIds[n]=setTimeout((function(){delete o._pollTimeoutIds[n],o._poll(e,t,n,i)}),r)}},{key:"_poll",value:function(e,r,n,i){var o=this;t.get(i,this._session).then(this._resolveOrReject.bind(this)).catch((function(){var t=void 0,a=void 0;++r>=7?e("RETRY_COUNT_EXCEEDED"):(a=.4*(t=o._pollTimeout*Math.pow(1.3,r)),t=t+Math.random()*a-.5*a,o._schedulePoll(e,r,t,n,i))}))}}]),e}();e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(5),r(1),r(0)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a="KNOCKOUTS2",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t}return o(e,[{key:"getDerivativesForUnderlying",value:function(e){var t=this;return this._get("/findergateway/v2/derivatives?q="+encodeURIComponent(e)).then((function(e){return t.enrichSearchMarkets(e)}))}},{key:"getDerivativesForMarket",value:function(e){var t=this;return this._get("/findergateway/v2/derivatives/contract?q="+encodeURIComponent(e)).then((function(e){return t.enrichSearchMarkets(e)}))}},{key:"search",value:function(e,t){var r=this;return(t=t||{}).q=encodeURIComponent(e),this._get("/findergateway/search/global"+this.createUrlParams(t)).then((function(e){return r.enrichSearchMarkets(e)}))}},{key:"v1Search",value:function(e,t){return this.getUnderlyingInstruments(i({},t,{searchTerm:encodeURIComponent(e),includes:["permissionStatus","marketSnapshotData"]}))}},{key:"inlineSearch",value:function(e){return this._get("/findergateway/inline?q="+encodeURIComponent(e))}},{key:"getBinariesForUnderlying",value:function(e){return this._get("/findergateway/binaries?q="+encodeURIComponent(e))}},{key:"getUnderlyingInstruments",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=["epic","underlyingId","underlyingName","name","knockoutType","baseCurrency","bloombergCode","availableForTrade","instrumentType"];e.category===a&&n.push("referenceEpic");return this.queryApi(e,n,["marketSnapshotData"],r).then((function(r){return t.enrichSearchInstruments(r,e.category)}))}},{key:"getCategory",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=i({distinct:!0,category:e},arguments[2]);return this.queryApi(n,["referenceEpic","underlyingName"],["referenceMarketSnapshotData"],r).then((function(r){return t.enrichSearchInstruments(r,e)}))}},{key:"queryApi",value:function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=i({},e,{fields:encodeURIComponent(t.join(",")),includes:encodeURIComponent(e.includes||r.join(",")),sort:encodeURIComponent(e.sort||o.join(",")),pageSize:e.pageSize||1e3}),s=n.default.pickBy(a),u="/findergateway/v2/instruments"+this.createUrlParams(s);return this._get(u)}},{key:"enrichSearchInstruments",value:function(e,r){var i=e.results.instruments;i=i.map((function(e){var n={marketSnapshotData:e.marketSnapshotData||e.referenceMarketSnapshotData,permissionStatus:e.permissionStatus};return n.id=e.epic,n.epic=e.epic||e.referenceEpic,n.referenceEpic=e.referenceEpic,n.instrumentName=e.name,n.underlyingName=e.underlyingName,n.underlyingId=e.underlyingId,n.knockoutType=e.knockoutType,n.baseCurrency=e.baseCurrency,n.bloombergCode=e.bloombergCode,n.availableForTrade=e.availableForTrade,n.isKnockoutV2=r===a,n.instrumentType=e.instrumentType,t.default.populateWithMarketLiteData(n)}),this),e.results.instruments=i;var o=e.filters||[];return o=o.map((function(e){return e.all=e.fullList,n.default.pick(e,["displayName","key","lookupKey","shortList","all"])})),e.filters=o,e}},{key:"enrichSearchMarkets",value:function(e){var r=e.markets||e.results.markets;return r=r.map((function(e){var r=e.market;return r.epic=e.epic,r.lastSelectedEpic=e.lastSelectedEpic,r.instrumentName=e.instrumentName,r.underlyingName=e.underlyingName,r.underlyingId=e.underlyingId,r.knockoutType=e.knockoutType,r.id=e.id,r=r.instrumentData?t.default.populateWithV2MarketData(r):t.default.populateWithMarketLiteData(r)}),this),e.markets?e.markets=r:e.results.markets=r,e}},{key:"_get",value:function(e){return r.get(e,this._session,!1,{"IG-ACCOUNT-ID":this._session.user.accountId})}},{key:"createUrlParams",value:function(e){return e?"?"+Object.keys(e).map((function(t){return t+"="+e[t]})).join("&"):""}}]),e}();e.default=s}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(150),r(149),r(151),r(152),r(148),r(1),r(14)],i=function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._confirmationStreamingClient=r,this._dealReferenceGenerator=n,this._quoteService=i}return u(e,[{key:"getQuote",value:function(e){return this._quoteService.getQuote(e,this._session)}},{key:"getCharges",value:function(e){var t=e.sizeUnit!==s.default.QUANTITY,r=e.effectiveLevel||e.currentMarketLevel,n={currencyCode:e.currency.name,direction:e.direction.toUpperCase(),epic:e.market.epic,level:r,size:e.size},i={considerationAmount:e.size,considerationCurrencyCode:e.sizeUnit===s.default.VALUE?e.considerationCurrency:e.currency.name,direction:e.direction.toUpperCase(),epic:e.market.epic,orderLevel:r,tradeCurrencyCode:e.currency.name},o=t?"estimateordersize":"estimatecharges",u=t?i:n,c="/"+this._session.environment.path+"/orders/considerations/"+o;return a.post(c,this._session,u)}},{key:"createQuoteOrder",value:function(e){return new r.default(e,this._session,this._confirmationStreamingClient)}},{key:"createExchangeOrder",value:function(e){return new o.default(e,this._session,this._confirmationStreamingClient)}},{key:"editOrder",value:function(e){return new n.default(e,this._session,this._confirmationStreamingClient)}},{key:"editPosition",value:function(e){return new i.default(e,this._session,this._confirmationStreamingClient)}},{key:"deleteOrder",value:function(e){return new t.default(e,this._session,this._confirmationStreamingClient)}}]),e}();e.default=c}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._settings={},this._localForceOpenSettingCache=r}return n(e,[{key:"getPreferences",value:function(){var e=this;return r.get("/usermanagement/preferences/DEAL",this._session,!0).then((function(r){return e._settings=t.default.cloneDeep(r),e._localForceOpenSettingCache.setData(r.forceOpen),r})).catch((function(){var t=e._localForceOpenSettingCache.getData();return"boolean"==typeof t?{forceOpen:t}:{}}))}},{key:"getModifiedProperties",value:function(e){var r=this;return t.default.pickBy(e,(function(t,n){return r._settings[n]!==e[n]}))}},{key:"setPreferences",value:function(e){var n=this,i=this.getModifiedProperties(e);return"boolean"==typeof i.forceOpen&&this._localForceOpenSettingCache.setData(i.forceOpen),r.put("/usermanagement/preferences/DEAL",this._session,i).then((function(){t.default.assign(n._settings,i)}))}}]),e}();e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(134),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._session=t,this._requestHeaders={"IG-ACCOUNT-ID":t.user.accountId}}return n(e,[{key:"createWatchlist",value:function(e){var n="/"+this._session.environment.path+"/markets/watchlists";return r.post(n,this._session,{name:e},this._requestHeaders).then((function(r){var n=r.watchlistId;if("SUCCESS_CREATED"!==r.status)throw new Error("Watchlist creating was unsuccessful");return t.default.fromDealingRestWatchlist({id:n,name:e,count:0,editable:!0,deleteable:!0})}))}},{key:"deleteWatchlist",value:function(e){if(!e.deleteable)return Promise.reject(new Error("Cannot remove non-deleteable watchlist"));var t="/"+this._session.environment.path+"/markets/watchlists/"+e.id;return r.del(t,this._session,null,this._requestHeaders)}},{key:"renameWatchlist",value:function(e,t){return e.editable?r.put("/"+this._session.environment.path+"/markets/watchlists/"+e.id,this._session,{name:t},this._requestHeaders):Promise.reject(new Error("Cannot rename non-editable watchlist"))}},{key:"getWatchlists",value:function(){var e="/"+this._session.environment.path+"/markets/watchlists";return r.get(e,this._session,!1,this._requestHeaders).then((function(e){return e.map(t.default.fromDealingRestWatchlist)}))}},{key:"addMarketToWatchlist",value:function(e,t){if(!e.editable)return Promise.reject(new Error("Cannot add to non-editable watchlist"));var n="/"+this._session.environment.path+"/markets/watchlists/"+e.id;return r.post(n,this._session,{epicId:t},this._requestHeaders)}},{key:"removeMarketFromWatchlist",value:function(e,t){if(!e.editable)return Promise.reject(new Error("Cannot remove from non-editable watchlist"));var n="/"+this._session.environment.path+"/markets/watchlists/"+e.id+"/"+t;return r.del(n,this._session,null,this._requestHeaders)}},{key:"persistMarketOrder",value:function(e,t){var n="/"+this._session.environment.path+"/markets/watchlists/"+e.id;return r.put(n,this._session,{epics:t},this._requestHeaders)}}]),e}();e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(42)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"add",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments[2];n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e,r.concat("ADT_LIMIT"),i),e.setProperties({auditCount:0,isAuditing:!0})}},{key:"remove",value:function(e){var r=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e);return r||e.set("isAuditing",!1),r}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(15)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var i="CI.U.GBPGBP.IP",o=function(e){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"V2-F-{fids}{modifiers}|{id}","MERGE",n));return i._currentAccountCurrencyFid=r,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"add",value:function(e,r,o){e!==i&&n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e,["OFR"],r),this._currentAccountCurrencyFid!==i&&n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,this._currentAccountCurrencyFid,["OFR"],o)}},{key:"remove",value:function(e,r){var i=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,r),o=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e);return i&&o}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(40)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"add",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e,r),e.setProperties({auditCount:0,isAuditing:!0})}},{key:"remove",value:function(e){var r=n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e);return r||e.set("isAuditing",!1),r}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0),r(39),r(156)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t));return n._removeListenersImmediately=!1,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),i(r,[{key:"getListener",value:function(e,t,r){return new n.default(e,t,r,this.removeListeners.bind(this))}},{key:"removeListeners",value:function(e){var r=t.default.filter(this._listeners,(function(t){return t.dealReference===e}));this._listeners=t.default.difference(this._listeners,r)}}]),r}(r.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(12),r(33),r(7)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var a=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._lightstreamerService=e,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),i(n,[{key:"startListening",value:function(e){return this._subscription=new r.default("V2-M-MESSAGE_EVENT_HANDLER|SIGNAL_CENTRE_{identifier}","MSG",this._lightstreamerService).startListening(e),this._subscription.on(r.default.Events.UPDATED,this._handleStreamingUpdate.bind(this)),this}},{key:"_handleStreamingUpdate",value:function(e){var r=e.status;"REMOVE"===r?this.trigger(t.default.REMOVED,e.signalId):"NEW"===r&&this.trigger(t.default.UPDATED,e)}},{key:"stopListening",value:function(){this._subscription&&(this._subscription.destroy(),this._subscription=null),this.off()}},{key:"destroy",value:function(){this.stopListening(),o(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this),this._lightstreamerService=null}}]),n}(n.default);e.default=a}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0),r(43),r(34),r(3),r(2),r(25),r(17),r(9)],i=function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var p,f,d,y,h,v,g,_=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function O(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var b=Object.freeze({0:"GoodForDay",1:"GoodTillCancelled",3:"ExecuteAndEliminate",4:"FillOrKill",6:"GoodForDay",X:"GoodForDayAllSessions"}),m=Object.freeze({1:"Market",2:"MarketLimit",3:"MarketStop",4:"MarketLimit",5:"MarketLimit",7:"MarketLimit",8:"MarketLimit",9:"MarketLimit",A:"MarketLimit",B:"MarketLimit",C:"Market",D:"MarketLimit",E:"MarketLimit",F:"MarketLimit"}),T=(p=(0,o.default)("market","market.dmaMarketData","market.marketStatus","isSell"),f=(0,o.default)("_orderType","position.dmaOrderType"),d=(0,o.default)("_timeInForce","position.dmaTimeInForce"),y=(0,o.default)("_orderType"),h=(0,o.default)("isSell","bidPrice","offerPrice","triggerLevel"),v=(0,o.default)("market","market.marketStatus"),g=function(e){function r(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=r.__proto__||Object.getPrototypeOf(r)).call.apply(n,[this,e,t].concat(o)));return s.setProperties({position:t,size:t.dealSize,direction:"+"===t.direction?"sell":"buy",isDMA:t.isDMA,_orderType:null,_timeInForce:null,hasOrderFields:!1,updateInitialDMAOrderTypesAndExpiries:!1}),t.isDMA||s.setInitialOrderTypeAndExpiry(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),l(r,[{key:"_getValidators",value:function(){return[i.direction,i.marketDealable,i.sizeBelowMax,i.sizeAboveZero,i.stopPriceRightSideOfBidOfferPriceForDMATicket,i.triggerLevelAboveZeroForNonMarketOrder,i.triggerLevelDmaCorrectIncrementTick]}},{key:"_onChange",value:function(e){_(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_onChange",this).call(this,e),(e.includes("_orderType")||e.includes("triggerLevel")||e.includes("_timeInForce"))&&this._updateMargin()}},{key:"_onMarketChange",value:function(e){_(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_onMarketChange",this).call(this,e),this.updateInitialDMAOrderTypesAndExpiries&&e.includes("dmaMarketData")&&this.market.dmaMarketData&&(this.set("updateInitialDMAOrderTypesAndExpiries",!1),this.setInitialOrderTypeAndExpiry())}},{key:"_getMargin",value:function(){return this.marginService.getClosePositionMargin(this)}},{key:"setInitialOrderTypeAndExpiry",value:function(){var e=this.settings.rememberLastTradedOrderTypeAndExpiry,t=(0,a.getFirstValidDMAOrderTypeFromMarketData)(this.availableOrderTypeAndExpiryValues,e,this.market.lastTradedOrderType,this.market.defaultOrderType),r=(0,a.getFirstValidOrderExpiry)(this.availableOrderTypeAndExpiryValues,t,e,this.market.lastTradedOrderExpiry,this.market.defaultOrderExpiry);this.setProperties({orderType:t.orderType,timeInForce:r,hasOrderFields:!0})}},{key:"checkForValidOrderTypeAndExpiry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.position||!this.market.dmaMarketData||!this.orderType&&!this.timeInForce)return!0;var t=(0,a.getValidExpiries)(this.availableOrderTypeAndExpiryValues,this.orderType),r=t.includes(this.timeInForce);return!r&&e?(this.set("timeInForce",t[0]),!0):r}},{key:"getFirstDmaPositionFromAggregate",value:function(){return this.position.positions.find((function(e){return e.isDMA}))}},{key:"_submitDeal",value:function(){return this._restService.close(this)}},{key:"_updatePerMarketSettings",value:function(){}},{key:"toJSON",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.position,o=_(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"toJSON",this).call(this),a=void 0;a=e?t.default.pick(o,["currencyCode","dealReference","dealTicketMargin","marginCurrency","quoteId","submittedTimestamp"]):t.default.pick(o,["dealTicketMargin","dealReference"]);var s=this._session.user.broker;s&&s.decisionMakerAccountId&&(a.decisionMakerAccountId=s.decisionMakerAccountId);var u={lsServerName:this._restService.lightstreamerServerAddress,orderLevel:this.orderLevel,orderSize:this.size,orderType:this.orderType,pricePreference:this.direction.toUpperCase(),timeInForce:this.timeInForce,timeStamp:+this._getSubmittedTimestamp(),dealReference:a.dealReference},l={dealId:i.dealId,direction:this.direction.toUpperCase(),epic:i.market.epic,orderLevel:this.orderLevel,orderSize:this.size,orderType:this.orderType,pricePreference:this.direction.toUpperCase(),timeInForce:this.timeInForce};if(i instanceof n.default){var p=i.positions;e?(delete l.dealId,l.dealIds=p.map((function(e){return e.dealId}))):(u.epic=i.market.epic,u.direction="+"===i.direction?"-":"+",u.currencyCode=o.currencyCode)}return c({},a,e?l:u)}},{key:"toMarginJSON",value:function(){return this.toJSON(!0)}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.indicativeCostsAndChargesService.getIndicativeCloseQuote(this)}},{key:"destroy",value:function(){_(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"_validationDependentKeys",get:function(){var e=_(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_validationDependentKeys",this);return this.hasOrderFields&&e.push("orderType","triggerLevel","timeInForce"),e}},{key:"availableOrderTypeAndExpiryValues",get:function(){if(this.market.dmaMarketData)return(0,a.getValidDMAOrderTypesFromMarketData)(this.market.dmaMarketData.orderTypesAvailable,this.isSell,this.market.marketStatus,null,!1)}},{key:"orderType",get:function(){if(this.position){if(this._orderType)return this._orderType;var e=this.position;if(e instanceof n.default){var t=this.getFirstDmaPositionFromAggregate();return t?m[t.dmaOrderType]:void 0}return m[e.dmaOrderType]}},set:function(e){this.set("_orderType",e),this.checkForValidOrderTypeAndExpiry(!0)}},{key:"timeInForce",get:function(){if(this.position){if(this._timeInForce)return this._timeInForce;var e=this.position;if(e instanceof n.default){var t=this.getFirstDmaPositionFromAggregate();return t?b[t.dmaTimeInForce]:void 0}return b[e.dmaTimeInForce]}},set:function(e){this.set("_timeInForce",e)}},{key:"ignoreOrderLevel",get:function(){return this.orderType===s.default.MARKET}},{key:"orderLevel",get:function(){return this.orderType===s.default.MARKET?this._calculateMarketLevel():this.triggerLevel}},{key:"isMarketDealable",get:function(){return[u.default.TRADEABLE,u.default.AUCTION,u.default.CLOSE_ONLY].includes(this.market.marketStatus)}},{key:"iccDirection",get:function(){return this.direction}}]),r}(r.default),O(g.prototype,"availableOrderTypeAndExpiryValues",[p],Object.getOwnPropertyDescriptor(g.prototype,"availableOrderTypeAndExpiryValues"),g.prototype),O(g.prototype,"orderType",[f],Object.getOwnPropertyDescriptor(g.prototype,"orderType"),g.prototype),O(g.prototype,"timeInForce",[d],Object.getOwnPropertyDescriptor(g.prototype,"timeInForce"),g.prototype),O(g.prototype,"ignoreOrderLevel",[y],Object.getOwnPropertyDescriptor(g.prototype,"ignoreOrderLevel"),g.prototype),O(g.prototype,"orderLevel",[h],Object.getOwnPropertyDescriptor(g.prototype,"orderLevel"),g.prototype),O(g.prototype,"isMarketDealable",[v],Object.getOwnPropertyDescriptor(g.prototype,"isMarketDealable"),g.prototype),g);e.default=T}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(47)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function(e){function t(e,r,n,i,o,a,s){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=Array(c>7?c-7:0),p=7;p<c;p++)l[p-7]=arguments[p];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u=t.__proto__||Object.getPrototypeOf(t)).call.apply(u,[this,e,r,n,i,o,a,s].concat(l)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toJSON",value:function(){var e=this.market,t={currency:this.currency.name,direction:this.direction.toUpperCase(),epic:e.epic,igInstrumentId:e.igInstrumentId,timeInForce:this.timeInForce,orderType:this.orderType,leverageFactor:this.market.leverageFactor,quantity:{quantityType:"CONTRACTS",value:this.size}};return"GOOD_TILL_DATE"===this.timeInForce&&(t.expiresAt=this.goodTillDate),"MARKET"===this.orderType?(t.orderType="LIMIT",t.price=this.priceWithTolerance):this.orderType.includes("LIMIT")&&(t.price=this.triggerLevel),this.orderType.includes("STOP")&&(t.stopPrice=this.stopPrice),t}}]),t}(t.default);e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(48),r(3)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(e,r){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,{},e,r.market].concat(o)));return s.set("order",r),s.set("dealId",r.dealId),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_getValidators",value:function(){return[r.marketDealable]}},{key:"_submitDeal",value:function(){return this._restService.delete(this)}},{key:"toJSON",value:function(){return{timeStamp:this.heartbeat.timestamp,dealReference:this.dealReference}}},{key:"isMarketDealable",get:function(){var e=this.order;return e&&e.canClose()}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(13),r(3),r(11)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){function t(e,r){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,{order:r,dealId:r.dealId},e,r.market].concat(o)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"_getValidators",value:function(){return[r.marketDealable]}},{key:"toString",value:function(){return n.default.ORDER}},{key:"_submitDeal",value:function(){return this._restService.deleteOrder(this)}},{key:"toJSON",value:function(){var e={timeStamp:this.heartbeat.timestamp,dealReference:this.dealReference},t=this._session.user.broker;return t&&t.decisionMakerAccountId&&(e.decisionMakerAccountId=t.decisionMakerAccountId),e}},{key:"isMarketDealable",get:function(){var e=this.order;return e&&e.canClose()}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(16),r(3),r(2)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o,a,s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var u,c,l,p,f,d,y=Object.freeze({0:"GoodForDay",1:"GoodTillCancelled",3:"ExecuteAndEliminate",4:"FillOrKill",6:"GoodTillDate",X:"GoodForDayAllSessions"}),h=Object.freeze({1:"Market",2:"MarketLimit",3:"MarketStop"}),v=(o=(0,n.default)("isDMA","order.dmaOrderType"),a=function(e){function t(e,r){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,e,r.market].concat(o)));return s.setProperties({isEditTicket:!0,order:r,direction:"+"===r.direction?"buy":"sell",size:r.quantity,filledQuantity:r.filledQuantity,triggerLevel:r.openLevel,stopStep:r.stopStep,stopTrailingDistance:r.stopTrailingDistance,maxSize:r.quantity,isDMA:r.isDMA}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"_getMargin",value:function(){return this.marginService.getEditOrderMargin(this)}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.settings.forceExAnteOpenEndpointForEdits?this.indicativeCostsAndChargesService.getIndicativeOpenQuote(this):this.indicativeCostsAndChargesService.getIndicativeEditQuote(this)}},{key:"_getValidators",value:function(){return[r.dateBelowMin,r.direction,r.marketDealable,r.triggerLevelWithinValidDistance,r.triggerLevelAboveZero,r.triggerLevelDmaCorrectIncrementTick,r.controlledRiskUser,r.hasLiveData,r.dmaSizeBelowMax,r.sizeAboveZero,r.dmaSizeAboveFilled]}},{key:"_submitDeal",value:function(){return this._restService.edit(this)}},{key:"toJSON",value:function(){var e=this.order,t=this.market,r=this.direction,n={dealId:e.dealId,direction:r.toUpperCase(),pricePreference:r.toUpperCase(),epic:t.epic,orderLevel:parseFloat(this.triggerLevel),orderSize:parseFloat(this.size),orderType:this.dmaOrderType,timeInForce:y[e.dmaTimeInForce],timeStamp:this.heartbeat.timestamp,lsServerName:this._restService._lsServerName},i=this._session.user.broker;return i&&i.decisionMakerAccountId&&(n.decisionMakerAccountId=i.decisionMakerAccountId),n}},{key:"destroy",value:function(){this.order.off("change",this._onOrderChange,this),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"openLevel",get:function(){return this.order.openLevel}},{key:"isMarketDealable",get:function(){var e=this.order;return e&&e.canEdit()}},{key:"dmaOrderType",get:function(){if(this.isDMA&&this.order)return h[this.order.dmaOrderType]}}]),t}(t.default),u=a.prototype,c="dmaOrderType",l=[o],p=Object.getOwnPropertyDescriptor(a.prototype,"dmaOrderType"),f=a.prototype,d={},Object.keys(p).forEach((function(e){d[e]=p[e]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=l.slice().reverse().reduce((function(e,t){return t(u,c,e)||e}),d),f&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(f):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(u,c,d),d=null),a);e.default=v}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(16),r(3),r(2)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o,a,s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var u,c,l,p,f,d,y=Object.freeze({0:"GOOD_FOR_DAY",1:"GOOD_TILL_CANCELLED",2:"GOOD_TILL_DATE",3:"FILL_OR_KILL",4:"IMMEDIATE_OR_CANCEL"}),h=Object.freeze({1:"MARKET",2:"LIMIT",3:"STOP_MARKET",4:"STOP_LIMIT"}),v=(o=(0,n.default)("order.dmaOrderType"),a=function(e){function t(e,r){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,e,r.market].concat(o)));return s.setProperties({order:r,direction:"+"===r.direction?"buy":"sell",triggerLevel:r.openLevel,orderStopLevel:r.orderStopLevel}),s._validate(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"_getMargin",value:function(){}},{key:"_getValidators",value:function(){return[r.marketDealable,r.hasLiveData,r.triggerLevelAboveZeroForLimitOrder]}},{key:"_getIndicativeCostsAndCharges",value:function(){return this.isBuy?this.indicativeCostsAndChargesService.getIndicativeOpenQuote(this):this.indicativeCostsAndChargesService.getIndicativeCloseQuote(this,!0)}},{key:"_submitDeal",value:function(){return this._restService.edit(this)}},{key:"toJSON",value:function(){var e=this.order,t=this.market,r=this.currency,n=this.direction;return{currency:r.name,direction:n.toUpperCase(),epic:t.epic,igInstrumentId:e.igInstrumentId,orderType:this.orderType,timeInForce:y[e.dmaTimeInForce],price:this.triggerLevel,stopPrice:this.orderStopLevel||0,strikePrice:this.market.strikePrice,quantity:{quantityType:"CONTRACTS",value:e.quantity}}}},{key:"openLevel",get:function(){return this.order.openLevel}},{key:"isMarketDealable",get:function(){var e=this.order;return e&&e.canEdit()}},{key:"orderType",get:function(){if(this.order)return h[this.order.dmaOrderType]}},{key:"iccPriceLevel",get:function(){return"STOP_MARKET"===this.orderType?this.orderStopLevel:s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"iccPriceLevel",this)}},{key:"iccStopLevel",get:function(){return null}},{key:"iccLimitLevel",get:function(){return null}},{key:"iccSize",get:function(){return this.order.quantity}},{key:"iccDirection",get:function(){return"buy"}}]),t}(t.default),u=a.prototype,c="orderType",l=[o],p=Object.getOwnPropertyDescriptor(a.prototype,"orderType"),f=a.prototype,d={},Object.keys(p).forEach((function(e){d[e]=p[e]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=l.slice().reverse().reduce((function(e,t){return t(u,c,e)||e}),d),f&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(f):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(u,c,d),d=null),a);e.default=v}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(13),r(11),r(3),r(2)],i=function(e,t,r,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,a,s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var u,c,l,p,f,d,y=(o=(0,i.default)("quantity","order.filledQuantity"),a=function(e){function t(e,r){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,{order:r,quantity:r.quantity,triggerLevel:r.openLevel},e,r.market].concat(o)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"_getValidators",value:function(){return[n.quantityBelowFilled,n.triggerLevelAboveZero]}},{key:"toString",value:function(){return r.default.ORDER}},{key:"_submitDeal",value:function(){return this._restService.editOrder(this)}},{key:"toJSON",value:function(){var e={size:this.quantity,level:this.triggerLevel,dealReference:this.dealReference,submittedTimestamp:+this.heartbeat.timestamp},t=this._session.user.broker;return t&&t.decisionMakerAccountId&&(e.decisionMakerAccountId=t.decisionMakerAccountId),e}},{key:"_validationDependentKeys",get:function(){return["quantity","triggerLevel"]}},{key:"workingQuantity",get:function(){return!this.quantity||this.quantity<=this.order.filledQuantity?this.order.dealSize:this.quantity-this.order.filledQuantity}}]),t}(t.default),u=a.prototype,c="workingQuantity",l=[o],p=Object.getOwnPropertyDescriptor(a.prototype,"workingQuantity"),f=a.prototype,d={},Object.keys(p).forEach((function(e){d[e]=p[e]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=l.slice().reverse().reduce((function(e,t){return t(u,c,e)||e}),d),f&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(f):void 0,d.initializer=void 0),void 0===d.initializer&&(Object.defineProperty(u,c,d),d=null),a);e.default=y}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(13),r(11),r(3)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){function t(e,r){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this,{position:r,size:r.dealSize,bookCost:r.bookCost},e,r.market].concat(o)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"_getValidators",value:function(){return[n.sizeAboveZero,n.bookCostFilled]}},{key:"toString",value:function(){return r.default.POSITION}},{key:"_submitDeal",value:function(){return this._restService.editPosition(this)}},{key:"toJSON",value:function(){var e={bookCost:this.bookCost,currentPositionSize:""+this.size,dealReference:this.dealReference,submittedTimestamp:+this.heartbeat.timestamp},t=this._session.user.broker;return t&&t.decisionMakerAccountId&&(e.decisionMakerAccountId=t.decisionMakerAccountId),e}},{key:"_validationDependentKeys",get:function(){return["size","bookCost"]}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(16),r(2),r(25),r(3),r(17),r(30),r(10)],i=function(e,t,r,n,i,o,a,s){"use strict";function u(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var l,p,f,d,y,h,v,g=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};function _(e,t,r,n,i){var o={};return Object.keys(n).forEach((function(e){o[e]=n[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var O=(l=(0,r.default)("market","market.marketStatus","isSell"),p=(0,r.default)("_orderType"),f=(0,r.default)("_orderType"),d=(0,r.default)("isSell","bidPrice","offerPrice","triggerLevel"),y=(0,r.default)("market","market.otcTradeable"),h=(0,r.default)("_orderType","timeInForce"),v=function(e){function t(e,r,i,s,u,c,l,p){var f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var d=arguments.length,y=Array(d>8?d-8:0),h=8;h<d;h++)y[h-8]=arguments[h];var v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f=t.__proto__||Object.getPrototypeOf(t)).call.apply(f,[this,e,r,i,s,u,c,l,p].concat(y)));if(p){var g=a.default.GOOD_FOR_DAY,_="limitgoodforday"===p.preferenceDmaDefaultOrderType?o.default.LIMIT:o.default.MARKET;v.setProperties({forceOpen:!1,isDMA:!0,orderType:_,timeInForce:g})}else{var O=s.rememberLastTradedOrderTypeAndExpiry,b=(0,n.getFirstValidDMAOrderTypeFromMarketData)(v.availableOrderTypeAndExpiryValues,O,v.market.lastTradedOrderType,v.market.defaultOrderType),m=(0,n.getFirstValidOrderExpiry)(v.availableOrderTypeAndExpiryValues,b,O,v.market.lastTradedOrderExpiry,v.market.defaultOrderExpiry);v.setProperties({forceOpen:!1,isDMA:!0,orderType:b.orderType,timeInForce:m})}return v}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),c(t,[{key:"_onChange",value:function(e){g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onChange",this).call(this,e),e.includes("_orderType")&&this._updateMargin()}},{key:"_getMargin",value:function(){return this.marginService.getOrderMargin(this)}},{key:"checkForValidOrderTypeAndExpiry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.orderType&&!this.timeInForce)return!0;if(this.market.dmaMarketData){var t=(0,n.getValidExpiries)(this.availableOrderTypeAndExpiryValues,this.orderType),r=t.includes(this.timeInForce);return!r&&e?(this.set("timeInForce",t[0]),!0):r}return!0}},{key:"_getValidators",value:function(){return[i.marketDealable,i.direction,i.orderTypeAndExpiry,i.sizeAboveMin,i.sizeAboveZero,i.stopPriceRightSideOfBidOfferPriceForDMATicket].concat(u(this.isOneClickOrMicroDMA?[]:[i.triggerLevelAboveZeroForNonMarketOrder]),[i.stopOnlyForOTCTradeableMarket,i.limitOnlyForOTCTradeableMarketAndNonLimitDayOrderType,i.triggerLevelDmaCorrectIncrementTick])}},{key:"toJSON",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.market,r=this.direction,n=this.orderType,i=this.currency,o=this.stopDistance,a=this.limitDistance,s=+this._getSubmittedTimestamp(),u=this._hasTrailingStop(),c=null,l=null;r&&(c=r.toUpperCase(),l=this.isSell?"-":"+");var p={currencyCode:i&&i.name,dealReference:this.dealReference,direction:l,pricePreference:c,epic:t.epic,expiry:t.prompt,timeInForce:this.timeInForce,guaranteedStop:this._hasGuaranteedStop(),trailingStop:u,trailingStopIncrement:u?this.stopStep:null,quoteId:this.quoteId,lsServerName:this._restService.lightstreamerServerAddress,stopDistance:o,limitDistance:a,stopLevel:o,limitLevel:a,orderType:n,type:n,level:this.orderLevel,orderLevel:this.orderLevel,size:this.size,orderSize:this.size,timeStamp:s,submittedTimestamp:s};this.ignoreOrderLevel&&!e?(delete p.level,delete p.orderLevel):this.isOneClickOrMicroDMA&&(p.level=this.isSell?t.bid:t.offer,p.orderLevel=this.isSell?t.bid:t.offer),this.ignoreLimitDistance&&(delete p.limitDistance,delete p.limitLevel),this.isStopsLimitsPlacingAllowed||(delete p.guaranteedStop,delete p.trailingStop,delete p.trailingStopIncrement,delete p.stopDistance,delete p.limitDistance,delete p.stopLevel,delete p.limitLevel);var f=this._session.user.broker;return f&&f.decisionMakerAccountId&&(p.decisionMakerAccountId=f.decisionMakerAccountId),e&&(delete p.stopLevel,delete p.limitLevel,delete p.orderType,delete p.orderLevel,delete p.orderSize,delete p.timeStamp),p}},{key:"toMarginJSON",value:function(){var e=this.toJSON(!0);return e.direction=e.pricePreference,delete e.pricePreference,e}},{key:"availableOrderTypeAndExpiryValues",get:function(){if(this.market.dmaMarketData)return(0,n.getValidDMAOrderTypesFromMarketData)(this.market.dmaMarketData.orderTypesAvailable,this.isSell,this.market.marketStatus,null,!1)}},{key:"orderType",get:function(){return this._orderType},set:function(e){this.set("_orderType",e),this.checkForValidOrderTypeAndExpiry(!0)}},{key:"ignoreOrderLevel",get:function(){return this.orderType===o.default.MARKET}},{key:"orderLevel",get:function(){return this.orderType===o.default.MARKET?this._calculateMarketLevel():this.triggerLevel}},{key:"isStopsLimitsPlacingAllowed",get:function(){return this.market.otcTradeable}},{key:"stopTypes",get:function(){var e=this.market;return s.default.getStopTypes(e.controlledRisk,!1,e.trailingStopsAllowedPreference,e.isLimitedRisk).filter((function(e){return e.value!==s.default.Type.TRAILING}))}},{key:"ignoreLimitDistance",get:function(){return this.orderType===o.default.LIMIT&&this.timeInForce===a.default.GOOD_FOR_DAY}},{key:"_validationDependentKeys",get:function(){return[].concat(u(g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_validationDependentKeys",this)),["_orderType"])}},{key:"iccPriceLevel",get:function(){var e=g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"iccPriceLevel",this);return this.isOneClickOrMicroDMA&&!e?this.isSell?this.market.bid:this.market.offer:e}}]),t}(t.default),_(v.prototype,"availableOrderTypeAndExpiryValues",[l],Object.getOwnPropertyDescriptor(v.prototype,"availableOrderTypeAndExpiryValues"),v.prototype),_(v.prototype,"orderType",[p],Object.getOwnPropertyDescriptor(v.prototype,"orderType"),v.prototype),_(v.prototype,"ignoreOrderLevel",[f],Object.getOwnPropertyDescriptor(v.prototype,"ignoreOrderLevel"),v.prototype),_(v.prototype,"orderLevel",[d],Object.getOwnPropertyDescriptor(v.prototype,"orderLevel"),v.prototype),_(v.prototype,"isStopsLimitsPlacingAllowed",[y],Object.getOwnPropertyDescriptor(v.prototype,"isStopsLimitsPlacingAllowed"),v.prototype),_(v.prototype,"ignoreLimitDistance",[h],Object.getOwnPropertyDescriptor(v.prototype,"ignoreLimitDistance"),v.prototype),v);e.default=O}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(13),r(11),r(2),r(17),r(9),r(14),r(45),r(44),r(3),r(0),r(25),r(46)],i=function(e,t,r,n,i,o,a,s,u,c,l,p,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var y=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var h,v,g=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var _,O,b,m,T,k,S=(h=(0,n.default)("level","currentMarketLevel","orderType"),v=function(e){function t(e,r,n,i,o,s,u){var c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var f=arguments.length,d=Array(f>7?f-7:0),y=7;y<f;y++)d[y-7]=arguments[y];var h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c=t.__proto__||Object.getPrototypeOf(t)).call.apply(c,[this,{sizeUnit:a.default.QUANTITY,isExchangeTraded:!0},e,r,n,i,o,s,u].concat(d)));h._shareDealingService=e,h._dealReferenceGenerator=o,h._throttledGetCharges=(0,l.throttle)(h.getCharges.bind(h),5e3);var v=i.rememberLastTradedOrderTypeAndExpiry,g=(0,p.getValidDMAOrderTypesFromMarketData)(h.market.dmaMarketData.orderTypesAvailable,h.isSell,h.market.marketStatus,h.sizeUnit!==a.default.QUANTITY),_=(0,p.getFirstValidDMAOrderTypeFromMarketData)(g,v,h.market.lastTradedOrderType,h.market.defaultOrderType),O=(0,p.getFirstValidOrderExpiry)(g,_,v,h.market.lastTradedOrderExpiry,h.market.defaultOrderExpiry);return h.setProperties({orderType:_.orderType,timeInForce:O}),h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),y(t,[{key:"toString",value:function(){return r.default.ORDER}},{key:"toJSON",value:function(){var e=this.considerationCurrency,t=this.currency,r=this.dealReference,n=this.effectiveLevel,i=this.direction,s=this.market,u=s.epic,c=s.marketStatus,l=this.orderType,p=this.size,f=this.timeInForce,y={dealReference:r,direction:i.toUpperCase(),epic:u,submittedTimestamp:+this._getSubmittedTimestamp(),timeInForce:f,queueIfClosed:c===o.default.EDIT},h=this._session.user.broker;h&&h.decisionMakerAccountId&&(y.decisionMakerAccountId=h.decisionMakerAccountId);var v={currencyCode:t.name,level:n,size:p,type:l},g={considerationAmount:p,instrumentCurrencyCode:t.name,orderLevel:n,considerationCurrency:this.sizeUnit===a.default.VALUE?e:t.name},_=a.default.isConsideration(this.sizeUnit);return d({},y,_?g:v)}},{key:"_updateCharges",value:function(){var e=this.size,t=this.direction,r=this.effectiveLevel;if(!e||!t||!r)return this.setProperties({charges:null,orderSize:null}),void this._throttledGetCharges.cancel();this._throttledGetCharges()}},{key:"getCharges",value:function(){var e=this,t=this._shareDealingService.getCharges(this);if(this.setProperties({chargesRequest:t,_chargesRequestAborted:!1}),t)return t.then((function(t){if(!e._chargesRequestAborted){var r=a.default.isConsideration(e.sizeUnit)?t.chargesEstimateResponse:t;e.setProperties({charges:r,chargesRequest:null,orderSize:t.orderSize})}})).catch((function(t){e.set("chargesRequest",null),(0,s.default)(t)}))}},{key:"_onChange",value:function(e){g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onChange",this).call(this,e),(0,u.default)(e,["size","sizeUnit","effectiveLevel","direction","currency"])&&this._updateCharges()}},{key:"_abortChargesRequest",value:function(){this._chargesRequestAborted=!0}},{key:"_getValidators",value:function(){return[c.direction,c.marketDealable,c.shareDealingSizeAboveZero,c.sizeBelowMax,c.levelAboveZero,c.technicalIssues,c.orderSizeAboveZero]}},{key:"_submitDeal",value:function(){return this._restService.createExchangeOrder(this)}},{key:"_getMargin",value:function(){return null}},{key:"_updatePerMarketSettings",value:function(){var e=this.toJSON(),t=l.default.invert(i.default)[e.type],r=(0,f.default)(this.settings,e,t);this.market.setProperties(r)}},{key:"destroy",value:function(){this._abortChargesRequest(),this._throttledGetCharges.cancel(),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"isMarketDealable",get:function(){return[o.default.TRADEABLE,o.default.AUCTION,o.default.EDIT].includes(this.market.marketStatus)}},{key:"_validationDependentKeys",get:function(){return[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_validationDependentKeys",this)),["orderSize","orderType","level","market.displayOffer","market.displayBid","sizeUnit"])}},{key:"effectiveLevel",get:function(){return this.orderType===i.default.MARKET?this.currentMarketLevel:this.level}}]),t}(t.default),_=v.prototype,O="effectiveLevel",b=[h],m=Object.getOwnPropertyDescriptor(v.prototype,"effectiveLevel"),T=v.prototype,k={},Object.keys(m).forEach((function(e){k[e]=m[e]})),k.enumerable=!!k.enumerable,k.configurable=!!k.configurable,("value"in k||k.initializer)&&(k.writable=!0),k=b.slice().reverse().reduce((function(e,t){return t(_,O,e)||e}),k),T&&void 0!==k.initializer&&(k.value=k.initializer?k.initializer.call(T):void 0,k.initializer=void 0),void 0===k.initializer&&(Object.defineProperty(_,O,k),k=null),v);e.default=S}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(13),r(11),r(44),r(14),r(3),r(0),r(45),r(70),r(46)],i=function(e,t,r,n,i,o,a,s,u,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var p=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var f=function(e){function t(e,r,n,o,s,u,c){var l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var p=arguments.length,f=Array(p>7?p-7:0),d=7;d<p;d++)f[d-7]=arguments[d];var y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l=t.__proto__||Object.getPrototypeOf(t)).call.apply(l,[this,{sizeUnit:i.default.QUANTITY,isExchangeTraded:!0},e,r,n,o,s,u,c].concat(f)));return y._shareDealingService=e,y._dealReferenceGenerator=s,y._throttledGetCharges=a.default.throttle(y.getCharges.bind(y),5e3),y}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),l(t,[{key:"toString",value:function(){return r.default.ORDER}},{key:"toJSON",value:function(){var e=this.dealReference,t=this.direction,r=this.market.epic,n=this.quoteDetails,i=n.bidPrice,o=n.offerPrice,a=n.quoteId,s=n.rspName,u=n.currency,c=n.reportData.quantity.value,l={currencyCode:u,dealReference:e,direction:t.toUpperCase(),epic:r,level:this.isSell?i:o,quoteId:a,quoteOriginId:s,size:c,submittedTimestamp:+this._getSubmittedTimestamp()},p=this._session.user.broker;return p&&p.decisionMakerAccountId&&(l.decisionMakerAccountId=p.decisionMakerAccountId),l}},{key:"_submitDeal",value:function(){return this._restService.createQuoteOrder(this)}},{key:"_updateCharges",value:function(){var e=this.size,t=this.direction,r=this.currentMarketLevel;if(this._abortChargesRequest(),!e||!t||!r)return this.setProperties({charges:null,orderSize:null}),void this._throttledGetCharges.cancel();this._throttledGetCharges()}},{key:"getCharges",value:function(){var e=this,t=this._shareDealingService.getCharges(this);if(this.setProperties({chargesRequest:t,_chargesRequestAborted:!1}),t)return t.then((function(t){if(!e._chargesRequestAborted){var r=i.default.isConsideration(e.sizeUnit)?t.chargesEstimateResponse:t;e.setProperties({charges:r,chargesRequest:null,orderSize:t.orderSize})}})).catch((function(t){e.set("chargesRequest",null),(0,s.default)(t)}))}},{key:"_onChange",value:function(e){p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onChange",this).call(this,e),(0,n.default)(e,["size","sizeUnit","direction","currentMarketLevel"])&&this._updateCharges()}},{key:"_abortChargesRequest",value:function(){this._chargesRequestAborted=!0}},{key:"_getValidators",value:function(){return[o.direction,o.marketDealable,o.shareDealingSizeAboveZero,o.sizeBelowMax,o.technicalIssues,o.orderSizeAboveZero]}},{key:"updateQuote",value:function(){var e=this;return this.setProperties({quoteDetails:null,quoteError:null,isFetchingQuote:!0}),this._refreshQuoteDealReference(),this._submitQuoteRequest().then((function(t){var r=t.content;e.set("quoteDetails",r)})).catch((function(t){e.set("quoteError",t.content||t.response||t)})).finally((function(){return e.set("isFetchingQuote",!1)}))}},{key:"_submitQuoteRequest",value:function(){return this._shareDealingService.getQuote(this)}},{key:"_refreshQuoteDealReference",value:function(){this.quoteDealReference=this._dealReferenceGenerator.generateDealReference()}},{key:"_updatePerMarketSettings",value:function(){var e=(0,c.default)(this.settings,this.toJSON(),u.default.QUOTE);this.market.setProperties(e)}},{key:"_getMargin",value:function(){return null}},{key:"destroy",value:function(){this._abortChargesRequest(),this._throttledGetCharges.cancel(),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"_validationDependentKeys",get:function(){return[].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_validationDependentKeys",this)),["market.displayOffer","market.displayBid","orderSize","sizeUnit"])}}]),t}(t.default);e.default=f}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(47)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function(e){function t(e,r,n,i,o,a,s){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=Array(c>7?c-7:0),p=7;p<c;p++)l[p-7]=arguments[p];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u=t.__proto__||Object.getPrototypeOf(t)).call.apply(u,[this,e,r,n,i,o,a,s].concat(l)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toJSON",value:function(){var e=this.market,t={currency:this.currency.name,direction:this.direction.toUpperCase(),epic:e.epic,igInstrumentId:e.igInstrumentId,timeInForce:this.timeInForce,orderType:this.orderType,strikePrice:this.market.strikePrice,quantity:{quantityType:"CONTRACTS",value:this.size}};return"GOOD_TILL_DATE"===this.timeInForce&&(t.expiresAt=this.goodTillDate),"MARKET"===this.orderType?(t.orderType="LIMIT",t.price=this.priceWithTolerance):(this.orderType.includes("LIMIT")&&(t.price=this.triggerLevel),this.orderType.includes("STOP")&&(t.stopPrice=this.stopPrice)),t}}]),t}(t.default);e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(47)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function(e){function t(e,r,n,i,o,a,s){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,l=Array(c>7?c-7:0),p=7;p<c;p++)l[p-7]=arguments[p];return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u=t.__proto__||Object.getPrototypeOf(t)).call.apply(u,[this,e,r,n,i,o,a,s].concat(l)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toJSON",value:function(){var e=this.market,t={currency:this.currency.name,direction:this.direction.toUpperCase(),epic:e.epic,igInstrumentId:e.igInstrumentId,timeInForce:this.timeInForce,orderType:this.orderType,strikePrice:e.strikePrice,quantity:{quantityType:"CONTRACTS",value:this.size}};return"GOOD_TILL_DATE"===this.timeInForce&&(t.expiresAt=this.goodTillDate),"MARKET"===this.orderType?(t.orderType="LIMIT",t.price=this.priceWithTolerance):this.orderType.includes("LIMIT")&&(t.price=this.triggerLevel),this.orderType.includes("STOP")&&(t.stopPrice=this.stopPrice),t}}]),t}(t.default);e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={WARRANT_INDICES:"COVERED_WARRANT_INDICES",WARRANT_COMMODITIES:"COVERED_WARRANT_COMMODITIES",WARRANT_CURRENCIES:"COVERED_WARRANT_CURRENCIES",WARRANT_SHARES:"COVERED_WARRANT_SHARES"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var t=[];t.push(["vendor","IG Group"]),t.push(["applicationType",e.applicationType||"ig"]),t.push(["platform",e.platform]),e.deviceType&&t.push(["deviceType",e.deviceType]);e.view&&t.push(["view",e.view]);t.push(["version",e.version]),e.component&&t.push(["component",e.component.replace("|","_")]);e.componentVersion&&t.push(["componentVersion",e.componentVersion]);return t.filter((function(e){return e[1]})).map((function(e){return e[0]+"="+e[1].toString()})).join(" | ")}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,r,n,i){var o=null;e&&r&&n&&r===t.rate&&(o=e*n)<i&&(o=i);return o};var t=Object.freeze({percent:"PERCENT",rate:"RATE"})}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,r){return e=t[e]||e,r=t[r]||r,!e&&!r||e===r};var t={"+":"buy","-":"sell"}}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(19),r(8),r(31)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,i,o,a,s,u,c,l){var p=i===r.default.Type.ABSOLUTE,f=r.default.distanceFrom(e,i,u,s),d=(0,n.default)(o,u,i,a);if(l&&!f)return{isValid:!1,error:{key:t.default.Reason.LIMIT_REQUIRED}};if(isNaN(e))return{isValid:!1,error:{key:t.default.Reason.INVALID_LEVEL}};if(p&&(c&&e<u||!c&&e>u))return{isValid:!1,error:{key:t.default.Reason.LIMIT_WRONG_SIDE}};if(f<0||!p&&0===f)return{isValid:!1,error:{key:t.default.Reason.LIMIT_TOO_CLOSE}};if(p&&0===f)return{isValid:!1,error:{key:t.default.Reason.LIMIT_SAME_AS_CURRENT_LEVEL}};if(null!==d&&f>d)return{isValid:!1,error:{key:t.default.Reason.LIMIT_TOO_FAR}};return{isValid:!0}}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseRelationships=void 0;var r="OCO",n="OTO",i="SOURCE",o="TARGET",a=(e.parseRelationships=function(e){if(!e)return{triggersOtherOrders:!1,triggeredBy:null,cancelledBy:null};var t=!!a(e,n,i).length,s=a(e,n,o),u=a(e,r,o);return{triggersOtherOrders:t,triggeredBy:s.length?s[0].refOrderId:null,cancelledBy:u.length?u[0].refOrderId:null}},function(e,r,n){return e?t.default.filter(e,{instruction:r,association:n}):null})}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(5)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,r,n){n!==t.UNITS.AMOUNT&&(r=1);return e/r}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(6),r(26)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.market.on("change",r._onMarketChange,r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_onMarketChange",value:function(e){(e.includes("bid")||e.includes("offer"))&&this.trigger("change",["latest"])}},{key:"destroy",value:function(){return this.market.off("change",this._onMarketChange,this),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"latest",get:function(){var e=this.marketAttribute===r.default.PriceType.BUY_PRICE?this.market.offer:this.market.bid;return parseFloat(e)}}],[{key:"fromDealingRestAlert",value:function(e){return new t(e)}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(6)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{name:e.name,code:e.code,symbol:e.symbol,ticketDefault:e.ticketDefault,exchangeRate:e.exchangeRate,baseExchangeRate:e.baseExchangeRate,isDefault:e.isDefault}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,null,[{key:"populateWithJson",value:function(e){return new t(e)}}]),t}(t.default);e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n;n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r=function(){function e(t){var r=t.rangeData,n=t.orderTypesAvailable;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rangeData=r,this.orderTypesAvailable=n}return t(e,null,[{key:"parseRangeData",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n="Default Tick Matrix"===t;return e.map((function(e){var t=e.startRange,i=e.endRange,o=e.increment;return Object.freeze({start:t,end:-1===i?1/0:i,step:n?o/r:o})}))}},{key:"populateWithJson",value:function(t,r){var n=t||{},i=n.orderTypesAvailable,o=n.tickMatrixData,a=(o=void 0===o?{}:o).rangeData,s=o.name,u=null;if(a)u=e.parseRangeData(a,s,r);else if(!i)return null;return new e({rangeData:u,orderTypesAvailable:i})}}]),e}();e.default=r}.apply(t,[t]),void 0===n||(e.exports=n)},function(e,t,r){var n,i;n=[t,r(6)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=["size","expiryClosest","expiryFurthest"],o=function(e){function t(e,r,n,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a._entries=[],a._timeouts=[],a._heartbeat=e,a.epic=n,a.currency=i,a.direction=o,a.setRDW(r),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"size",get:function(){return this._entries&&this._entries.length?this._entries[0].size:0}},{key:"expiryClosest",get:function(){var e="number"==typeof this._heartbeat.offset?this._heartbeat.offset:0;return this._entries&&this._entries.length?this._entries[0].expiry-e:null}},{key:"expiryFurthest",get:function(){var e="number"==typeof this._heartbeat.offset?this._heartbeat.offset:0;return this._entries&&this._entries.length?this._entries[this._entries.length-1].expiry-e:null}}]),n(t,[{key:"setRDW",value:function(e){var t=this,r=this._heartbeat.getTime(),n=e.slice().sort((function(e,t){return e.expiry-t.expiry})).filter((function(e){return e.expiry-r>0}));if(this._timeouts.forEach((function(e){return clearTimeout(e)})),n.length){var i=n.map((function(e){return setTimeout((function(){var r=n.indexOf(e);r>-1&&t._triggerChangeEvent((function(){n.splice(r,1),i.splice(r,1)}))}),e.expiry-r)}));this._triggerChangeEvent((function(){t._entries=n,t._timeouts=i}))}else this._entries.length&&this._triggerChangeEvent((function(){t._entries=[],t._timeouts=[]}))}},{key:"_triggerChangeEvent",value:function(e){var t=this,r=i.map((function(e){return t[e]}));e();var n=i.filter((function(e,n){return t[e]!==r[n]}));n.length&&this.trigger("change",n)}},{key:"destroy",value:function(){this._entries&&this.setRDW([]),r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),delete this._entries,delete this._timeouts}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(80),r(9)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,{epic:t.default.unpricedEpic}))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,e),n(i,null,[{key:"populateWithV2MarketData",value:function(e){var t=e.instrumentData,n=new i,o=e.dealSettings||{};return n.populateWith({controlledRisk:!1,dealingRules:null,guaranteedStopsAllowed:!1,trailingStopsAllowedPreference:!0,instrumentName:t.marketName,marketId:t.marketId,exchangeId:t.exchangeId,expiryDetails:t.expiryDetails,displayPeriod:t.displayPrompt,isin:t.isin,mtfAvailable:t.mtfAvailable,otcTradeable:t.otcTradeable,instrumentDmaL1Tradeable:"???",dmaTradeable:t.dmaTradeable,dmaL1Tradeable:t.dmaL1Tradeable,dxdTradeable:"???",instrumentType:t.instrumentType||"UNKNOWN",stopsLimitsAllowed:!1,stopAllowed:!1,limitAllowed:!1,unit:t.unit,marketStatus:r.default.resolve({rawMarketStatus:0}),high:null,low:null,percentageChange:null,netChange:null,bid:null,offer:null,bestBid:null,bestOffer:null,scalingFactor:null,decimalPlacesFactor:null,updateTime:null,viewPermission:t.viewPermission,delayTime:null,scaled:null,marketAnalysisAvailable:t.marketAnalysisAvailable,alertsAllowed:t.alertsAllowed,countryCode:t.countryCode,newsSymbol:t.newsCode,currency:t.currency,currencies:[],minDealSize:0,defaultOrderType:o.defaultOrderType,defaultOrderExpiry:o.defaultOrderExpiry,lastTradedPointsThroughCurrent:o.lastTradedPointsThroughCurrent||null,lastTradedSize:o.lastTradedDealSize||null,lastTradedCurrency:o.lastTradedDealCurrency||null,lastTradedLimitDistance:o.lastTradedLimitDistance||null,lastTradedStopDistance:o.lastTradedStopDistance||null,lastTradedStopType:o.lastTradedStopType||null,lastTradedTrailingStopIncrement:o.lastTradedTrailingStopIncrement||null,lastTradedOrderExpiry:o.lastTradedOrderExpiry||null,lastTradedOrderType:o.lastTradedOrderType||null,lotSize:t.lotSize,prompt:t.prompt,hasCompleteMarketData:!1}),n}}]),i}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(6)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,null,[{key:"fromDealingRestWatchlist",value:function(e){return new t(e)}}]),t}(t.default);e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(1),r(24),r(7)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._session=e,r._pollTimeoutId=null,r.updateDealReference(t),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),i(n,[{key:"updateDealReference",value:function(e){this._dealReference=e}},{key:"pollForConfirm",value:function(){var e=this;return new Promise((function(t,r){e._schedulePoll(t,r,0,n.INITIAL_TIMEOUT)}))}},{key:"destroy",value:function(){this.off(),this._pollTimeoutId&&(clearTimeout(this._pollTimeoutId),this._pollTimeoutId=null)}},{key:"_schedulePoll",value:function(e,t,r,n){var i=this;this._pollTimeoutId=setTimeout((function(){i._pollTimeoutId=null,i._poll(e,t,r)}),n)}},{key:"_poll",value:function(e,i,o){var a=this,s="/"+this._session.environment.path+"/executionreport/"+this._dealReference;0===o&&this.trigger(r.default.FIRST_POLL),t.get(s,this._session).then((function(t){t.content.reportData.rejectionMessage?i(t):e(t)})).catch((function(){var t=void 0,r=void 0;++o>=n.MAX_RETRIES?i("RETRY_COUNT_EXCEEDED"):(r=.4*(t=n.BASE_TIMEOUT*Math.pow(1.3,o)),t=t+Math.random()*r-.5*r,a._schedulePoll(e,i,o,t))}))}}]),n}(n.default);e.default=o;o.INITIAL_TIMEOUT=2e3,o.BASE_TIMEOUT=1e4,o.MAX_RETRIES=10,o.stubTimeout=function(e){o.INITIAL_TIMEOUT=e,o.BASE_TIMEOUT=e},o.restoreTimeout=function(){o.INITIAL_TIMEOUT=2e3,o.BASE_TIMEOUT=1e4}}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(e,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return o._lsServerName=i,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.order,t="/"+this._session.environment.path+"/orders/workingorders/dma/"+e.dealId;return r.del(t,this._session,{lsServerName:this._lsServerName,timeStamp:""+Date.now()})}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.order.dealId,t="/"+this._session.environment.path+"/orders/workingorders/dma/"+e;return r.put(t,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1),r(34)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"_doRequest",value:function(){var e=this._data.position.dealId,t=this._data.position instanceof n.default?"/"+this._session.environment.path+"/orders/positions/dma":"/"+this._session.environment.path+"/orders/positions/dma/"+e;return r.del(t,this._session,this._data)}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e={"X-CLIENT-REQUEST-ID":this._data.dealReference,accountId:this._session.user.accountId};return r.post("/platform-order-entry-gateway/orders",this._session,this._data,e)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.order,t="/platform-order-entry-gateway/orders/"+e.dealId,n={"X-CLIENT-REQUEST-ID":this._data.dealReference,"X-ORIGINAL-CLIENT-REQUEST-ID":e.clientOrderId,accountId:this._session.user.accountId,igInstrumentId:e.market.igInstrumentId,epic:e.epic};return r.del(t,this._session,null,n)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.order,t="/platform-order-entry-gateway/orders/"+e.dealId,n={"X-CLIENT-REQUEST-ID":this._data.dealReference,"X-ORIGINAL-CLIENT-REQUEST-ID":e.clientOrderId,accountId:this._session.user.accountId};return r.put(t,this._session,this._data,n)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.isDMA?"/"+this._session.environment.path+"/orders/workingorders/dma":"/"+this._session.environment.path+"/v3/orders/workingorders/otc";return r.post(e,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.order.dealId,t="/"+this._session.environment.path+"/v3/orders/workingorders/otc/"+e;return r.del(t,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.order.dealId,t="/"+this._session.environment.path+"/v3/orders/workingorders/otc/"+e;return r.put(t,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e="/"+this._session.environment.path+"/v3/orders/positions/otc";return r.del(e,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e="/"+this._session.environment.path+"/v3/orders/positions/otc";return r.post(e,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.position.dealId;return!!this._data.position.positions?r.put("/"+this._session.environment.path+"/v3/orders/positions/otc/agg",this._session,this._data):r.put("/"+this._session.environment.path+"/v3/orders/positions/otc/"+e,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1),r(14)],i=function(e,t,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"_doRequest",value:function(){var e=n.default.isConsideration(this._data.sizeUnit)?"consideration/":"",t="/"+this._session.environment.path+"/orders/workingorders/"+e+"stockbroking";return r.post(t,this._session,this._data)}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e="/"+this._session.environment.path+"/orders/workingorders/onquote/stockbroking";return r.post(e,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.order.dealId,t="/"+this._session.environment.path+"/orders/workingorders/stockbroking/"+e;return r.del(t,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.order.dealId,t="/"+this._session.environment.path+"/orders/workingorders/stockbroking/"+e;return r.put(t,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(4),r(1)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_doRequest",value:function(){var e=this._data.position.dealId,t="/"+this._session.environment.path+"/orders/positions/stockbroking/"+e;return r.put(t,this._session,this._data)}}]),t}(t.default);e.default=i}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(12),r(7)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){function r(e,t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return o._trades=new Map,o._tradesPending=new Map,o._subscribedToUpdates=!1,o._session=e,o._restService=t,o._marketService=n,o._streamingClient=i,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,e),i(r,[{key:"_isDestroyed",get:function(){return!this._session}}]),i(r,[{key:"getCurrentTrades",value:function(){return Array.from(this._trades.values())}},{key:"updateTrades",value:function(){var e=this;return this._subscribedToUpdates||(this._subscribedToUpdates=!0,this._streamingClient.startListening(this._session.user.accountId),this._streamingClient.on(t.default.ADDED,this._handleTradeAdded,this),this._streamingClient.on(t.default.REMOVED,this._handleTradeRemoved,this)),this._restService.getAll().then((function(t){return e._isDestroyed?[]:(e._processResponse(t),e.getCurrentTrades())}))}},{key:"_processResponse",value:function(e){var r=e.positions,n=e.orders,i=e.markets,o=r||n;if(!o)throw new Error("Need to be able to get either positions or orders from the REST service");var a=new Set,s=new Map(this._trades),u=new Map(this._tradesPending),c=!0,l=!1,p=void 0;try{for(var f,d=o[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value,h=this._trades.get(y.dealId),v=this._tradesPending.get(y.dealId);h?(h.updateFromOther(y),s.delete(y.dealId),y.destroy()):v?(v.updateFromOther(y),u.delete(y.dealId),this._addTrade(v,i[y.epic]),a.add(v),y.destroy()):(this._addTrade(y,i[y.epic]),a.add(y))}}catch(g){l=!0,p=g}finally{try{!c&&d.return&&d.return()}finally{if(l)throw p}}u.size&&u.forEach(this._removeTrade.bind(this)),s.size&&(this.trigger(t.default.REMOVED,Array.from(s.values())),s.forEach(this._removeTrade.bind(this))),a.size&&this.trigger(t.default.ADDED,Array.from(a))}},{key:"_addTrade",value:function(e,t){e.set("market",t),this._tradesPending.delete(e.dealId),this._trades.set(e.dealId,e)}},{key:"_removeTrade",value:function(e){this._trades.delete(e.dealId),this._tradesPending.delete(e.dealId),e.destroy()}},{key:"_handleTradeAdded",value:function(e){var r=this;this._tradesPending.set(e.dealId,e),this._marketService.findByEpic(e.epic).then((function(n){r._isDestroyed||r._tradesPending.has(e.dealId)&&(r._addTrade(e,n),r.trigger(t.default.ADDED,[e]))}))}},{key:"_handleTradeRemoved",value:function(e){var r=this._trades.get(e),n=this._tradesPending.get(e);r?(this.trigger(t.default.REMOVED,[r]),this._removeTrade(r)):n&&this._removeTrade(n)}},{key:"destroy",value:function(){this._streamingClient&&(this._streamingClient.off(t.default.ADDED,this._handleTradeAdded,this),this._streamingClient.off(t.default.REMOVED,this._handleTradeRemoved,this),this._streamingClient.stopListening(),delete this._streamingClient),this._trades.size&&(this.trigger(t.default.REMOVED,Array.from(this._trades.values())),this._trades.forEach((function(e){return e.destroy()})),this._trades.clear()),this._tradesPending.size&&(this._tradesPending.forEach((function(e){return e.destroy()})),this._tradesPending.clear()),delete this._restService,delete this._marketService,delete this._session,this._subscribedToUpdates=!1,n(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}}]),r}(r.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(7)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0};var i="V2-F-MKT|{epic}",o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return r.lightstreamerService=e,r.subscriptions={},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"add",value:function(e){var t=i.replace("{epic}",e);this.subscriptions[e]||(this.subscriptions[e]=this.lightstreamerService.subscribe(t,["MKT"],"MERGE",this._onUpdate.bind(this,e),1))}},{key:"remove",value:function(e){this.subscriptions[e]&&(this.subscriptions[e].unsubscribe(),this.subscriptions[e]=null)}},{key:"_onUpdate",value:function(e,r){r.isSnapshot()||this.trigger(t.UPDATE_EVENT,e)}},{key:"destroy",value:function(){Object.keys(this.subscriptions).forEach(this.remove,this),this.subscriptions=null,n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}],[{key:"UPDATE_EVENT",get:function(){return"UPDATED"}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(0)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._isSnapshot=r,this._fields=n?t.default.clone(n):{}}return r(e,[{key:"setField",value:function(e,t){this._fields[e]=t}},{key:"isValueChanged",value:function(e){return Object.prototype.hasOwnProperty.call(this._fields,e)}},{key:"isSnapshot",value:function(){return this._isSnapshot}},{key:"getValue",value:function(e){return this._fields[e]}},{key:"forEachChangedField",value:function(e){var r=this;t.default.forEach(this._fields,(function(t,n){e(n,0,t,r)}))}},{key:"hasData",value:function(){return Boolean(t.default.size(this._fields))}}]),e}();e.default=n}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(28)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PRIORITISED_RESPONSE_WAIT_TIME=e.default=void 0;var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._resolve=r,this._reject=n,this._removeListenerCallback=i,this._storedUpdate=null,this._timerHandle=setTimeout(this._timerFired.bind(this),500),this.dealReference=t}return r(e,[{key:"resolve",value:function(e){this._handleResponse("resolve",e)}},{key:"reject",value:function(e){this._handleResponse("reject",e)}},{key:"_handleResponse",value:function(e,r){if(!this._timerHandle||t.IMMEDIATE_RESPONSE_REPORT_TYPES.includes(r.content.reportType))this._storedUpdate={type:e,update:r},this._resolveOrReject();else if(this._storedUpdate){var n=t.REPORT_TYPE_PRIORITIES[this._storedUpdate.update.content.reportType];t.REPORT_TYPE_PRIORITIES[r.content.reportType]>n&&(this._storedUpdate={type:e,update:r})}else this._storedUpdate={type:e,update:r}}},{key:"_timerFired",value:function(){this._timerHandle=null,this._storedUpdate&&this._resolveOrReject()}},{key:"_resolveOrReject",value:function(){this._timerHandle&&(clearTimeout(this._timerHandle),this._timerHandle=null),this._removeListenerCallback(this.dealReference),"resolve"===this._storedUpdate.type?this._resolve(this._storedUpdate.update):this._reject(this._storedUpdate.update)}}]),e}();e.default=n,e.PRIORITISED_RESPONSE_WAIT_TIME=500}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){var n,i;n=[t,r(7),r(71)],i=function(e,t,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function i(e){return"STREAMING"===e||"POLLING"===e||"CONNECTED"===e.substr(0,9)&&"CONNECTED:STREAM-SENSING"!==e}var o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._lightstreamerService=e,r._lightstreamerService.on(e.STATUS_CHANGE_EVENT,r._updateStreamingStatus.bind(r),r),r._isStreaming=i(r._lightstreamerService.getStatus()),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"destroy",value:function(){this._lightstreamerService.un(null,this),this._lightstreamerService=null}},{key:"_updateStreamingStatus",value:function(e){var t=this._isStreaming;(this._isStreaming=i(e))&&!t&&this.trigger(r.default.RECONNECTED)}}]),t}(t.default);e.default=o}.apply(t,n),void 0===i||(e.exports=i)},function(e,t,r){e.exports=function(){"use strict";function e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function t(r,n){function i(t,i,o){if("undefined"!=typeof document){"number"==typeof(o=e({},n,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var s in o)o[s]&&(a+="; "+s,!0!==o[s]&&(a+="="+o[s].split(";")[0]));return document.cookie=t+"="+r.write(i,t)+a}}function o(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],n={},i=0;i<t.length;i++){var o=t[i].split("="),a=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(n[s]=r.read(a,s),e===s)break}catch(u){}}return e?n[e]:n}}return Object.create({set:i,get:o,remove:function(t,r){i(t,"",e({},r,{expires:-1}))},withAttributes:function(r){return t(this.converter,e({},this.attributes,r))},withConverter:function(r){return t(e({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(r)}})}return t({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},function(e,t){e.exports=r},function(e,t,r){var n,i;n=[t,r(38),r(28),r(34),r(26),r(53),r(59),r(104),r(106),r(89),r(109),r(43),r(39),r(24),r(49),r(66),r(111),r(112),r(94),r(95),r(113),r(114),r(67),r(68),r(115),r(116),r(90),r(19),r(84),r(105),r(15),r(51),r(36),r(5),r(96),r(8),r(54),r(55),r(9),r(6),r(98),r(16),r(117),r(29),r(69),r(120),r(110),r(65),r(121),r(122),r(27),r(60),r(37),r(61),r(20),r(41),r(56),r(62),r(107),r(99),r(63),r(58),r(100),r(12),r(91),r(35),r(92),r(57),r(118),r(17),r(70),r(119),r(101),r(14),r(30),r(108),r(10),r(88),r(11),r(52),r(93),r(102),r(97),r(40),r(42),r(64),r(103),r(18),r(86),r(85),r(25),r(50),r(87)],i=function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,y,h,v,g,_,O,b,m,T,k,S,E,P,w,L,A,D,I,C,R,j,M,N,F,x,U,z,B,V,G,K,W,q,Q,H,Y,J,Z,X,$,ee,te,re,ne,ie,oe,ae,se,ue,ce,le,pe,fe,de,ye,he,ve,ge,_e,Oe,be,me,Te,ke,Se,Ee,Pe,we,Le,Ae,De,Ie,Ce,Re,je,Me,Ne,Fe,xe){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasWideSpread=void 0,e.isNewJapaneseTicket=e.getFirstValidDMAOrderTypeFromMarketData=e.getValidDMAOrderTypesFromMarketData=e.getValidExpiries=e.addDistinct=e.calculateIndicativeCollateralValue=e.calculateProfitLossFromBookCost=e.calculateProfitAndLossPercentage=e.calculateProfitAndLoss=e.calculateAveragePrice=e.WatchlistService=e.V4InstrumentGroupSubscription=e.V2InstrumentGroupSubscription=e.LocalAccountStorage=e.UserPreferencesService=e.User=e.Tolerance=e.TransactionState=e.TicketTypes=e.tfn=e.Stop=e.SignalsStreamingClient=e.ShareDealingTimeInForce=e.ShareDealingSizeUnits=e.ShareDealingService=e.ShareDealingQuoteOrderTicket=e.ShareDealingOrderTypes=e.ShareDealingTicketTypes=e.ShareDealingExchangeOrderTicket=e.SettingsService=e.SettingsProxy=e.Settings=e.Session=e.ServiceEvents=e.SearchService=e.ReportType=e.ReconnectableTradeStore=e.RepeatDealWindowGroupSubscription=e.QuoteService=e.PrioritisedConfirmationStreamingClient=e.PositionStreamingClient=e.PositionService=e.PositionGroupSubscription=e.Position=e.OrderStreamingClient=e.OrderService=e.OrderGroupSubscription=e.Order=e.OPTION_TYPES=e.WarrantTicketTypes=e.ConstantTicketTypes=e.WarrantOrderTicket=e.ConstantOrderTicket=e.TurboOrderTicket=e.OpenFifoPositionTicket=e.OpenPositionTicket=e.OpenDMAOrderTicket=e.OpenOrderTicket=e.MTFService=e.Model=e.MarketStatus=e.MarketService=e.MarginService=e.Level=e.KNOCKOUT_TYPES=e.InstrumentsService=e.InstrumentPriceGroupSubscription=e.Instrument=e.IndicativeCostsAndChargesService=e.ICC_EDIT_TYPES=e.ICC_API_STATES=e.Heartbeat=e.GroupSubscription=e.ForeignExchangeGroupSubscription=e.Factory=e.Errors=e.Environment=e.EditShareDealingPositionTicket=e.EditShareDealingOrderTicket=e.EditPositionTicket=e.EditOrderTicket=e.EditDmaOrderTicket=e.DynamicWatchlistService=e.DMAService=e.DeleteShareDealingOrderTicket=e.DeleteMTFOrderTicket=e.EditMTFOrderTicket=e.DeleteOrderTicket=e.DealingEvents=e.DealReferenceGenerator=e.ConfirmationStreamingClient=e.ClosePositionTicket=e.CloseDMAPositionTicket=e.Broker=e.InstrumentPriceAuditGroupSubscription=e.AuditGroupSubscription=e.AlertsStreamingClient=e.AlertService=e.AlertEnums=e.AggregatePosition=void 0,e.AggregatePosition=n.default,e.AlertEnums=i.default,e.AlertService=o.default,e.AlertsStreamingClient=a.default,e.AuditGroupSubscription=s.default,e.InstrumentPriceAuditGroupSubscription=u.default,e.Broker=c.default,e.CloseDMAPositionTicket=l.default,e.ClosePositionTicket=p.default,e.ConfirmationStreamingClient=f.default,e.DealReferenceGenerator=y.default,e.DealingEvents=d.default,e.DeleteOrderTicket=h.default,e.EditMTFOrderTicket=m.default,e.DeleteMTFOrderTicket=v.default,e.DeleteShareDealingOrderTicket=g.default,e.DMAService=_.default,e.DynamicWatchlistService=O.default,e.EditDmaOrderTicket=b.default,e.EditOrderTicket=T.default,e.EditPositionTicket=k.default,e.EditShareDealingOrderTicket=S.default,e.EditShareDealingPositionTicket=E.default,e.Environment=P.default,e.Errors=w.default,e.Factory=L.default,e.ForeignExchangeGroupSubscription=A.default,e.GroupSubscription=D.default,e.Heartbeat=I.default,e.ICC_API_STATES=C.ICC_API_STATES,e.ICC_EDIT_TYPES=C.ICC_EDIT_TYPES,e.IndicativeCostsAndChargesService=C.default,e.Instrument=R.default,e.InstrumentPriceGroupSubscription=Ae.default,e.InstrumentsService=j.default,e.KNOCKOUT_TYPES=R.KNOCKOUT_TYPES,e.Level=M.default,e.MarginService=N.default,e.MarketService=F.default,e.MarketStatus=x.default,e.Model=U.default,e.MTFService=z.default,e.OpenOrderTicket=B.default,e.OpenDMAOrderTicket=V.default,e.OpenPositionTicket=G.default,e.OpenFifoPositionTicket=K.default,e.TurboOrderTicket=W.default,e.ConstantOrderTicket=q.default,e.WarrantOrderTicket=H.default,e.ConstantTicketTypes=Q.default,e.WarrantTicketTypes=Y.default,e.OPTION_TYPES=R.OPTION_TYPES,e.Order=J.default,e.OrderGroupSubscription=Z.default,e.OrderService=X.default,e.OrderStreamingClient=$.default,e.Position=ee.default,e.PositionGroupSubscription=te.default,e.PositionService=re.default,e.PositionStreamingClient=ne.default,e.PrioritisedConfirmationStreamingClient=ie.default,e.QuoteService=oe.default,e.RepeatDealWindowGroupSubscription=ae.default,e.ReconnectableTradeStore=se.default,e.ReportType=r,e.SearchService=ue.default,e.ServiceEvents=ce.default,e.Session=le.default,e.Settings=pe.default,e.SettingsProxy=fe.default,e.SettingsService=de.default,e.ShareDealingExchangeOrderTicket=ye.default,e.ShareDealingTicketTypes=ve.default,e.ShareDealingOrderTypes=he.default,e.ShareDealingQuoteOrderTicket=ge.default,e.ShareDealingService=_e.default,e.ShareDealingSizeUnits=Oe.default,e.ShareDealingTimeInForce=be.default,e.SignalsStreamingClient=me.default,e.Stop=Te.default,e.tfn=ke.default,e.TicketTypes=Se.default,e.TransactionState=t,e.Tolerance=Ee.default,e.User=Pe.default,e.UserPreferencesService=we.default,e.LocalAccountStorage=Le.default,e.V2InstrumentGroupSubscription=De.default,e.V4InstrumentGroupSubscription=Ie.default,e.WatchlistService=Ce.default,e.calculateAveragePrice=Me.default,e.calculateProfitAndLoss=Re.calculateProfitAndLoss,e.calculateProfitAndLossPercentage=Re.calculateProfitAndLossPercentage,e.calculateProfitLossFromBookCost=Re.calculateProfitLossFromBookCost,e.calculateIndicativeCollateralValue=je.default,e.addDistinct=U.addDistinct,e.getValidExpiries=Ne.getValidExpiries,e.getValidDMAOrderTypesFromMarketData=Ne.getValidDMAOrderTypesFromMarketData,e.getFirstValidDMAOrderTypeFromMarketData=Ne.getFirstValidDMAOrderTypeFromMarketData,e.isNewJapaneseTicket=Fe.default,e.hasWideSpread=xe.default}.apply(t,n),void 0===i||(e.exports=i)}])}.apply(t,n),void 0===i||(e.exports=i)},6686:e=>{"use strict";e.exports=r},43130:e=>{"use strict";e.exports=n}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,i),o.exports}return i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(55469)})())}}}));